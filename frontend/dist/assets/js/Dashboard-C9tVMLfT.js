var ge=Object.defineProperty,je=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var K=(s,t,r)=>t in s?ge(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,V=(s,t)=>{for(var r in t||(t={}))pe.call(t,r)&&K(s,r,t[r]);if(z)for(var r of z(t))Ne.call(t,r)&&K(s,r,t[r]);return s},G=(s,t)=>je(s,fe(t));var U=(s,t,r)=>new Promise((d,n)=>{var h=o=>{try{g(r.next(o))}catch(N){n(N)}},a=o=>{try{g(r.throw(o))}catch(N){n(N)}},g=o=>o.done?d(o.value):Promise.resolve(o.value).then(h,a);g((r=r.apply(s,t)).next())});import{j as e,f as Y,g as Q,T as Z,P as C,U as q,a as B,h as O,i as W,k as ve,l as we,e as ye,R as be}from"./ui-vendor-D_mUPHSy.js";import{r as f,u as Se}from"./react-vendor-DxF-uWSm.js";import{C as u,a as x,b as y,c as p,d as m,B as w,u as De,U as J}from"./index-Ca8S-__f.js";import{B as l}from"./badge-5BQtxz36.js";import{p as A,f as Ce,b as Ae,i as Te,c as Ee}from"./utils-vendor-1hodNj4h.js";import{B as X}from"./booking-AmzbvAEe.js";import{B as j}from"./booking-CF_xURUj.js";function Le(s){const t=s.toLowerCase();return t.includes("clear")||t.includes("sunny")?"‚òÄÔ∏è":t.includes("cloud")?"‚òÅÔ∏è":t.includes("rain")?"üåßÔ∏è":t.includes("snow")?"‚ùÑÔ∏è":t.includes("fog")||t.includes("mist")?"üå´Ô∏è":t.includes("thunder")||t.includes("storm")?"‚õàÔ∏è":t.includes("wind")?"üí®":"üå§Ô∏è"}function Re(s,t,r,d){const n=d.toLowerCase();return s<3||t>25||r<1e3||n.includes("thunder")||n.includes("ice")||n.includes("severe")?"unsafe":s<5||t>15||r<3e3||n.includes("rain")||n.includes("fog")?"caution":"safe"}function Ie(s){switch(s){case"safe":return"text-green-600 bg-green-50 border-green-200";case"caution":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"unsafe":return"text-red-600 bg-red-50 border-red-200"}}function ee(s,t="MMM d, yyyy h:mm a"){const r=typeof s=="string"?A(s):s;return Ce(r,t)}function se(s){const t=typeof s=="string"?A(s):s;return Ae(t,new Date,{addSuffix:!0})}function Me(s){const t=typeof s=="string"?A(s):s;return Te(t)}function Fe(s){const t=typeof s=="string"?A(s):s;return Ee(t)}function Ue({alerts:s=[],loading:t=!1}){const[r,d]=f.useState(s);f.useEffect(()=>{d(s)},[s]);const n=a=>{switch(a){case"critical":return e.jsx(Z,{className:"h-5 w-5 text-red-600"});case"warning":return e.jsx(Q,{className:"h-5 w-5 text-yellow-600"});case"info":return e.jsx(Y,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(Q,{className:"h-5 w-5 text-gray-600"})}},h=a=>{switch(a){case"critical":return e.jsx(l,{className:"bg-red-500",children:"Critical"});case"warning":return e.jsx(l,{className:"bg-yellow-500",children:"Warning"});case"info":return e.jsx(l,{className:"bg-blue-500",children:"Info"});default:return e.jsx(l,{variant:"outline",children:"Unknown"})}};return t?e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Weather Alerts"}),e.jsx(p,{children:"Loading weather alerts..."})]}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})})]}):r.length===0?e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Weather Alerts"}),e.jsx(p,{children:"All flights are clear of weather conflicts"})]}),e.jsx(m,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-green-600",children:[e.jsx(Y,{className:"h-12 w-12 mb-3"}),e.jsx("p",{className:"font-medium",children:"No Active Weather Alerts"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"All upcoming flights meet weather minimums"})]})})]}):e.jsxs(u,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Weather Alerts"}),e.jsxs(p,{children:[r.length," active alert",r.length>1?"s":""]})]}),e.jsx(l,{variant:"outline",className:"text-lg px-3 py-1",children:r.length})]})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:r.map(a=>{const g=Re(a.weather.visibility,a.weather.windSpeed,a.weather.ceiling,a.weather.conditions),o=Ie(g);return e.jsxs("div",{className:`border rounded-lg p-4 ${o}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(a.severity),e.jsx("h4",{className:"font-semibold",children:a.flightInfo.route})]}),h(a.severity)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Scheduled:"}),e.jsx("p",{className:"font-medium",children:ee(a.flightInfo.scheduledTime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Training Level:"}),e.jsx("p",{className:"font-medium",children:a.flightInfo.trainingLevel})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[Le(a.weather.conditions),e.jsx("span",{className:"font-medium",children:a.weather.conditions})]}),e.jsxs("span",{children:["Vis: ",a.weather.visibility,"mi"]}),e.jsxs("span",{children:["Wind: ",a.weather.windSpeed,"kt"]}),e.jsxs("span",{children:["Ceiling: ",a.weather.ceiling,"ft"]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Detected ",se(a.detectedAt)]})]},a.id)})})})]})}function Be({bookings:s=[],loading:t=!1,onViewDetails:r}){const d=a=>{switch(a){case"CONFIRMED":return e.jsx(l,{className:"bg-green-500",children:"Confirmed"});case"AT_RISK":return e.jsx(l,{className:"bg-yellow-500",children:"At Risk"});case"RESCHEDULING":return e.jsx(l,{className:"bg-blue-500",children:"Rescheduling"});case"RESCHEDULED":return e.jsx(l,{className:"bg-purple-500",children:"Rescheduled"});case"CANCELLED":return e.jsx(l,{className:"bg-gray-500",children:"Cancelled"});case"PENDING_RESCHEDULE":return e.jsx(l,{className:"bg-blue-500",children:"Pending Reschedule"});case"ESCALATED":return e.jsx(l,{className:"bg-red-500",children:"Escalated"});default:return e.jsx(l,{variant:"outline",children:a})}},n=a=>{switch(a){case"CONFIRMED":return e.jsx(W,{className:"h-5 w-5 text-green-600"});case"AT_RISK":return e.jsx(B,{className:"h-5 w-5 text-yellow-600"});case"RESCHEDULING":return e.jsx(O,{className:"h-5 w-5 text-blue-600"});case"RESCHEDULED":return e.jsx(W,{className:"h-5 w-5 text-purple-600"});case"CANCELLED":return e.jsx(B,{className:"h-5 w-5 text-gray-600"});case"PENDING_RESCHEDULE":return e.jsx(O,{className:"h-5 w-5 text-blue-600"});case"ESCALATED":return e.jsx(B,{className:"h-5 w-5 text-red-600"});default:return e.jsx(C,{className:"h-5 w-5 text-gray-600"})}},h=a=>Me(a)?e.jsx(l,{variant:"outline",className:"text-blue-600 border-blue-600",children:"Today"}):Fe(a)?e.jsx(l,{variant:"outline",className:"text-purple-600 border-purple-600",children:"Tomorrow"}):null;return t?e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Flight Status"}),e.jsx(p,{children:"Loading bookings..."})]}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})})]}):s.length===0?e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Flight Status"}),e.jsx(p,{children:"No upcoming flights scheduled"})]}),e.jsx(m,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-600",children:[e.jsx(C,{className:"h-12 w-12 mb-3"}),e.jsx("p",{className:"font-medium",children:"No Upcoming Flights"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Schedule a new flight to get started"})]})})]}):e.jsxs(u,{children:[e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(y,{children:"Flight Status"}),e.jsxs(p,{children:[s.length," upcoming flight",s.length>1?"s":""]})]})})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(a.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h4",{className:"font-semibold",children:[a.departureAirport," ‚Üí ",a.arrivalAirport]}),h(a.scheduledTime)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ee(a.scheduledTime)," (",se(a.scheduledTime),")"]})]})]}),d(a.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Student"}),e.jsx("p",{className:"font-medium",children:a.studentName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Instructor"}),e.jsx("p",{className:"font-medium",children:a.instructorName})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-4 w-4"}),a.aircraftType]}),e.jsx(l,{variant:"outline",children:a.trainingLevel})]}),r&&e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>r(a.id),children:"View Details"})]})]},a.id))})})]})}const Oe=[{label:"Total Flights",value:0,icon:e.jsx(C,{className:"h-5 w-5 text-blue-600"}),description:"Scheduled this month"},{label:"Active Alerts",value:0,icon:e.jsx(Z,{className:"h-5 w-5 text-yellow-600"}),description:"Weather conflicts detected"},{label:"Successful Reschedules",value:0,icon:e.jsx(W,{className:"h-5 w-5 text-green-600"}),description:"Completed this month"},{label:"Avg Response Time",value:"--",icon:e.jsx(O,{className:"h-5 w-5 text-purple-600"}),description:"Preference submission time"}];function We({metrics:s=Oe,loading:t=!1}){const r=n=>{switch(n){case"up":return e.jsx(we,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(ve,{className:"h-4 w-4 text-red-600"});default:return null}},d=n=>{switch(n){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return t?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(n=>e.jsxs(u,{children:[e.jsx(x,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"})}),e.jsxs(m,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-16 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-32"})]})]},n))}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:s.map((n,h)=>e.jsxs(u,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"text-sm font-medium",children:n.label}),n.icon]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.value}),n.change&&e.jsxs("div",{className:`flex items-center text-sm ${d(n.change.trend)}`,children:[r(n.change.trend),e.jsxs("span",{className:"ml-1",children:[n.change.value>0?"+":"",n.change.value,"%"]})]})]}),n.description&&e.jsx("p",{className:"text-xs text-gray-600",children:n.description})]})]},h))})}function ke({size:s="md",text:t,fullScreen:r=!1}){const d={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"},n=e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx(ye,{className:`${d[s]} animate-spin text-blue-600`}),t&&e.jsx("p",{className:"text-sm text-gray-600",children:t})]});return r?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white bg-opacity-75 z-50",children:n}):n}function Qe(){const{user:s}=De(),t=Se(),[r,d]=f.useState(!0),[n,h]=f.useState(!1),[a,g]=f.useState(new Date),[o,N]=f.useState({metrics:[],weatherAlerts:[],bookings:[]});f.useEffect(()=>{if(s){k();const c=setInterval(()=>{H()},5*60*1e3);return()=>clearInterval(c)}},[s]);const k=()=>U(this,null,function*(){try{if(d(!0),!(s!=null&&s.id)){console.error("User not available");return}const c=new Date,le=new Date(c.getFullYear(),c.getMonth(),1),ce=new Date(c.getFullYear(),c.getMonth()+1,0,23,59,59),b={startDate:le.toISOString().split("T")[0],endDate:ce.toISOString().split("T")[0],limit:100};s.role===J.STUDENT?b.studentId=s.id:s.role===J.INSTRUCTOR&&(b.instructorId=s.id);const v=yield X.listBookings(b),T=v.length,E=v.filter(i=>i.status===j.AT_RISK).length,L=v.filter(i=>i.status===j.RESCHEDULED).length,de=v.filter(i=>i.status===j.CONFIRMED).length,oe=new Date(c.getFullYear(),c.getMonth()-1,1),he=new Date(c.getFullYear(),c.getMonth(),0,23,59,59),ue=G(V({},b),{startDate:oe.toISOString().split("T")[0],endDate:he.toISOString().split("T")[0]});let S=[];try{S=yield X.listBookings(ue)}catch(i){console.warn("Could not fetch previous month data:",i)}const R=S.length,I=S.filter(i=>i.status===j.AT_RISK).length,M=S.filter(i=>i.status===j.RESCHEDULED).length,$=R>0?Math.round((T-R)/R*100):T>0?100:0,P=I>0?Math.round((E-I)/I*100):E>0?100:0,_=M>0?Math.round((L-M)/M*100):L>0?100:0,F=new Date;F.setDate(F.getDate()+7);const xe=v.filter(i=>{const D=new Date(i.scheduledDatetime);return D>=c&&D<=F&&i.status!==j.CANCELLED}).sort((i,D)=>new Date(i.scheduledDatetime).getTime()-new Date(D.scheduledDatetime).getTime()).slice(0,5).map(i=>({id:i.id,scheduledTime:i.scheduledDatetime,status:i.status,departureAirport:i.departureAirport,arrivalAirport:i.arrivalAirport,studentName:"Student",instructorName:"Instructor",aircraftType:i.aircraftId||"N/A",trainingLevel:i.trainingLevel})),me=v.filter(i=>i.status===j.AT_RISK).map(i=>({id:i.id,bookingId:i.id,flightInfo:{scheduledTime:i.scheduledDatetime,route:`${i.departureAirport} ‚Üí ${i.arrivalAirport}`,trainingLevel:i.trainingLevel},weather:{visibility:0,windSpeed:0,ceiling:0,conditions:"Unknown"},severity:"warning",detectedAt:i.updatedAt}));N({metrics:[{label:"Total Flights",value:T,change:{value:Math.abs($),trend:$>=0?"up":"down"},description:"Scheduled this month"},{label:"Active Alerts",value:E,change:{value:Math.abs(P),trend:P<=0?"down":"up"},description:"Weather conflicts detected"},{label:"Successful Reschedules",value:L,change:{value:Math.abs(_),trend:_>=0?"up":"down"},description:"Completed this month"},{label:"Confirmed Flights",value:de,change:{value:0,trend:"neutral"},description:"Ready to fly"}],weatherAlerts:me,bookings:xe}),g(new Date)}catch(c){console.error("Failed to load dashboard data:",c),N({metrics:[],weatherAlerts:[],bookings:[]})}finally{d(!1)}}),H=()=>U(this,null,function*(){try{h(!0),yield k()}finally{h(!1)}}),te=c=>{t(`/bookings/${c}`)},ae=()=>{t("/bookings/new")},re=()=>{t("/availability")},ne=()=>{t("/bookings")},ie=()=>{t("/settings")};return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ke,{size:"lg",text:"Loading dashboard..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Welcome back, ",(s==null?void 0:s.name)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"User"]})]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:H,disabled:n,children:[e.jsx(be,{className:`h-4 w-4 mr-2 ${n?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Last updated: ",a.toLocaleTimeString()]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsx(We,{metrics:o.metrics}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(Ue,{alerts:o.weatherAlerts}),e.jsx(Be,{bookings:o.bookings,onViewDetails:te})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx(w,{onClick:ae,children:"Schedule New Flight"}),e.jsx(w,{variant:"outline",onClick:re,children:"Manage Availability"}),e.jsx(w,{variant:"outline",onClick:ne,children:"View All Bookings"}),e.jsx(w,{variant:"outline",onClick:ie,children:"System Settings"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-pulse"}),e.jsx("p",{className:"text-sm font-medium",children:"Weather monitoring active ‚Ä¢ Checking every 10 minutes"})]})})]})]})}export{Qe as Dashboard};
