var ge=Object.defineProperty,je=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var z=(s,t,r)=>t in s?ge(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,K=(s,t)=>{for(var r in t||(t={}))pe.call(t,r)&&z(s,r,t[r]);if(_)for(var r of _(t))Ne.call(t,r)&&z(s,r,t[r]);return s},V=(s,t)=>je(s,fe(t));var B=(s,t,r)=>new Promise((c,n)=>{var h=o=>{try{g(r.next(o))}catch(p){n(p)}},a=o=>{try{g(r.throw(o))}catch(p){n(p)}},g=o=>o.done?c(o.value):Promise.resolve(o.value).then(h,a);g((r=r.apply(s,t)).next())});import{j as e,e as Y,f as H,T as J,P as C,U as G,g as U,h as X,i as Z,k as ve,l as we,d as ye,R as be}from"./ui-vendor-iMAx8RKE.js";import{r as j,u as Se}from"./react-vendor-DxF-uWSm.js";import{C as u,a as m,b as w,c as f,d as x,B as v,u as Ae,U as Q}from"./index-DNHHiPRd.js";import{B as d}from"./badge-Djgs40xq.js";import{p as D,f as Ce,b as De,i as Te,c as Ie}from"./utils-vendor-1hodNj4h.js";import{B as q}from"./booking-CxIcC8_S.js";import{B as y}from"./booking-CEus6Bct.js";function Le(s){const t=s.toLowerCase();return t.includes("clear")||t.includes("sunny")?"‚òÄÔ∏è":t.includes("cloud")?"‚òÅÔ∏è":t.includes("rain")?"üåßÔ∏è":t.includes("snow")?"‚ùÑÔ∏è":t.includes("fog")||t.includes("mist")?"üå´Ô∏è":t.includes("thunder")||t.includes("storm")?"‚õàÔ∏è":t.includes("wind")?"üí®":"üå§Ô∏è"}function Ee(s,t,r,c){const n=c.toLowerCase();return s<3||t>25||r<1e3||n.includes("thunder")||n.includes("ice")||n.includes("severe")?"unsafe":s<5||t>15||r<3e3||n.includes("rain")||n.includes("fog")?"caution":"safe"}function Re(s){switch(s){case"safe":return"text-green-600 bg-green-50 border-green-200";case"caution":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"unsafe":return"text-red-600 bg-red-50 border-red-200"}}function ee(s,t="MMM d, yyyy h:mm a"){const r=typeof s=="string"?D(s):s;return Ce(r,t)}function se(s){const t=typeof s=="string"?D(s):s;return De(t,new Date,{addSuffix:!0})}function Me(s){const t=typeof s=="string"?D(s):s;return Te(t)}function Fe(s){const t=typeof s=="string"?D(s):s;return Ie(t)}function Be({alerts:s=[],loading:t=!1}){const[r,c]=j.useState(s);j.useEffect(()=>{c(s)},[s]);const n=a=>{switch(a){case"critical":return e.jsx(J,{className:"h-5 w-5 text-red-600"});case"warning":return e.jsx(H,{className:"h-5 w-5 text-yellow-600"});case"info":return e.jsx(Y,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(H,{className:"h-5 w-5 text-gray-600"})}},h=a=>{switch(a){case"critical":return e.jsx(d,{className:"bg-red-500",children:"Critical"});case"warning":return e.jsx(d,{className:"bg-yellow-500",children:"Warning"});case"info":return e.jsx(d,{className:"bg-blue-500",children:"Info"});default:return e.jsx(d,{variant:"outline",children:"Unknown"})}};return t?e.jsxs(u,{children:[e.jsxs(m,{children:[e.jsx(w,{children:"Weather Alerts"}),e.jsx(f,{children:"Loading weather alerts..."})]}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})})]}):r.length===0?e.jsxs(u,{children:[e.jsxs(m,{children:[e.jsx(w,{children:"Weather Alerts"}),e.jsx(f,{children:"All flights are clear of weather conflicts"})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-green-600",children:[e.jsx(Y,{className:"h-12 w-12 mb-3"}),e.jsx("p",{className:"font-medium",children:"No Active Weather Alerts"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"All upcoming flights meet weather minimums"})]})})]}):e.jsxs(u,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(w,{children:"Weather Alerts"}),e.jsxs(f,{children:[r.length," active alert",r.length>1?"s":""]})]}),e.jsx(d,{variant:"outline",className:"text-lg px-3 py-1",children:r.length})]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:r.map(a=>{const g=Ee(a.weather.visibility,a.weather.windSpeed,a.weather.ceiling,a.weather.conditions),o=Re(g);return e.jsxs("div",{className:`border rounded-lg p-4 ${o}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(a.severity),e.jsx("h4",{className:"font-semibold",children:a.flightInfo.route})]}),h(a.severity)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Scheduled:"}),e.jsx("p",{className:"font-medium",children:ee(a.flightInfo.scheduledTime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Training Level:"}),e.jsx("p",{className:"font-medium",children:a.flightInfo.trainingLevel})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[Le(a.weather.conditions),e.jsx("span",{className:"font-medium",children:a.weather.conditions})]}),e.jsxs("span",{children:["Vis: ",a.weather.visibility,"mi"]}),e.jsxs("span",{children:["Wind: ",a.weather.windSpeed,"kt"]}),e.jsxs("span",{children:["Ceiling: ",a.weather.ceiling,"ft"]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Detected ",se(a.detectedAt)]})]},a.id)})})})]})}function Ue({bookings:s=[],loading:t=!1,onViewDetails:r}){const c=a=>{switch(a){case"CONFIRMED":return e.jsx(d,{className:"bg-green-500",children:"Confirmed"});case"AT_RISK":return e.jsx(d,{className:"bg-yellow-500",children:"At Risk"});case"CANCELLED":return e.jsx(d,{className:"bg-gray-500",children:"Cancelled"});case"PENDING_RESCHEDULE":return e.jsx(d,{className:"bg-blue-500",children:"Pending Reschedule"});case"ESCALATED":return e.jsx(d,{className:"bg-red-500",children:"Escalated"});default:return e.jsx(d,{variant:"outline",children:a})}},n=a=>{switch(a){case"CONFIRMED":return e.jsx(Z,{className:"h-5 w-5 text-green-600"});case"AT_RISK":return e.jsx(U,{className:"h-5 w-5 text-yellow-600"});case"CANCELLED":return e.jsx(U,{className:"h-5 w-5 text-gray-600"});case"PENDING_RESCHEDULE":return e.jsx(X,{className:"h-5 w-5 text-blue-600"});case"ESCALATED":return e.jsx(U,{className:"h-5 w-5 text-red-600"});default:return e.jsx(C,{className:"h-5 w-5 text-gray-600"})}},h=a=>Me(a)?e.jsx(d,{variant:"outline",className:"text-blue-600 border-blue-600",children:"Today"}):Fe(a)?e.jsx(d,{variant:"outline",className:"text-purple-600 border-purple-600",children:"Tomorrow"}):null;return t?e.jsxs(u,{children:[e.jsxs(m,{children:[e.jsx(w,{children:"Flight Status"}),e.jsx(f,{children:"Loading bookings..."})]}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})})]}):s.length===0?e.jsxs(u,{children:[e.jsxs(m,{children:[e.jsx(w,{children:"Flight Status"}),e.jsx(f,{children:"No upcoming flights scheduled"})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-600",children:[e.jsx(C,{className:"h-12 w-12 mb-3"}),e.jsx("p",{className:"font-medium",children:"No Upcoming Flights"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Schedule a new flight to get started"})]})})]}):e.jsxs(u,{children:[e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(w,{children:"Flight Status"}),e.jsxs(f,{children:[s.length," upcoming flight",s.length>1?"s":""]})]})})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:s.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(a.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h4",{className:"font-semibold",children:[a.departureAirport," ‚Üí ",a.arrivalAirport]}),h(a.scheduledTime)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ee(a.scheduledTime)," (",se(a.scheduledTime),")"]})]})]}),c(a.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Student"}),e.jsx("p",{className:"font-medium",children:a.studentName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Instructor"}),e.jsx("p",{className:"font-medium",children:a.instructorName})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-4 w-4"}),a.aircraftType]}),e.jsx(d,{variant:"outline",children:a.trainingLevel})]}),r&&e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>r(a.id),children:"View Details"})]})]},a.id))})})]})}const ke=[{label:"Total Flights",value:0,icon:e.jsx(C,{className:"h-5 w-5 text-blue-600"}),description:"Scheduled this month"},{label:"Active Alerts",value:0,icon:e.jsx(J,{className:"h-5 w-5 text-yellow-600"}),description:"Weather conflicts detected"},{label:"Successful Reschedules",value:0,icon:e.jsx(Z,{className:"h-5 w-5 text-green-600"}),description:"Completed this month"},{label:"Avg Response Time",value:"--",icon:e.jsx(X,{className:"h-5 w-5 text-purple-600"}),description:"Preference submission time"}];function Oe({metrics:s=ke,loading:t=!1}){const r=n=>{switch(n){case"up":return e.jsx(we,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(ve,{className:"h-4 w-4 text-red-600"});default:return null}},c=n=>{switch(n){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return t?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(n=>e.jsxs(u,{children:[e.jsx(m,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"})}),e.jsxs(x,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-16 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-32"})]})]},n))}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:s.map((n,h)=>e.jsxs(u,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-sm font-medium",children:n.label}),n.icon]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("div",{className:"text-2xl font-bold",children:n.value}),n.change&&e.jsxs("div",{className:`flex items-center text-sm ${c(n.change.trend)}`,children:[r(n.change.trend),e.jsxs("span",{className:"ml-1",children:[n.change.value>0?"+":"",n.change.value,"%"]})]})]}),n.description&&e.jsx("p",{className:"text-xs text-gray-600",children:n.description})]})]},h))})}function We({size:s="md",text:t,fullScreen:r=!1}){const c={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"},n=e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx(ye,{className:`${c[s]} animate-spin text-blue-600`}),t&&e.jsx("p",{className:"text-sm text-gray-600",children:t})]});return r?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white bg-opacity-75 z-50",children:n}):n}function Qe(){const{user:s}=Ae(),t=Se(),[r,c]=j.useState(!0),[n,h]=j.useState(!1),[a,g]=j.useState(new Date),[o,p]=j.useState({metrics:[],weatherAlerts:[],bookings:[]});j.useEffect(()=>{if(s){k();const l=setInterval(()=>{O()},5*60*1e3);return()=>clearInterval(l)}},[s]);const k=()=>B(this,null,function*(){try{if(c(!0),!(s!=null&&s.id)){console.error("User not available");return}const l=new Date,le=new Date(l.getFullYear(),l.getMonth(),1),ce=new Date(l.getFullYear(),l.getMonth()+1,0,23,59,59),b={startDate:le.toISOString().split("T")[0],endDate:ce.toISOString().split("T")[0],limit:100};s.role===Q.STUDENT?b.studentId=s.id:s.role===Q.INSTRUCTOR&&(b.instructorId=s.id);const N=yield q.listBookings(b),T=N.length,I=N.filter(i=>i.status===y.AT_RISK).length,L=N.filter(i=>i.originalBookingId).length,de=N.filter(i=>i.status===y.CONFIRMED).length,oe=new Date(l.getFullYear(),l.getMonth()-1,1),he=new Date(l.getFullYear(),l.getMonth(),0,23,59,59),ue=V(K({},b),{startDate:oe.toISOString().split("T")[0],endDate:he.toISOString().split("T")[0]});let S=[];try{S=yield q.listBookings(ue)}catch(i){console.warn("Could not fetch previous month data:",i)}const E=S.length,R=S.filter(i=>i.status===y.AT_RISK).length,M=S.filter(i=>i.originalBookingId).length,W=E>0?Math.round((T-E)/E*100):T>0?100:0,$=R>0?Math.round((I-R)/R*100):I>0?100:0,P=M>0?Math.round((L-M)/M*100):L>0?100:0,F=new Date;F.setDate(F.getDate()+7);const me=N.filter(i=>{const A=new Date(i.scheduledDatetime);return A>=l&&A<=F&&i.status!==y.CANCELLED}).sort((i,A)=>new Date(i.scheduledDatetime).getTime()-new Date(A.scheduledDatetime).getTime()).slice(0,5).map(i=>({id:i.id,scheduledTime:i.scheduledDatetime,status:i.status,departureAirport:i.departureAirport,arrivalAirport:i.arrivalAirport,studentName:"Student",instructorName:"Instructor",aircraftType:i.aircraftId||"N/A",trainingLevel:i.trainingLevel})),xe=N.filter(i=>i.status===y.AT_RISK).map(i=>({id:i.id,bookingId:i.id,flightInfo:{scheduledTime:i.scheduledDatetime,route:`${i.departureAirport} ‚Üí ${i.arrivalAirport}`,trainingLevel:i.trainingLevel},weather:{visibility:0,windSpeed:0,ceiling:0,conditions:"Unknown"},severity:"warning",detectedAt:i.updatedAt}));p({metrics:[{label:"Total Flights",value:T,change:{value:Math.abs(W),trend:W>=0?"up":"down"},description:"Scheduled this month"},{label:"Active Alerts",value:I,change:{value:Math.abs($),trend:$<=0?"down":"up"},description:"Weather conflicts detected"},{label:"Successful Reschedules",value:L,change:{value:Math.abs(P),trend:P>=0?"up":"down"},description:"Completed this month"},{label:"Confirmed Flights",value:de,change:{value:0,trend:"neutral"},description:"Ready to fly"}],weatherAlerts:xe,bookings:me}),g(new Date)}catch(l){console.error("Failed to load dashboard data:",l),p({metrics:[],weatherAlerts:[],bookings:[]})}finally{c(!1)}}),O=()=>B(this,null,function*(){try{h(!0),yield k()}finally{h(!1)}}),te=l=>{t(`/bookings/${l}`)},ae=()=>{t("/bookings/new")},re=()=>{t("/availability")},ne=()=>{t("/bookings")},ie=()=>{t("/settings")};return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(We,{size:"lg",text:"Loading dashboard..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Welcome back, ",(s==null?void 0:s.name)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"User"]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:O,disabled:n,children:[e.jsx(be,{className:`h-4 w-4 mr-2 ${n?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Last updated: ",a.toLocaleTimeString()]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsx(Oe,{metrics:o.metrics}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(Be,{alerts:o.weatherAlerts}),e.jsx(Ue,{bookings:o.bookings,onViewDetails:te})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx(v,{onClick:ae,children:"Schedule New Flight"}),e.jsx(v,{variant:"outline",onClick:re,children:"Manage Availability"}),e.jsx(v,{variant:"outline",onClick:ne,children:"View All Bookings"}),e.jsx(v,{variant:"outline",onClick:ie,children:"System Settings"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-pulse"}),e.jsx("p",{className:"text-sm font-medium",children:"Weather monitoring active ‚Ä¢ Checking every 10 minutes"})]})})]})]})}export{Qe as Dashboard};
