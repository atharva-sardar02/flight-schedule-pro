var we=Object.defineProperty,Ce=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var ae=(s,i,a)=>i in s?we(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,S=(s,i)=>{for(var a in i||(i={}))ne.call(i,a)&&ae(s,a,i[a]);if(K)for(var a of K(i))ie.call(i,a)&&ae(s,a,i[a]);return s},M=(s,i)=>Ce(s,ke(i));var F=(s,i)=>{var a={};for(var d in s)ne.call(s,d)&&i.indexOf(d)<0&&(a[d]=s[d]);if(s!=null&&K)for(var d of K(s))i.indexOf(d)<0&&ie.call(s,d)&&(a[d]=s[d]);return a};var P=(s,i,a)=>new Promise((d,l)=>{var f=c=>{try{o(a.next(c))}catch(m){l(m)}},x=c=>{try{o(a.throw(c))}catch(m){l(m)}},o=c=>c.done?d(c.value):Promise.resolve(c.value).then(f,x);o((a=a.apply(s,i)).next())});import{j as e,e as V,C as G,n as X,g as Ie,o as Se,p as Ee,q as ee,u as Oe,r as he,s as le,t as Re,v as De,G as Ae,a as Me,i as Pe,T as Be,R as ce,h as de,w as oe,A as _e}from"./ui-vendor-D_mUPHSy.js";import{r as h,f as Te,u as Fe,L as Z}from"./react-vendor-DxF-uWSm.js";import{g as L,s as W,B as O,C as B,a as $,b as U,c as J,d as _,f as me}from"./index-Ca8S-__f.js";import{B as A}from"./badge-5BQtxz36.js";import{A as q,a as z}from"./alert-DdpxRBSI.js";import{g as xe,a as Le,b as We,c as qe,s as ze,d as Ge}from"./rescheduling-B4SHQ7oq.js";import{f as E}from"./utils-vendor-1hodNj4h.js";import{B as $e}from"./booking-AmzbvAEe.js";function Ue({bookingId:s,onOptionsLoaded:i,onContinue:a}){const[d,l]=h.useState([]),[f,x]=h.useState(!0),[o,c]=h.useState(!1),[m,j]=h.useState(null);h.useEffect(()=>{N()},[s]);const N=()=>P(this,null,function*(){try{x(!0),j(null);const r=yield xe(s);l(r),i&&i(r)}catch(r){const b=L(r);j(b.message),W(r,"load-reschedule-options")}finally{x(!1)}}),C=()=>P(this,null,function*(){try{c(!0),j(null);const r=yield Le(s);l(r),i&&i(r)}catch(r){const b=L(r);j(b.message),W(r,"generate-reschedule-options")}finally{c(!1)}}),v=r=>r>=.8?e.jsx(A,{className:"bg-green-500",children:"High Confidence"}):r>=.6?e.jsx(A,{className:"bg-yellow-500",children:"Medium Confidence"}):e.jsx(A,{className:"bg-orange-500",children:"Low Confidence"}),w=r=>r>=.8?e.jsx(A,{className:"bg-blue-500",children:"Excellent Weather"}):r>=.6?e.jsx(A,{className:"bg-blue-400",children:"Good Weather"}):e.jsx(A,{className:"bg-gray-500",children:"Fair Weather"});return f?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(V,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading options..."})]}):m?e.jsx(q,{variant:"destructive",children:e.jsxs(z,{children:[e.jsx("p",{className:"mb-2",children:m}),e.jsx(O,{onClick:N,variant:"outline",size:"sm",children:"Retry"})]})}):d.length===0?e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(U,{children:"No Reschedule Options"}),e.jsx(J,{children:"Generate new options using our AI scheduling assistant."})]}),e.jsx(_,{children:e.jsxs(O,{onClick:C,disabled:o,children:[o&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Options"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Reschedule Options"}),e.jsxs(O,{onClick:C,disabled:o,variant:"outline",size:"sm",children:[o&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerate"]})]}),e.jsx("div",{className:"grid gap-4",children:d.map((r,b)=>e.jsxs(B,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(U,{className:"text-base",children:["Option ",b+1]}),e.jsxs("div",{className:"flex gap-2",children:[v(r.confidence),w(r.weatherScore)]})]})}),e.jsxs(_,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:E(new Date(r.suggestedDatetime),"EEEE, MMMM d, yyyy")}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["at ",E(new Date(r.suggestedDatetime),"h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[r.departureAirport," → ",r.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700",children:r.reasoning})})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("span",{children:["Weather Score: ",(r.weatherScore*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Confidence: ",(r.confidence*100).toFixed(0),"%"]})]})]})]},r.id))}),a&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(O,{onClick:a,size:"lg",children:"Continue to Preferences"})})]})}function He(s){const i=h.useRef({value:s,previous:s});return h.useMemo(()=>(i.current.value!==s&&(i.current.previous=i.current.value,i.current.value=s),i.current.previous),[s])}var Q="Checkbox",[Ye]=Se(Q),[Ke,se]=Ye(Q);function Ve(s){const{__scopeCheckbox:i,checked:a,children:d,defaultChecked:l,disabled:f,form:x,name:o,onCheckedChange:c,required:m,value:j="on",internal_do_not_use_render:N}=s,[C,v]=Oe({prop:a,defaultProp:l!=null?l:!1,onChange:c,caller:Q}),[w,r]=h.useState(null),[b,k]=h.useState(null),R=h.useRef(!1),t=w?!!x||!!w.closest("form"):!0,n={checked:C,disabled:f,setChecked:v,control:w,setControl:r,name:o,form:x,value:j,hasConsumerStoppedPropagationRef:R,required:m,defaultChecked:T(l)?!1:l,isFormControl:t,bubbleInput:b,setBubbleInput:k};return e.jsx(Ke,M(S({scope:i},n),{children:Xe(N)?N(n):d}))}var ue="CheckboxTrigger",fe=h.forwardRef((f,l)=>{var x=f,{__scopeCheckbox:s,onKeyDown:i,onClick:a}=x,d=F(x,["__scopeCheckbox","onKeyDown","onClick"]);const{control:o,value:c,disabled:m,checked:j,required:N,setControl:C,setChecked:v,hasConsumerStoppedPropagationRef:w,isFormControl:r,bubbleInput:b}=se(ue,s),k=he(l,C),R=h.useRef(j);return h.useEffect(()=>{const t=o==null?void 0:o.form;if(t){const n=()=>v(R.current);return t.addEventListener("reset",n),()=>t.removeEventListener("reset",n)}},[o,v]),e.jsx(ee.button,M(S({type:"button",role:"checkbox","aria-checked":T(j)?"mixed":j,"aria-required":N,"data-state":Ne(j),"data-disabled":m?"":void 0,disabled:m,value:c},d),{ref:k,onKeyDown:le(i,t=>{t.key==="Enter"&&t.preventDefault()}),onClick:le(a,t=>{v(n=>T(n)?!0:!n),b&&r&&(w.current=t.isPropagationStopped(),w.current||t.stopPropagation())})}))});fe.displayName=ue;var te=h.forwardRef((s,i)=>{const C=s,{__scopeCheckbox:a,name:d,checked:l,defaultChecked:f,required:x,disabled:o,value:c,onCheckedChange:m,form:j}=C,N=F(C,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(Ve,{__scopeCheckbox:a,checked:l,defaultChecked:f,disabled:o,required:x,onCheckedChange:m,name:d,form:j,value:c,internal_do_not_use_render:({isFormControl:v})=>e.jsxs(e.Fragment,{children:[e.jsx(fe,M(S({},N),{ref:i,__scopeCheckbox:a})),v&&e.jsx(be,{__scopeCheckbox:a})]})})});te.displayName=Q;var pe="CheckboxIndicator",ge=h.forwardRef((s,i)=>{const x=s,{__scopeCheckbox:a,forceMount:d}=x,l=F(x,["__scopeCheckbox","forceMount"]),f=se(pe,a);return e.jsx(Ee,{present:d||T(f.checked)||f.checked===!0,children:e.jsx(ee.span,M(S({"data-state":Ne(f.checked),"data-disabled":f.disabled?"":void 0},l),{ref:i,style:S({pointerEvents:"none"},s.style)}))})});ge.displayName=pe;var je="CheckboxBubbleInput",be=h.forwardRef((d,a)=>{var l=d,{__scopeCheckbox:s}=l,i=F(l,["__scopeCheckbox"]);const{control:f,hasConsumerStoppedPropagationRef:x,checked:o,defaultChecked:c,required:m,disabled:j,name:N,value:C,form:v,bubbleInput:w,setBubbleInput:r}=se(je,s),b=he(a,r),k=He(o),R=Re(f);h.useEffect(()=>{const n=w;if(!n)return;const y=window.HTMLInputElement.prototype,H=Object.getOwnPropertyDescriptor(y,"checked").set,p=!x.current;if(k!==o&&H){const g=new Event("click",{bubbles:p});n.indeterminate=T(o),H.call(n,T(o)?!1:o),n.dispatchEvent(g)}},[w,k,o,x]);const t=h.useRef(T(o)?!1:o);return e.jsx(ee.input,M(S({type:"checkbox","aria-hidden":!0,defaultChecked:c!=null?c:t.current,required:m,disabled:j,name:N,value:C,form:v},i),{tabIndex:-1,ref:b,style:M(S(S({},i.style),R),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});be.displayName=je;function Xe(s){return typeof s=="function"}function T(s){return s==="indeterminate"}function Ne(s){return T(s)?"indeterminate":s?"checked":"unchecked"}const ve=h.forwardRef((d,a)=>{var l=d,{className:s}=l,i=F(l,["className"]);return e.jsx(te,M(S({ref:a,className:me("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},i),{children:e.jsx(ge,{className:me("grid place-content-center text-current"),children:e.jsx(De,{className:"h-4 w-4"})})}))});ve.displayName=te.displayName;function Je({options:s,onSubmit:i,loading:a=!1,existingRanking:d}){const[l,f]=h.useState([null,null,null]),[x,o]=h.useState(new Set),[c,m]=h.useState(null);h.useEffect(()=>{if(d&&s.length>0){const t=[null,null,null];d.option1Id&&(t[0]=s.find(n=>n.id===d.option1Id)||null),d.option2Id&&(t[1]=s.find(n=>n.id===d.option2Id)||null),d.option3Id&&(t[2]=s.find(n=>n.id===d.option3Id)||null),f(t),o(new Set(d.unavailableOptionIds||[]))}},[d,s]);const j=s.filter(t=>!l.some(n=>(n==null?void 0:n.id)===t.id)&&!x.has(t.id)),N=t=>{m(t)},C=t=>{t.preventDefault()},v=t=>{if(c===null)return;const n=[...l],y=l[c];n[c]=n[t],n[t]=y,f(n),m(null)},w=(t,n)=>{const y=[...l];y[n]=t,f(y)},r=t=>{const n=[...l];n[t]=null,f(n)},b=t=>{const n=new Set(x);n.has(t)?n.delete(t):(n.add(t),f(l.map(y=>(y==null?void 0:y.id)===t?null:y))),o(n)},k=()=>{var t,n,y;i({option1Id:(t=l[0])==null?void 0:t.id,option2Id:(n=l[1])==null?void 0:n.id,option3Id:(y=l[2])==null?void 0:y.id,unavailableOptionIds:Array.from(x)})},R=l.some(t=>t!==null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(U,{children:"Rank Your Preferences"}),e.jsx(J,{children:"Drag options to rank them in order of preference, or mark options as unavailable. Your #1 choice will be given the highest weight in the final selection."})]}),e.jsx(_,{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:l.map((t,n)=>e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] bg-gray-50",onDragOver:C,onDrop:()=>v(n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[n===0?"1st":n===1?"2nd":"3rd"," Choice"]}),t&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(n),children:"Remove"})]}),t?e.jsx("div",{className:"bg-white border rounded-lg p-3 cursor-move",draggable:!0,onDragStart:()=>N(n),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-gray-500"}),E(new Date(t.suggestedDatetime),"EEE, MMM d")," at"," ",E(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(X,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]})]})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Drag an option here or select from below"})]},n))})})]}),e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(U,{children:"Available Options"}),e.jsx(J,{children:"Select options to add to your ranking, or mark them as unavailable."})]}),e.jsxs(_,{children:[j.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"All options have been ranked or marked unavailable"}):e.jsx("div",{className:"space-y-2",children:j.map((t,n)=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{id:`unavailable-${t.id}`,checked:x.has(t.id),onCheckedChange:()=>b(t.id)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-gray-500"}),E(new Date(t.suggestedDatetime),"EEEE, MMMM d, yyyy")," at"," ",E(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(X,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.reasoning}),e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(y=>e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>w(t,y),disabled:l[y]!==null,children:["Set as #",y+1]},y))})]})]})},t.id))}),x.size>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Unavailable Options"]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>x.has(t.id)).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 p-2 bg-gray-100 rounded",children:[e.jsx("span",{children:E(new Date(t.suggestedDatetime),"MMM d, h:mm a")}),e.jsx(O,{size:"sm",variant:"ghost",onClick:()=>b(t.id),children:"Mark Available"})]},t.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{onClick:k,disabled:!R||a,size:"lg",children:a?"Submitting...":"Submit Preferences"})}),!R&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please rank at least one option before submitting"})]})}function Qe({bookingDetails:s,oldScheduledTime:i,newScheduledTime:a,route:d,onConfirm:l,onCancel:f,onRequestNewOptions:x,loading:o=!1}){const[c,m]=h.useState(!1),[j,N]=h.useState(null),C=new Date(i),v=new Date(a),w=()=>P(this,null,function*(){try{m(!0),N(null);const r=yield l();r.success||(r.requiresNewOptions?N({message:r.error||"Weather conditions have changed",requiresNewOptions:!0}):N({message:r.error||"Failed to confirm reschedule",requiresNewOptions:!1}))}catch(r){const b=L(r);N({message:b.message,requiresNewOptions:!1}),W(r,"confirm-reschedule")}finally{m(!1)}});return e.jsxs("div",{className:"space-y-6",children:[!j&&e.jsx(B,{className:"bg-green-50 border-green-200",children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-green-800",children:[e.jsx(Pe,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ready to Confirm Reschedule"}),e.jsx("p",{className:"text-sm",children:"Weather will be re-validated before final confirmation"})]})]})})}),j&&e.jsxs(q,{variant:"destructive",children:[e.jsx(Be,{className:"h-5 w-5"}),e.jsxs(z,{children:[e.jsx("p",{className:"font-semibold mb-2",children:j.message}),j.requiresNewOptions&&e.jsx("p",{className:"text-sm mb-3",children:"The selected time slot no longer meets weather requirements. New options need to be generated."}),j.requiresNewOptions&&x&&e.jsxs(O,{onClick:x,variant:"outline",size:"sm",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Generate New Options"]})]})]}),e.jsxs(B,{children:[e.jsxs($,{children:[e.jsx(U,{children:"Schedule Change Summary"}),e.jsx(J,{children:"Review the details of your rescheduled flight"})]}),e.jsxs(_,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{variant:"outline",children:"Original Time"})}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),E(C,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),E(C,"h:mm a")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{className:"bg-green-500",children:"New Time"})}),e.jsxs("div",{className:"p-4 bg-green-100 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-1 font-medium",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),E(v,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-green-800 font-medium",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),E(v,"h:mm a")]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Flight Details"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Route:"}),e.jsxs("span",{className:"text-sm font-medium",children:[d.departureAirport," → ",d.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Student:"}),e.jsx("span",{className:"text-sm font-medium",children:s.studentName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Instructor:"}),e.jsx("span",{className:"text-sm font-medium",children:s.instructorName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Aircraft:"}),e.jsx("span",{className:"text-sm font-medium",children:s.aircraftType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Training Level:"}),e.jsx(A,{variant:"outline",children:s.trainingLevel})]})]})]}),e.jsxs("div",{className:"border-t pt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather will be checked immediately before confirmation"}),e.jsxs("div",{className:"flex gap-3",children:[f&&e.jsx(O,{variant:"outline",onClick:f,disabled:c,children:"Cancel"}),e.jsx(O,{onClick:w,disabled:c||o,children:c?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating Weather..."]}):"Confirm Reschedule"})]})]})]})]}),e.jsx(B,{className:"bg-blue-50 border-blue-200",children:e.jsx(_,{className:"pt-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What Happens Next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Weather conditions will be re-validated in real-time"}),e.jsx("li",{children:"If conditions are suitable, the booking will be updated"}),e.jsx("li",{children:"Both student and instructor will receive email confirmation"}),e.jsx("li",{children:"Weather monitoring will continue for the new time slot"})]})]})})})]})}function cs(){const{bookingId:s}=Te(),i=Fe(),[a,d]=h.useState(null),[l,f]=h.useState([]),[x,o]=h.useState(null),[c,m]=h.useState("options"),[j,N]=h.useState(!0),[C,v]=h.useState(!1),[w,r]=h.useState(null),[b,k]=h.useState(null),[R,t]=h.useState(!1);h.useEffect(()=>{s&&n()},[s]);const n=()=>P(this,null,function*(){if(s)try{N(!0),r(null);const p=yield $e.getBooking(s);d(p);try{const g=yield xe(s);f(g);try{const u=yield We(s);if(u.preference){k({option1Id:u.preference.option1Id,option2Id:u.preference.option2Id,option3Id:u.preference.option3Id,unavailableOptionIds:u.preference.unavailableOptionIds||[]});const D=u.preference.option1Id||u.preference.option2Id||u.preference.option3Id;if(D&&g.length>0){const I=g.find(Y=>Y.id===D);I?(o(I),m("confirmation")):m("preferences")}else g.length>0&&m("options")}else g.length>0&&m("options")}catch(u){g.length>0&&m("options")}}catch(g){m("options")}}catch(p){const g=L(p);r(g.message),W(p,"load-booking")}finally{N(!1)}});h.useEffect(()=>{P(this,null,function*(){if(!(!s||c!=="preferences"||l.length===0))try{const g=yield qe(s),u=g.find(I=>I.submittedAt),D=g.length>=2&&g.every(I=>I.submittedAt);if(u&&!D)t(!0),(u.option1Id||u.option2Id||u.option3Id)&&k({option1Id:u.option1Id,option2Id:u.option2Id,option3Id:u.option3Id,unavailableOptionIds:u.unavailableOptionIds||[]});else if(D&&u){const I=u.option1Id||u.option2Id||u.option3Id;if(I){const Y=l.find(ye=>ye.id===I);Y&&(o(Y),m("confirmation"))}}}catch(g){}})},[s,c,l]);const y=p=>{if(f(p),p.length>0&&b){const g=b.option1Id||b.option2Id||b.option3Id;if(g){const u=p.find(D=>D.id===g);u?(o(u),m("confirmation")):m("preferences")}else m("preferences")}},re=p=>P(this,null,function*(){if(s)try{v(!0),r(null);const g=yield ze(S({bookingId:s},p));k(p);const u=p.option1Id||p.option2Id||p.option3Id;if(u){const D=l.find(I=>I.id===u);D&&(o(D),g.bothSubmitted?(m("confirmation"),t(!1)):(r(null),t(!0)))}}catch(g){const u=L(g);r(u.message),W(g,"submit-preferences")}finally{v(!1)}}),H=()=>P(this,null,function*(){if(!s||!x)return{success:!1,error:"Missing booking ID or selected option"};try{v(!0),r(null);const p=yield Ge(s);return p.success?(i(`/bookings/${s}`),{success:!0}):p.requiresNewOptions?(r(p.error||"Weather conditions have changed. Please generate new options."),m("options"),{success:!1,error:p.error,requiresNewOptions:!0}):(r(p.error||"Failed to confirm reschedule"),{success:!1,error:p.error})}catch(p){const g=L(p);return r(g.message),W(p,"confirm-reschedule"),{success:!1,error:g.message}}finally{v(!1)}});return j?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(V,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]}):w&&!a?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(q,{variant:"destructive",children:e.jsx(z,{children:w})}),e.jsx("div",{className:"mt-4",children:e.jsx(Z,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]}):a?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(Z,{to:`/bookings/${s}`,className:"text-blue-600 hover:text-blue-800 text-sm mb-2 inline-flex items-center",children:[e.jsx(_e,{className:"mr-1 h-4 w-4"}),"Back to Booking Details"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reschedule Flight"}),e.jsxs("p",{className:"text-gray-600",children:[a.departureAirport," → ",a.arrivalAirport]})]})}),w&&e.jsx(q,{variant:"destructive",children:e.jsx(z,{children:w})}),e.jsx(B,{children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center ${c==="options"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="options"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Generate Options"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${c==="preferences"?"text-blue-600 font-semibold":c==="confirmation"?"text-gray-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="preferences"?"bg-blue-600 text-white":c==="confirmation"?"bg-gray-400 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Rank Preferences"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${c==="confirmation"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="confirmation"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Confirm"})]})]})})}),c==="options"&&e.jsx(Ue,{bookingId:s,onOptionsLoaded:y,onContinue:()=>{l.length>0&&m("preferences")}}),c==="preferences"&&l.length>0&&e.jsxs(e.Fragment,{children:[R&&e.jsx(q,{className:"mb-4 bg-blue-50 border-blue-200",children:e.jsxs(z,{className:"text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"✅ Your preferences have been submitted!"}),e.jsx("p",{className:"text-sm",children:"Waiting for the other party (student/instructor) to submit their preferences. Once both are submitted, you'll be able to confirm the reschedule."})]})}),e.jsx(Je,{options:l,onSubmit:re,loading:C,existingRanking:b||void 0})]}),c==="confirmation"&&x&&a&&e.jsx(Qe,{bookingDetails:{id:a.id,studentName:"Student",instructorName:"Instructor",aircraftType:a.aircraftId||"Aircraft",trainingLevel:a.trainingLevel||"student_pilot"},oldScheduledTime:a.scheduledDatetime,newScheduledTime:x.suggestedDatetime,route:{departureAirport:a.departureAirport,arrivalAirport:a.arrivalAirport},onConfirm:H,onCancel:()=>m("preferences"),loading:C})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center text-gray-600",children:"Booking not found"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(Z,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]})}export{cs as default};
