var R=Object.defineProperty,k=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var D=(s,o,r)=>o in s?R(s,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[o]=r,v=(s,o)=>{for(var r in o||(o={}))q.call(o,r)&&D(s,r,o[r]);if(T)for(var r of T(o))_.call(o,r)&&D(s,r,o[r]);return s},y=(s,o)=>k(s,O(o));var N=(s,o,r)=>new Promise((t,m)=>{var h=l=>{try{f(r.next(l))}catch(b){m(b)}},j=l=>{try{f(r.throw(l))}catch(b){m(b)}},f=l=>l.done?t(l.value):Promise.resolve(l.value).then(h,j);f((r=r.apply(s,o)).next())});import{j as e}from"./ui-vendor-X7k4bu4n.js";import{u as B,r as p}from"./react-vendor-C9zT986Q.js";import{B as K}from"./booking-Sr7KVi8d.js";import{e as F,f as M,u as P,U as x,g as $,s as z}from"./index-B5m-gi1T.js";import{T as S}from"./weather-BNlE3esQ.js";import{E as J,d as C,i as W}from"./enhanced-alert-DtAEO0DG.js";import"./utils-vendor-1hodNj4h.js";import"./alert-CVFLCXas.js";function H(s){return{id:s.id,email:s.email,firstName:s.first_name,lastName:s.last_name,name:`${s.first_name} ${s.last_name}`.trim(),phoneNumber:s.phone_number,role:s.role,trainingLevel:s.training_level,createdAt:s.created_at,updatedAt:s.updated_at}}class V{listUsers(){return N(this,arguments,function*(o={}){const r=new URLSearchParams;o.role&&r.append("role",o.role),o.limit&&r.append("limit",o.limit.toString()),o.offset&&r.append("offset",o.offset.toString());const t=r.toString(),m=`/api/users/list${t?`?${t}`:""}`,h=yield F.get(m);return{users:h.data.users.map(H),count:h.data.count}})}getInstructors(){return N(this,null,function*(){return(yield this.listUsers({role:"INSTRUCTOR",limit:100})).users})}getStudents(){return N(this,null,function*(){return(yield this.listUsers({role:"STUDENT",limit:100})).users})}}const X=new V,w=[{code:"KJFK",name:"New York JFK",lat:40.6413,lon:-73.7781},{code:"KLAX",name:"Los Angeles",lat:33.9416,lon:-118.4085},{code:"KORD",name:"Chicago O'Hare",lat:41.9786,lon:-87.9048},{code:"KDFW",name:"Dallas Fort Worth",lat:32.8998,lon:-97.0403},{code:"KATL",name:"Atlanta",lat:33.6407,lon:-84.4277},{code:"KBOS",name:"Boston",lat:42.3656,lon:-71.0096},{code:"KSEA",name:"Seattle",lat:47.4502,lon:-122.3088},{code:"KLAS",name:"Las Vegas",lat:36.084,lon:-115.1537}];function oe(){const s=B(),{toast:o}=M(),{user:r}=P(),[t,m]=p.useState({trainingLevel:S.STUDENT_PILOT,durationMinutes:60}),[h,j]=p.useState(!1),[f,l]=p.useState(null),[b,E]=p.useState([]),[I,A]=p.useState(!1);p.useEffect(()=>{var a;if(r&&r.id){console.log("Auto-populating user ID:",r.id,"Role:",r.role);const i=(a=r.role)==null?void 0:a.toUpperCase();i==="STUDENT"||r.role===x.STUDENT?(m(u=>y(v({},u),{studentId:r.id})),console.log("Set studentId to:",r.id)):i==="INSTRUCTOR"||r.role===x.INSTRUCTOR?(m(u=>y(v({},u),{instructorId:r.id})),console.log("Set instructorId to:",r.id)):console.log("Role not matched:",r.role,"normalized:",i)}else console.log("User not available yet:",r)},[r]),p.useEffect(()=>{r&&N(this,null,function*(){var u;if(((u=r==null?void 0:r.role)==null?void 0:u.toUpperCase())==="STUDENT"||(r==null?void 0:r.role)===x.STUDENT){A(!0);try{const n=yield X.getInstructors();E(n)}catch(n){console.error("Failed to load instructors:",n),l("Failed to load instructors. Please refresh the page.")}finally{A(!1)}}})},[r]),p.useEffect(()=>{if(t.departureAirport){const a=w.find(i=>i.code===t.departureAirport);a&&m(i=>y(v({},i),{departureLatitude:a.lat,departureLongitude:a.lon}))}},[t.departureAirport]),p.useEffect(()=>{if(t.arrivalAirport){const a=w.find(i=>i.code===t.arrivalAirport);a&&m(i=>y(v({},i),{arrivalLatitude:a.lat,arrivalLongitude:a.lon}))}},[t.arrivalAirport]);const d=a=>{const{name:i,value:u}=a.target;m(n=>y(v({},n),{[i]:u}))},U=a=>N(this,null,function*(){var i,u;if(a.preventDefault(),l(null),!t.studentId||!t.instructorId){l("Student and Instructor are required");return}if(!t.departureAirport||!t.arrivalAirport){l("Departure and arrival airports are required");return}if(!t.scheduledDatetime){l("Scheduled date and time is required");return}if(!t.departureLatitude||!t.departureLongitude||!t.arrivalLatitude||!t.arrivalLongitude){l("Airport coordinates are missing");return}try{j(!0);const n=t.scheduledDatetime?new Date(t.scheduledDatetime).toISOString():null;if(!n){l("Scheduled date and time is required");return}const c={studentId:t.studentId.trim(),instructorId:t.instructorId.trim(),departureAirport:t.departureAirport,arrivalAirport:t.arrivalAirport,departureLatitude:Number(t.departureLatitude),departureLongitude:Number(t.departureLongitude),arrivalLatitude:Number(t.arrivalLatitude),arrivalLongitude:Number(t.arrivalLongitude),scheduledDatetime:n,trainingLevel:t.trainingLevel||S.STUDENT_PILOT,durationMinutes:Number(t.durationMinutes||60)},L=(i=t.aircraftId)==null?void 0:i.trim();L&&L.length>0&&(c.aircraftId=L);const g=yield K.createBooking(c);s(`/bookings/${g.id}`)}catch(n){let c="Failed to create booking";if((u=n==null?void 0:n.response)!=null&&u.data){const g=n.response.data;g.errors&&Array.isArray(g.errors)?c=g.errors.join(". "):g.message?c=g.message:g.error&&(c=g.error)}else c=$(n).message;l(c),z(n,"create-booking"),(C(c)==="conflict"||W(c))&&o({variant:"destructive",title:"⚠️ Booking Conflict",description:c})}finally{j(!1)}});return e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Booking"}),e.jsx("p",{className:"text-gray-600",children:"Schedule a new flight training session"})]}),e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[f&&e.jsx(J,{variant:C(f),message:f,onClose:()=>l(null)}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r&&(r.role===x.INSTRUCTOR||r.role===x.ADMIN)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student *"}),e.jsx("input",{type:"text",name:"studentId",required:!0,value:t.studentId||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Enter student UUID"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UUID of the student"})]}),r&&r.role===x.STUDENT&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instructor *"}),e.jsxs("select",{name:"instructorId",required:!0,value:t.instructorId||"",onChange:d,disabled:I,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:I?"Loading instructors...":"Select an instructor..."}),b.map(a=>e.jsxs("option",{value:a.id,children:[a.firstName," ",a.lastName," (",a.email,")"]},a.id))]}),I&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Loading instructors..."}),!I&&b.length===0&&e.jsx("p",{className:"mt-1 text-xs text-yellow-600",children:"No instructors available"})]}),r&&(r.role===x.INSTRUCTOR||r.role===x.ADMIN)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instructor ID *"}),e.jsx("input",{type:"text",name:"instructorId",required:!0,value:t.instructorId||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Enter instructor UUID"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UUID of the instructor"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departure Airport *"}),e.jsxs("select",{name:"departureAirport",required:!0,value:t.departureAirport||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),w.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Arrival Airport *"}),e.jsxs("select",{name:"arrivalAirport",required:!0,value:t.arrivalAirport||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),w.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aircraft ID"}),e.jsx("input",{type:"text",name:"aircraftId",value:t.aircraftId||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"N12345"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Date & Time *"}),e.jsx("input",{type:"datetime-local",name:"scheduledDatetime",required:!0,value:t.scheduledDatetime||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Level *"}),e.jsx("select",{name:"trainingLevel",required:!0,value:t.trainingLevel||S.STUDENT_PILOT,onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:Object.values(S).map(a=>e.jsx("option",{value:a,children:a.replace("_"," ")},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes) *"}),e.jsx("input",{type:"number",name:"durationMinutes",required:!0,min:"15",max:"480",value:t.durationMinutes||60,onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Coordinates (Auto-filled)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Departure Lat"}),e.jsx("input",{type:"number",step:"0.0001",name:"departureLatitude",value:t.departureLatitude||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Departure Lon"}),e.jsx("input",{type:"number",step:"0.0001",name:"departureLongitude",value:t.departureLongitude||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Arrival Lat"}),e.jsx("input",{type:"number",step:"0.0001",name:"arrivalLatitude",value:t.arrivalLatitude||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Arrival Lon"}),e.jsx("input",{type:"number",step:"0.0001",name:"arrivalLongitude",value:t.arrivalLongitude||"",onChange:d,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/bookings"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:h?"Creating...":"Create Booking"})]})]})]})}export{oe as default};
