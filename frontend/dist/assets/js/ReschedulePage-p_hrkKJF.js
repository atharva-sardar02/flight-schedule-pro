var Ee=Object.defineProperty,Oe=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var le=(s,a,n)=>a in s?Ee(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,E=(s,a)=>{for(var n in a||(a={}))ce.call(a,n)&&le(s,n,a[n]);if(K)for(var n of K(a))oe.call(a,n)&&le(s,n,a[n]);return s},A=(s,a)=>Oe(s,Re(a));var _=(s,a)=>{var n={};for(var l in s)ce.call(s,l)&&a.indexOf(l)<0&&(n[l]=s[l]);if(s!=null&&K)for(var l of K(s))a.indexOf(l)<0&&oe.call(s,l)&&(n[l]=s[l]);return n};var P=(s,a,n)=>new Promise((l,o)=>{var p=x=>{try{h(n.next(x))}catch(u){o(u)}},g=x=>{try{h(n.throw(x))}catch(u){o(u)}},h=x=>x.done?l(x.value):Promise.resolve(x.value).then(p,g);h((n=n.apply(s,a)).next())});import{j as e,p as V,C as G,A as X,r as De,e as Ae,i as Pe,P as ae,h as Me,u as pe,k as de,D as Be,E as Te,G as _e,a as Fe,v as Le,T as We,y as me,t as he,F as ue,H as qe}from"./ui-vendor-X7k4bu4n.js";import{r as m,g as Ge,u as $e,L as ee}from"./react-vendor-C9zT986Q.js";import{g as L,s as W,B as O,C as M,a as $,b as z,c as Y,d as B,h as xe,f as ze}from"./index-DDVNj2O6.js";import{B as D}from"./badge-DgYYOs--.js";import{A as ge,a as je}from"./alert-D1yonbLc.js";import{g as re,a as Ue,b as He,c as Ke,s as Ve,d as Xe}from"./rescheduling-DR5qem8D.js";import{f as F}from"./utils-vendor-1hodNj4h.js";import{E as se,d as te}from"./enhanced-alert-DFmOnHUZ.js";import{B as Ye}from"./booking-EhZRWkcT.js";const fe=(s,a)=>{if(!s)return"Date not available";const n=new Date(s);return isNaN(n.getTime())?"Invalid date":F(n,a)};function Je({bookingId:s,onOptionsLoaded:a,onContinue:n}){const[l,o]=m.useState([]),[p,g]=m.useState(!0),[h,x]=m.useState(!1),[u,c]=m.useState(null);m.useEffect(()=>{N()},[s]);const N=()=>P(this,null,function*(){try{g(!0),c(null);const i=yield re(s);o(i),a&&a(i)}catch(i){const j=L(i);c(j.message),W(i,"load-reschedule-options")}finally{g(!1)}}),w=()=>P(this,null,function*(){try{x(!0),c(null);const i=yield Ue(s);o(i),a&&a(i)}catch(i){const j=L(i);c(j.message),W(i,"generate-reschedule-options")}finally{x(!1)}}),C=i=>i>=.8?e.jsx(D,{className:"bg-green-500",children:"High Confidence"}):i>=.6?e.jsx(D,{className:"bg-yellow-500",children:"Medium Confidence"}):e.jsx(D,{className:"bg-orange-500",children:"Low Confidence"}),y=i=>i>=.8?e.jsx(D,{className:"bg-blue-500",children:"Excellent Weather"}):i>=.6?e.jsx(D,{className:"bg-blue-400",children:"Good Weather"}):e.jsx(D,{className:"bg-gray-500",children:"Fair Weather"});return p?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(V,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading options..."})]}):u?e.jsx(ge,{variant:"destructive",children:e.jsxs(je,{children:[e.jsx("p",{className:"mb-2",children:u}),e.jsx(O,{onClick:N,variant:"outline",size:"sm",children:"Retry"})]})}):l.length===0?e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(z,{children:"No Reschedule Options"}),e.jsx(Y,{children:"Generate new options using our AI scheduling assistant."})]}),e.jsx(B,{children:e.jsxs(O,{onClick:w,disabled:h,children:[h&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Options"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Reschedule Options"}),e.jsxs(O,{onClick:w,disabled:h,variant:"outline",size:"sm",children:[h&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerate"]})]}),e.jsx("div",{className:"grid gap-4",children:l.map((i,j)=>e.jsxs(M,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{className:"text-base",children:["Option ",j+1]}),e.jsxs("div",{className:"flex gap-2",children:[C(i.confidence),y(i.weatherScore)]})]})}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:fe(i.suggestedDatetime,"EEEE, MMMM d, yyyy")}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["at ",fe(i.suggestedDatetime,"h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(X,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[i.departureAirport," → ",i.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(De,{className:"mr-2 h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700",children:i.reasoning})})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("span",{children:["Weather Score: ",(i.weatherScore*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Confidence: ",(i.confidence*100).toFixed(0),"%"]})]})]})]},i.id))}),n&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(O,{onClick:n,size:"lg",children:"Continue to Preferences"})})]})}function Qe(s){const a=m.useRef({value:s,previous:s});return m.useMemo(()=>(a.current.value!==s&&(a.current.previous=a.current.value,a.current.value=s),a.current.previous),[s])}var J="Checkbox",[Ze]=Ae(J),[es,ne]=Ze(J);function ss(s){const{__scopeCheckbox:a,checked:n,children:l,defaultChecked:o,disabled:p,form:g,name:h,onCheckedChange:x,required:u,value:c="on",internal_do_not_use_render:N}=s,[w,C]=Me({prop:n,defaultProp:o!=null?o:!1,onChange:x,caller:J}),[y,i]=m.useState(null),[j,k]=m.useState(null),I=m.useRef(!1),t=y?!!g||!!y.closest("form"):!0,r={checked:w,disabled:p,setChecked:C,control:y,setControl:i,name:h,form:g,value:c,hasConsumerStoppedPropagationRef:I,required:u,defaultChecked:T(o)?!1:o,isFormControl:t,bubbleInput:j,setBubbleInput:k};return e.jsx(es,A(E({scope:a},r),{children:ts(N)?N(r):l}))}var be="CheckboxTrigger",ve=m.forwardRef((p,o)=>{var g=p,{__scopeCheckbox:s,onKeyDown:a,onClick:n}=g,l=_(g,["__scopeCheckbox","onKeyDown","onClick"]);const{control:h,value:x,disabled:u,checked:c,required:N,setControl:w,setChecked:C,hasConsumerStoppedPropagationRef:y,isFormControl:i,bubbleInput:j}=ne(be,s),k=pe(o,w),I=m.useRef(c);return m.useEffect(()=>{const t=h==null?void 0:h.form;if(t){const r=()=>C(I.current);return t.addEventListener("reset",r),()=>t.removeEventListener("reset",r)}},[h,C]),e.jsx(ae.button,A(E({type:"button",role:"checkbox","aria-checked":T(c)?"mixed":c,"aria-required":N,"data-state":ke(c),"data-disabled":u?"":void 0,disabled:u,value:x},l),{ref:k,onKeyDown:de(a,t=>{t.key==="Enter"&&t.preventDefault()}),onClick:de(n,t=>{C(r=>T(r)?!0:!r),j&&i&&(y.current=t.isPropagationStopped(),y.current||t.stopPropagation())})}))});ve.displayName=be;var ie=m.forwardRef((s,a)=>{const w=s,{__scopeCheckbox:n,name:l,checked:o,defaultChecked:p,required:g,disabled:h,value:x,onCheckedChange:u,form:c}=w,N=_(w,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(ss,{__scopeCheckbox:n,checked:o,defaultChecked:p,disabled:h,required:g,onCheckedChange:u,name:l,form:c,value:x,internal_do_not_use_render:({isFormControl:C})=>e.jsxs(e.Fragment,{children:[e.jsx(ve,A(E({},N),{ref:a,__scopeCheckbox:n})),C&&e.jsx(Ce,{__scopeCheckbox:n})]})})});ie.displayName=J;var Ne="CheckboxIndicator",ye=m.forwardRef((s,a)=>{const g=s,{__scopeCheckbox:n,forceMount:l}=g,o=_(g,["__scopeCheckbox","forceMount"]),p=ne(Ne,n);return e.jsx(Pe,{present:l||T(p.checked)||p.checked===!0,children:e.jsx(ae.span,A(E({"data-state":ke(p.checked),"data-disabled":p.disabled?"":void 0},o),{ref:a,style:E({pointerEvents:"none"},s.style)}))})});ye.displayName=Ne;var we="CheckboxBubbleInput",Ce=m.forwardRef((l,n)=>{var o=l,{__scopeCheckbox:s}=o,a=_(o,["__scopeCheckbox"]);const{control:p,hasConsumerStoppedPropagationRef:g,checked:h,defaultChecked:x,required:u,disabled:c,name:N,value:w,form:C,bubbleInput:y,setBubbleInput:i}=ne(we,s),j=pe(n,i),k=Qe(h),I=Be(p);m.useEffect(()=>{const r=y;if(!r)return;const v=window.HTMLInputElement.prototype,U=Object.getOwnPropertyDescriptor(v,"checked").set,Z=!g.current;if(k!==h&&U){const b=new Event("click",{bubbles:Z});r.indeterminate=T(h),U.call(r,T(h)?!1:h),r.dispatchEvent(b)}},[y,k,h,g]);const t=m.useRef(T(h)?!1:h);return e.jsx(ae.input,A(E({type:"checkbox","aria-hidden":!0,defaultChecked:x!=null?x:t.current,required:u,disabled:c,name:N,value:w,form:C},a),{tabIndex:-1,ref:j,style:A(E(E({},a.style),I),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});Ce.displayName=we;function ts(s){return typeof s=="function"}function T(s){return s==="indeterminate"}function ke(s){return T(s)?"indeterminate":s?"checked":"unchecked"}const Ie=m.forwardRef((l,n)=>{var o=l,{className:s}=o,a=_(o,["className"]);return e.jsx(ie,A(E({ref:n,className:xe("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},a),{children:e.jsx(ye,{className:xe("grid place-content-center text-current"),children:e.jsx(Te,{className:"h-4 w-4"})})}))});Ie.displayName=ie.displayName;const q=(s,a)=>{if(!s)return"Date not available";const n=new Date(s);return isNaN(n.getTime())?"Invalid date":F(n,a)};function rs({options:s,onSubmit:a,loading:n=!1,existingRanking:l}){const[o,p]=m.useState([null,null,null]),[g,h]=m.useState(new Set),[x,u]=m.useState(null);m.useEffect(()=>{if(l&&s.length>0){const t=[null,null,null];l.option1Id&&(t[0]=s.find(r=>r.id===l.option1Id)||null),l.option2Id&&(t[1]=s.find(r=>r.id===l.option2Id)||null),l.option3Id&&(t[2]=s.find(r=>r.id===l.option3Id)||null),p(t),h(new Set(l.unavailableOptionIds||[]))}},[l,s]);const c=s.filter(t=>!o.some(r=>(r==null?void 0:r.id)===t.id)&&!g.has(t.id)),N=t=>{u(t)},w=t=>{t.preventDefault()},C=t=>{if(x===null)return;const r=[...o],v=o[x];r[x]=r[t],r[t]=v,p(r),u(null)},y=(t,r)=>{const v=[...o];v[r]=t,p(v)},i=t=>{const r=[...o];r[t]=null,p(r)},j=t=>{const r=new Set(g);r.has(t)?r.delete(t):(r.add(t),p(o.map(v=>(v==null?void 0:v.id)===t?null:v))),h(r)},k=()=>{var t,r,v;a({option1Id:(t=o[0])==null?void 0:t.id,option2Id:(r=o[1])==null?void 0:r.id,option3Id:(v=o[2])==null?void 0:v.id,unavailableOptionIds:Array.from(g)})},I=o.some(t=>t!==null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Rank Your Preferences"}),e.jsx(Y,{children:"Drag options to rank them in order of preference, or mark options as unavailable. Your #1 choice will be given the highest weight in the final selection."})]}),e.jsx(B,{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:o.map((t,r)=>e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] bg-gray-50",onDragOver:w,onDrop:()=>C(r),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[r===0?"1st":r===1?"2nd":"3rd"," Choice"]}),t&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>i(r),children:"Remove"})]}),t?e.jsx("div",{className:"bg-white border rounded-lg p-3 cursor-move",draggable:!0,onDragStart:()=>N(r),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-gray-500"}),q(t.suggestedDatetime,"EEE, MMM d")," at"," ",q(t.suggestedDatetime,"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(X,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]})]})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Drag an option here or select from below"})]},r))})})]}),e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Available Options"}),e.jsx(Y,{children:"Select options to add to your ranking, or mark them as unavailable."})]}),e.jsxs(B,{children:[c.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"All options have been ranked or marked unavailable"}):e.jsx("div",{className:"space-y-2",children:c.map((t,r)=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ie,{id:`unavailable-${t.id}`,checked:g.has(t.id),onCheckedChange:()=>j(t.id)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-gray-500"}),q(t.suggestedDatetime,"EEEE, MMMM d, yyyy")," at"," ",q(t.suggestedDatetime,"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(X,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.reasoning}),e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(v=>e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>y(t,v),disabled:o[v]!==null,children:["Set as #",v+1]},v))})]})]})},t.id))}),g.size>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Unavailable Options"]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>g.has(t.id)).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 p-2 bg-gray-100 rounded",children:[e.jsx("span",{children:q(t.suggestedDatetime,"MMM d, h:mm a")}),e.jsx(O,{size:"sm",variant:"ghost",onClick:()=>j(t.id),children:"Mark Available"})]},t.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{onClick:k,disabled:!I||n,size:"lg",children:n?"Submitting...":"Submit Preferences"})}),!I&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please rank at least one option before submitting"})]})}function as({bookingDetails:s,oldScheduledTime:a,newScheduledTime:n,route:l,onConfirm:o,onCancel:p,onRequestNewOptions:g,loading:h=!1}){const[x,u]=m.useState(!1),[c,N]=m.useState(null),w=new Date(a),C=new Date(n),y=()=>P(this,null,function*(){try{u(!0),N(null);const i=yield o();i.success||(i.requiresNewOptions?N({message:i.error||"Weather conditions have changed",requiresNewOptions:!0}):N({message:i.error||"Failed to confirm reschedule",requiresNewOptions:!1}))}catch(i){const j=L(i);N({message:j.message,requiresNewOptions:!1}),W(i,"confirm-reschedule")}finally{u(!1)}});return e.jsxs("div",{className:"space-y-6",children:[!c&&e.jsx(M,{className:"bg-green-50 border-green-200",children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-green-800",children:[e.jsx(Le,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ready to Confirm Reschedule"}),e.jsx("p",{className:"text-sm",children:"Weather will be re-validated before final confirmation"})]})]})})}),c&&e.jsxs(ge,{variant:"destructive",children:[e.jsx(We,{className:"h-5 w-5"}),e.jsxs(je,{children:[e.jsx("p",{className:"font-semibold mb-2",children:c.message}),c.requiresNewOptions&&e.jsx("p",{className:"text-sm mb-3",children:"The selected time slot no longer meets weather requirements. New options need to be generated."}),c.requiresNewOptions&&g&&e.jsxs(O,{onClick:g,variant:"outline",size:"sm",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Generate New Options"]})]})]}),e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Schedule Change Summary"}),e.jsx(Y,{children:"Review the details of your rescheduled flight"})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{variant:"outline",children:"Original Time"})}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),F(w,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),F(w,"h:mm a")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{className:"bg-green-500",children:"New Time"})}),e.jsxs("div",{className:"p-4 bg-green-100 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-1 font-medium",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),F(C,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-green-800 font-medium",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),F(C,"h:mm a")]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Flight Details"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Route:"}),e.jsxs("span",{className:"text-sm font-medium",children:[l.departureAirport," → ",l.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Student:"}),e.jsx("span",{className:"text-sm font-medium",children:s.studentName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Instructor:"}),e.jsx("span",{className:"text-sm font-medium",children:s.instructorName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Aircraft:"}),e.jsx("span",{className:"text-sm font-medium",children:s.aircraftType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Training Level:"}),e.jsx(D,{variant:"outline",children:s.trainingLevel})]})]})]}),e.jsxs("div",{className:"border-t pt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather will be checked immediately before confirmation"}),e.jsxs("div",{className:"flex gap-3",children:[p&&e.jsx(O,{variant:"outline",onClick:p,disabled:x,children:"Cancel"}),e.jsx(O,{onClick:y,disabled:x||h,children:x?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating Weather..."]}):"Confirm Reschedule"})]})]})]})]}),e.jsx(M,{className:"bg-blue-50 border-blue-200",children:e.jsx(B,{className:"pt-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What Happens Next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Weather conditions will be re-validated in real-time"}),e.jsx("li",{children:"If conditions are suitable, the booking will be updated"}),e.jsx("li",{children:"Both student and instructor will receive email confirmation"}),e.jsx("li",{children:"Weather monitoring will continue for the new time slot"})]})]})})})]})}function fs(){const{bookingId:s}=Ge(),a=$e(),{toast:n}=ze(),[l,o]=m.useState(null),[p,g]=m.useState([]),[h,x]=m.useState(null),[u,c]=m.useState("options"),[N,w]=m.useState(!0),[C,y]=m.useState(!1),[i,j]=m.useState(null),[k,I]=m.useState(null),[t,r]=m.useState(!1);m.useEffect(()=>{s&&v()},[s]);const v=()=>P(this,null,function*(){if(s)try{w(!0),j(null);const b=yield Ye.getBooking(s);o(b);try{const f=yield re(s);g(f);try{const d=yield He(s);if(d.preference){I({option1Id:d.preference.option1Id,option2Id:d.preference.option2Id,option3Id:d.preference.option3Id,unavailableOptionIds:d.preference.unavailableOptionIds||[]});const R=d.preference.option1Id||d.preference.option2Id||d.preference.option3Id;if(R&&f.length>0){const S=f.find(H=>H.id===R);S?(x(S),c("confirmation")):c("preferences")}else f.length>0&&c("options")}else f.length>0&&c("options")}catch(d){f.length>0&&c("options")}}catch(f){c("options")}}catch(b){const f=L(b);j(f.message),W(b,"load-booking"),n({variant:"destructive",title:f.title,description:f.message})}finally{w(!1)}});m.useEffect(()=>{P(this,null,function*(){if(!(!s||u!=="preferences"||p.length===0))try{const f=yield Ke(s),d=f.find(S=>S.submittedAt),R=f.length>=2&&f.every(S=>S.submittedAt);if(d&&!R)r(!0),(d.option1Id||d.option2Id||d.option3Id)&&I({option1Id:d.option1Id,option2Id:d.option2Id,option3Id:d.option3Id,unavailableOptionIds:d.unavailableOptionIds||[]});else if(R&&d){const S=d.option1Id||d.option2Id||d.option3Id;if(S){const H=p.find(Se=>Se.id===S);H&&(x(H),c("confirmation"))}}}catch(f){}})},[s,u,p]);const Q=b=>{if(g(b),b.length>0&&k){const f=k.option1Id||k.option2Id||k.option3Id;if(f){const d=b.find(R=>R.id===f);d?(x(d),c("confirmation")):c("preferences")}else c("preferences")}},U=b=>P(this,null,function*(){if(s)try{y(!0),j(null);const f=yield Ve(E({bookingId:s},b));I(b);const d=b.option1Id||b.option2Id||b.option3Id;if(d){const R=p.find(S=>S.id===d);R&&(x(R),f.bothSubmitted?(c("confirmation"),r(!1)):(j(null),r(!0)))}}catch(f){const d=L(f);j(d.message),W(f,"submit-preferences"),n({variant:"destructive",title:d.title,description:d.message})}finally{y(!1)}}),Z=()=>P(this,null,function*(){if(!s||!h)return{success:!1,error:"Missing booking ID or selected option"};try{y(!0),j(null);const b=yield Xe(s);if(b.success)return a(`/bookings/${s}`),{success:!0};if(b.requiresNewOptions){if(b.newOptionsGenerated){g([]),x(null),I(null),r(!1),j(null);try{const f=yield re(s);Q(f);const d=b.message||`New reschedule options have been automatically generated (${b.optionsCount||f.length} options). Please review and submit your preferences again.`;j(d),c("options")}catch(f){j(b.message||"New options were generated. Please refresh the page to see them."),c("options")}}else j(b.error||"Weather conditions have changed. Please generate new options."),c("options");return{success:!1,error:b.error,requiresNewOptions:!0}}else return j(b.error||"Failed to confirm reschedule"),{success:!1,error:b.error}}catch(b){const f=L(b);j(f.message),W(b,"confirm-reschedule");const d=te(f.message);return n({variant:"destructive",title:f.title,description:f.message}),{success:!1,error:f.message}}finally{y(!1)}});return N?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(V,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]}):i&&!l?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(se,{variant:te(i),message:i,onClose:()=>j(null)}),e.jsx("div",{className:"mt-4",children:e.jsx(ee,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]}):l?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(ee,{to:`/bookings/${s}`,className:"text-blue-600 hover:text-blue-800 text-sm mb-2 inline-flex items-center",children:[e.jsx(qe,{className:"mr-1 h-4 w-4"}),"Back to Booking Details"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reschedule Flight"}),e.jsxs("p",{className:"text-gray-600",children:[l.departureAirport," → ",l.arrivalAirport]})]})}),i&&e.jsx(se,{variant:te(i),message:i,onClose:()=>j(null)}),e.jsx(M,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center ${u==="options"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${u==="options"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Generate Options"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${u==="preferences"?"text-blue-600 font-semibold":u==="confirmation"?"text-gray-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${u==="preferences"?"bg-blue-600 text-white":u==="confirmation"?"bg-gray-400 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Rank Preferences"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${u==="confirmation"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${u==="confirmation"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Confirm"})]})]})})}),u==="options"&&e.jsx(Je,{bookingId:s,onOptionsLoaded:Q,onContinue:()=>{p.length>0&&c("preferences")}}),u==="preferences"&&p.length>0&&e.jsxs(e.Fragment,{children:[t&&e.jsx(se,{variant:"info",title:"✅ Preferences Submitted",message:"Waiting for the other party (student/instructor) to submit their preferences. Once both are submitted, you'll be able to confirm the reschedule.",className:"mb-4"}),e.jsx(rs,{options:p,onSubmit:U,loading:C,existingRanking:k||void 0})]}),u==="confirmation"&&h&&l&&e.jsx(as,{bookingDetails:{id:l.id,studentName:"Student",instructorName:"Instructor",aircraftType:l.aircraftId||"Aircraft",trainingLevel:l.trainingLevel||"student_pilot"},oldScheduledTime:l.scheduledDatetime,newScheduledTime:h.suggestedDatetime,route:{departureAirport:l.departureAirport,arrivalAirport:l.arrivalAirport},onConfirm:Z,onCancel:()=>c("preferences"),loading:C})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center text-gray-600",children:"Booking not found"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(ee,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]})}export{fs as default};
