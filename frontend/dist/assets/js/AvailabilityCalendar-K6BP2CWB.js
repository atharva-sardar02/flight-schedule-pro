var be=Object.defineProperty,fe=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var te=(t,n,d)=>n in t?be(t,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[n]=d,k=(t,n)=>{for(var d in n||(n={}))ae.call(n,d)&&te(t,d,n[d]);if(W)for(var d of W(n))se.call(n,d)&&te(t,d,n[d]);return t},C=(t,n)=>fe(t,je(n));var H=(t,n)=>{var d={};for(var o in t)ae.call(t,o)&&n.indexOf(o)<0&&(d[o]=t[o]);if(t!=null&&W)for(var o of W(t))n.indexOf(o)<0&&se.call(t,o)&&(d[o]=t[o]);return d};var v=(t,n,d)=>new Promise((o,b)=>{var p=f=>{try{m(d.next(f))}catch(l){b(l)}},T=f=>{try{m(d.throw(f))}catch(l){b(l)}},m=f=>f.done?o(f.value):Promise.resolve(f.value).then(p,T);m((d=d.apply(t,n)).next())});import{j as e,K as le,E as de,X as ce,N as oe,O as re,Q as ie,C as pe,t as De,z as Ne}from"./ui-vendor-X7k4bu4n.js";import{r as u,u as we}from"./react-vendor-C9zT986Q.js";import{e as M,h as me,j as Ae,i as ke,u as he,C as P,a as V,b as G,c as ue,d as Y,B as S,U as ne}from"./index-CVmYzK3Q.js";import{A as q,a as K}from"./alert-DMOBw3HT.js";import{f as Te}from"./utils-vendor-1hodNj4h.js";import{T as Se,a as Ce,b as X,c as J}from"./tabs-b5CWDbkW.js";import{B as Z}from"./booking-C9Zew14c.js";const Re=(t,n,d)=>v(void 0,null,function*(){return(yield M.get("/availability",{params:{userId:t,startDate:n,endDate:d}})).data}),$e=()=>v(void 0,null,function*(){return(yield M.get("/availability/recurring")).data}),Be=t=>v(void 0,null,function*(){return(yield M.post("/availability/recurring",t)).data}),Oe=(t,n)=>v(void 0,null,function*(){return(yield M.put(`/availability/recurring/${t}`,n)).data}),Fe=t=>v(void 0,null,function*(){yield M.delete(`/availability/recurring/${t}`)}),Ee=(t,n)=>v(void 0,null,function*(){return(yield M.get("/availability/overrides",{params:{startDate:t,endDate:n}})).data}),Ie=t=>v(void 0,null,function*(){return(yield M.post("/availability/overrides",t)).data}),Me=(t,n)=>v(void 0,null,function*(){return(yield M.put(`/availability/overrides/${t}`,n)).data}),Pe=t=>v(void 0,null,function*(){yield M.delete(`/availability/overrides/${t}`)}),_=()=>{const[t,n]=u.useState(null),[d,o]=u.useState([]),[b,p]=u.useState([]),[T,m]=u.useState(!1),[f,l]=u.useState(null),g=u.useCallback((a,s,c)=>v(void 0,null,function*(){m(!0),l(null);try{const D=yield Re(a,s,c);n(D),o(D.recurringPatterns),p(D.overrides)}catch(D){throw l(D.message||"Failed to fetch availability"),D}finally{m(!1)}}),[]),R=u.useCallback(()=>v(void 0,null,function*(){m(!0),l(null);try{const a=yield $e();o(a)}catch(a){throw l(a.message||"Failed to fetch recurring patterns"),a}finally{m(!1)}}),[]),w=u.useCallback((a,s)=>v(void 0,null,function*(){m(!0),l(null);try{const c=yield Ee(a,s);p(c)}catch(c){throw l(c.message||"Failed to fetch overrides"),c}finally{m(!1)}}),[]),$=u.useCallback(a=>v(void 0,null,function*(){m(!0),l(null);try{const s=yield Be(a);o(c=>[...c,s])}catch(s){throw l(s.message||"Failed to create recurring pattern"),s}finally{m(!1)}}),[]),j=u.useCallback((a,s)=>v(void 0,null,function*(){m(!0),l(null);try{const c=yield Oe(a,s);o(D=>D.map(N=>N.id===a?c:N))}catch(c){throw l(c.message||"Failed to update recurring pattern"),c}finally{m(!1)}}),[]),h=u.useCallback(a=>v(void 0,null,function*(){m(!0),l(null);try{yield Fe(a),o(s=>s.filter(c=>c.id!==a))}catch(s){throw l(s.message||"Failed to delete recurring pattern"),s}finally{m(!1)}}),[]),r=u.useCallback(a=>v(void 0,null,function*(){m(!0),l(null);try{const s=yield Ie(a);p(c=>[...c,s])}catch(s){throw l(s.message||"Failed to create override"),s}finally{m(!1)}}),[]),x=u.useCallback((a,s)=>v(void 0,null,function*(){m(!0),l(null);try{const c=yield Me(a,s);p(D=>D.map(N=>N.id===a?c:N))}catch(c){throw l(c.message||"Failed to update override"),c}finally{m(!1)}}),[]),y=u.useCallback(a=>v(void 0,null,function*(){m(!0),l(null);try{yield Pe(a),p(s=>s.filter(c=>c.id!==a))}catch(s){throw l(s.message||"Failed to delete override"),s}finally{m(!1)}}),[]),i=u.useCallback(()=>{l(null)},[]);return{availability:t,recurringPatterns:d,overrides:b,loading:T,error:f,fetchAvailability:g,fetchRecurringPatterns:R,fetchOverrides:w,createRecurringPattern:$,updateRecurringPattern:j,deleteRecurringPattern:h,createOverride:r,updateOverride:x,deleteOverride:y,clearError:i}};var E=(t=>(t[t.SUNDAY=0]="SUNDAY",t[t.MONDAY=1]="MONDAY",t[t.TUESDAY=2]="TUESDAY",t[t.WEDNESDAY=3]="WEDNESDAY",t[t.THURSDAY=4]="THURSDAY",t[t.FRIDAY=5]="FRIDAY",t[t.SATURDAY=6]="SATURDAY",t))(E||{});const Ye=t=>E[t],U=u.forwardRef((b,o)=>{var p=b,{className:t,type:n}=p,d=H(p,["className","type"]);return e.jsx("input",k({type:n,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:o},d))});U.displayName="Input";var Ue=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Le=Ue.reduce((t,n)=>{const d=Ae(`Primitive.${n}`),o=u.forwardRef((b,p)=>{const l=b,{asChild:T}=l,m=H(l,["asChild"]),f=T?d:n;return typeof window!="undefined"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(f,C(k({},m),{ref:p}))});return o.displayName=`Primitive.${n}`,C(k({},t),{[n]:o})},{}),ze="Label",ge=u.forwardRef((t,n)=>e.jsx(Le.label,C(k({},t),{ref:n,onMouseDown:d=>{var b;d.target.closest("button, input, select, textarea")||((b=t.onMouseDown)==null||b.call(t,d),!d.defaultPrevented&&d.detail>1&&d.preventDefault())}})));ge.displayName=ze;var xe=ge;const We=ke("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),I=u.forwardRef((o,d)=>{var b=o,{className:t}=b,n=H(b,["className"]);return e.jsx(xe,k({ref:d,className:me(We(),t)},n))});I.displayName=xe.displayName;const He=({onPatternChange:t})=>{const{recurringPatterns:n,loading:d,error:o,fetchRecurringPatterns:b,createRecurringPattern:p,updateRecurringPattern:T,deleteRecurringPattern:m,clearError:f}=_(),{user:l}=he(),[g,R]=u.useState(null),[w,$]=u.useState(!1),[j,h]=u.useState({dayOfWeek:E.MONDAY,startTime:"09:00",endTime:"17:00"});u.useEffect(()=>{b()},[b]);const r=a=>v(void 0,null,function*(){a.preventDefault();try{const s=typeof j.dayOfWeek=="number"?j.dayOfWeek:parseInt(String(j.dayOfWeek),10);if(isNaN(s)||s<0||s>6)throw new Error("Invalid day of week selected");yield p(C(k({},j),{dayOfWeek:s})),$(!1),h({dayOfWeek:E.MONDAY,startTime:"09:00",endTime:"17:00"}),l&&t&&t()}catch(s){}}),x=a=>v(void 0,null,function*(){try{yield T(a.id,{isActive:!a.isActive}),l&&t&&t()}catch(s){}}),y=a=>v(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this availability pattern?"))try{yield m(a),l&&t&&t()}catch(s){}}),i=n.reduce((a,s)=>{const c=s.dayOfWeek;return a[c]||(a[c]=[]),a[c].push(s),a},{});return e.jsxs(P,{children:[e.jsxs(V,{children:[e.jsx(G,{children:"Weekly Availability"}),e.jsx(ue,{children:"Set your recurring weekly availability patterns"})]}),e.jsxs(Y,{children:[o&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(K,{children:o}),e.jsx(S,{variant:"ghost",size:"sm",onClick:f,children:"Dismiss"})]}),!w&&e.jsxs(S,{onClick:()=>$(!0),className:"mb-4",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Availability Pattern"]}),w&&e.jsx("form",{onSubmit:r,className:"mb-6 p-4 border rounded-lg",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"dayOfWeek",children:"Day of Week"}),e.jsx("select",{id:"dayOfWeek",value:j.dayOfWeek,onChange:a=>h(C(k({},j),{dayOfWeek:parseInt(a.target.value,10)})),className:"w-full p-2 border rounded",children:[{value:E.SUNDAY,label:"Sunday"},{value:E.MONDAY,label:"Monday"},{value:E.TUESDAY,label:"Tuesday"},{value:E.WEDNESDAY,label:"Wednesday"},{value:E.THURSDAY,label:"Thursday"},{value:E.FRIDAY,label:"Friday"},{value:E.SATURDAY,label:"Saturday"}].map(({value:a,label:s})=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"startTime",children:"Start Time"}),e.jsx(U,{id:"startTime",type:"time",value:j.startTime,onChange:a=>h(C(k({},j),{startTime:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"endTime",children:"End Time"}),e.jsx(U,{id:"endTime",type:"time",value:j.endTime,onChange:a=>h(C(k({},j),{endTime:a.target.value})),required:!0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{type:"submit",disabled:d,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Add Pattern"]}),e.jsxs(S,{type:"button",variant:"outline",onClick:()=>$(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})}),e.jsx("div",{className:"space-y-4",children:[0,1,2,3,4,5,6].map(a=>{const s=i[a]||[];return s.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:Ye(a)}),e.jsx("div",{className:"space-y-2",children:s.map(c=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded ${c.isActive?"bg-green-50":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-mono",children:[c.startTime," - ",c.endTime]}),!c.isActive&&e.jsx("span",{className:"text-sm text-gray-500",children:"(Inactive)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>x(c),disabled:d,children:c.isActive?"Deactivate":"Activate"}),e.jsx(S,{variant:"destructive",size:"sm",onClick:()=>y(c.id),disabled:d,children:e.jsx(oe,{className:"w-4 h-4"})})]})]},c.id))})]},a)})}),n.length===0&&!w&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No availability patterns set. Click "Add Availability Pattern" to get started.'})]})]})},qe=()=>{const{overrides:t,loading:n,error:d,fetchOverrides:o,createOverride:b,deleteOverride:p,clearError:T}=_(),[m,f]=u.useState(!1),[l,g]=u.useState({overrideDate:"",startTime:"",endTime:"",isBlocked:!0,reason:""}),R=r=>{let x;if(r instanceof Date)x=r;else if(typeof r=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(r))return r;x=new Date(r)}else x=new Date(r);const y=x.getFullYear(),i=String(x.getMonth()+1).padStart(2,"0"),a=String(x.getDate()).padStart(2,"0");return`${y}-${i}-${a}`};u.useEffect(()=>{const r=R(new Date),x=new Date;x.setDate(x.getDate()+90);const y=R(x);o(r,y)},[o]);const w=r=>v(void 0,null,function*(){r.preventDefault();try{yield b({overrideDate:l.overrideDate,startTime:l.startTime||void 0,endTime:l.endTime||void 0,isBlocked:l.isBlocked,reason:l.reason||void 0}),f(!1),g({overrideDate:"",startTime:"",endTime:"",isBlocked:!0,reason:""})}catch(x){}}),$=r=>v(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this override?"))try{yield p(r)}catch(x){}}),j=r=>{const x=R(r),[y,i,a]=x.split("-");return new Date(parseInt(y),parseInt(i)-1,parseInt(a)).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},h=[...t].sort((r,x)=>{const y=R(r.overrideDate),i=R(x.overrideDate);return y.localeCompare(i)});return e.jsxs(P,{children:[e.jsxs(V,{children:[e.jsx(G,{children:"Availability Overrides"}),e.jsx(ue,{children:"Block or add availability for specific dates"})]}),e.jsxs(Y,{children:[d&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(K,{children:d}),e.jsx(S,{variant:"ghost",size:"sm",onClick:T,children:"Dismiss"})]}),!m&&e.jsxs(S,{onClick:()=>f(!0),className:"mb-4",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Override"]}),m&&e.jsx("form",{onSubmit:w,className:"mb-6 p-4 border rounded-lg",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"overrideDate",children:"Date"}),e.jsx(U,{id:"overrideDate",type:"date",value:l.overrideDate,onChange:r=>g(C(k({},l),{overrideDate:r.target.value})),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{children:"Type"}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"isBlocked",checked:l.isBlocked,onChange:()=>g(C(k({},l),{isBlocked:!0}))}),e.jsx(re,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Block (Not Available)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"isBlocked",checked:!l.isBlocked,onChange:()=>g(C(k({},l),{isBlocked:!1}))}),e.jsx(ie,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Add (Available)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"startTime",children:"Start Time (optional)"}),e.jsx(U,{id:"startTime",type:"time",value:l.startTime,onChange:r=>g(C(k({},l),{startTime:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"endTime",children:"End Time (optional)"}),e.jsx(U,{id:"endTime",type:"time",value:l.endTime,onChange:r=>g(C(k({},l),{endTime:r.target.value}))})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Leave times empty to apply to the entire day"}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(U,{id:"reason",type:"text",placeholder:"e.g., Vacation, Conference, etc.",value:l.reason,onChange:r=>g(C(k({},l),{reason:r.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{type:"submit",disabled:n,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Add Override"]}),e.jsxs(S,{type:"button",variant:"outline",onClick:()=>f(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.map(r=>e.jsx("div",{className:`p-4 rounded-lg border ${r.isBlocked?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.isBlocked?e.jsx(re,{className:"w-5 h-5 text-red-600"}):e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-semibold",children:r.isBlocked?"Blocked":"Available"})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",j(r.overrideDate)]}),(r.startTime||r.endTime)&&e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",r.startTime||"00:00"," -"," ",r.endTime||"23:59"]}),r.reason&&e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",r.reason]})]})]}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>$(r.id),disabled:n,children:e.jsx(oe,{className:"w-4 h-4 text-red-600"})})]})},r.id))}),t.length===0&&!m&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No overrides set. Click "Add Override" to block or add availability for specific dates.'})]})]})},Ke=({slots:t,startDate:n,endDate:d,bookings:o=[]})=>{const b=we(),T=(()=>{const i=[],a=new Date(n);for(;a<=d;)i.push(new Date(a)),a.setDate(a.getDate()+1);return i})(),m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],f=i=>{if(typeof i=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(i))return i;let a;if(typeof i=="string"){const N=i.match(/^(\d{4})-(\d{2})-(\d{2})/);if(N){const B=parseInt(N[1],10),O=parseInt(N[2],10)-1,F=parseInt(N[3],10);a=new Date(B,O,F)}else a=new Date(i)}else a=i;const s=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),D=String(a.getDate()).padStart(2,"0");return`${s}-${c}-${D}`},l=t.reduce((i,a)=>{const s=f(a.date);return i[s]||(i[s]=[]),i[s].push(a),i},{}),g={},R=o.reduce((i,a)=>{try{const s=new Date(a.scheduledDatetime);if(isNaN(s.getTime()))return console.warn("Invalid booking date:",a.scheduledDatetime,a.id),i;const c=f(s),D=new Date(s);D.setMinutes(D.getMinutes()+(a.durationMinutes||60));const N=L=>{const Q=String(L.getHours()).padStart(2,"0"),z=String(L.getMinutes()).padStart(2,"0");return`${Q}:${z}`},B=N(s),O=N(D),F={date:c,startTime:B,endTime:O,isAvailable:!1,source:"override",reason:`${a.departureAirport} â†’ ${a.arrivalAirport}`},A=`${c}-${B}-${O}`;g[A]=a.id,i[c]||(i[c]=[]),i[c].push(F)}catch(s){console.error("Error processing booking for calendar:",a.id,s)}return i},{}),w={};Object.keys(l).forEach(i=>{w[i]=[...l[i]]}),Object.keys(R).forEach(i=>{w[i]||(w[i]=[]),w[i].push(...R[i])});const $=i=>f(i),j=i=>{const a=new Date;return i.getDate()===a.getDate()&&i.getMonth()===a.getMonth()&&i.getFullYear()===a.getFullYear()},h=[];let r=[];const x=T[0].getDay();for(let i=0;i<x;i++){const a=new Date(T[0]);a.setDate(a.getDate()-(x-i)),r.push(a)}if(T.forEach(i=>{r.push(i),r.length===7&&(h.push(r),r=[])}),r.length>0){for(;r.length<7;){const i=r[r.length-1],a=new Date(i);a.setDate(a.getDate()+1),r.push(a)}h.push(r)}const y=Te(n,"MMMM yyyy");return e.jsxs(P,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"Availability Calendar"}),e.jsx("div",{className:"text-lg font-semibold text-gray-700",children:y})]})}),e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[m.map(i=>e.jsx("div",{className:"text-center font-semibold p-2 text-sm",children:i},i)),h.map((i,a)=>i.map((s,c)=>{const D=$(s),N=w[D]||[],B=s>=n&&s<=d,O=N.filter(A=>A.isAvailable),F=N.filter(A=>!A.isAvailable);return e.jsxs("div",{className:`
                    min-h-[100px] p-2 border rounded-lg
                    ${B?"":"bg-gray-50 text-gray-400"}
                    ${j(s)?"ring-2 ring-blue-500":""}
                    ${B&&O.length>0&&F.length===0?"bg-green-50":""}
                    ${B&&O.length===0&&N.length===0?"bg-gray-50":""}
                    ${B&&F.length>0?"bg-red-50 border-red-200":""}
                    ${B&&O.length>0&&F.length>0?"bg-yellow-50 border-yellow-200":""}
                  `,children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:s.getDate()}),B&&(N.length>0||F.length>0)&&e.jsxs("div",{className:"space-y-1",children:[[...F,...O].slice(0,3).map((A,L)=>{const Q=`${D}-${A.startTime}-${A.endTime}`,z=g[Q],ve=!A.isAvailable&&z,ee=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-mono text-[10px]",children:[A.startTime," - ",A.endTime]}),A.reason&&e.jsx("div",{className:"truncate font-semibold",title:A.reason,children:A.reason})]});return ve?e.jsx("div",{onClick:ye=>{ye.stopPropagation(),b(`/bookings/${z}`)},className:`text-xs p-1 rounded cursor-pointer transition-all hover:shadow-md hover:scale-105 ${A.isAvailable?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,title:"Click to view booking details",children:ee},L):e.jsx("div",{className:`text-xs p-1 rounded ${A.isAvailable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:ee},L)}),F.length+O.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",F.length+O.length-3," more"]})]})]},`${a}-${c}`)}))]}),e.jsxs("div",{className:"mt-6 flex gap-6 justify-center text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{children:"Blocked"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-100 border border-gray-200 rounded"}),e.jsx("span",{children:"No Pattern Set"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 rounded"}),e.jsx("span",{children:"Today"})]})]})]})]})},tt=()=>{const{user:t}=he(),{availability:n,loading:d,error:o,fetchAvailability:b,clearError:p}=_(),[T,m]=u.useState([]),[f,l]=u.useState(!1),[g,R]=u.useState({startDate:new Date().toISOString().split("T")[0],endDate:(()=>{const h=new Date;return h.setDate(h.getDate()+30),h.toISOString().split("T")[0]})()});u.useEffect(()=>{t&&(w(),$())},[t,g]);const w=()=>{t&&b(t.id,g.startDate,g.endDate)},$=()=>v(void 0,null,function*(){if(t)try{l(!0);let h=[];t.role===ne.INSTRUCTOR?h=yield Z.listBookings({instructorId:t.id,startDate:g.startDate,endDate:g.endDate,limit:1e3}):t.role===ne.STUDENT?h=yield Z.listBookings({studentId:t.id,startDate:g.startDate,endDate:g.endDate,limit:1e3}):(t.role==="ADMIN"||t.role==="admin")&&(h=yield Z.listBookings({startDate:g.startDate,endDate:g.endDate,limit:1e3})),m(h)}catch(h){console.error("Failed to load bookings for availability calendar:",h)}finally{l(!1)}}),j=h=>{const r=new Date,x=r.toISOString().split("T")[0];let y;switch(h){case"week":y=new Date(r),y.setDate(y.getDate()+7);break;case"month":y=new Date(r),y.setDate(y.getDate()+30);break;case"3months":y=new Date(r),y.setDate(y.getDate()+90);break}R({startDate:x,endDate:y.toISOString().split("T")[0]})};return t?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Availability Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage your weekly recurring availability and one-time overrides"})]}),o&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(K,{children:o}),e.jsx(S,{variant:"ghost",size:"sm",onClick:p,children:"Dismiss"})]}),e.jsxs(Se,{defaultValue:"calendar",className:"space-y-6",children:[e.jsxs(Ce,{className:"grid w-full grid-cols-3 max-w-md",children:[e.jsxs(X,{value:"calendar",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Calendar"]}),e.jsxs(X,{value:"recurring",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Weekly"]}),e.jsxs(X,{value:"overrides",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Overrides"]})]}),e.jsxs(J,{value:"calendar",className:"space-y-6",children:[e.jsxs(P,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"Availability Overview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>j("week"),children:"1 Week"}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>j("month"),children:"1 Month"}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>j("3months"),children:"3 Months"})]})]})}),e.jsx(Y,{children:d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):n?e.jsx(Ke,{slots:n.slots,startDate:new Date(g.startDate),endDate:new Date(g.endDate),bookings:T}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No availability data to display"})})]}),n&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(P,{children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:n.slots.filter(h=>h.isAvailable).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Available Slots"})]})})}),e.jsx(P,{children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:n.recurringPatterns.filter(h=>h.isActive).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Active Patterns"})]})})}),e.jsx(P,{children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:n.overrides.filter(h=>h.isBlocked).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Blocked Days"})]})})})]})]}),e.jsx(J,{value:"recurring",children:e.jsx(He,{onPatternChange:w})}),e.jsx(J,{value:"overrides",children:e.jsx(qe,{})})]})]}):e.jsx(q,{children:e.jsx(K,{children:"Please log in to manage your availability."})})};export{tt as AvailabilityCalendar};
