var P=Object.defineProperty,U=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var R=(i,n,a)=>n in i?P(i,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[n]=a,L=(i,n)=>{for(var a in n||(n={}))K.call(n,a)&&R(i,a,n[a]);if(A)for(var a of A(n))V.call(n,a)&&R(i,a,n[a]);return i},$=(i,n)=>U(i,_(n));var B=(i,n,a)=>new Promise((v,x)=>{var f=g=>{try{u(a.next(g))}catch(p){x(p)}},N=g=>{try{u(a.throw(g))}catch(p){x(p)}},u=g=>g.done?v(g.value):Promise.resolve(g.value).then(f,N);u((a=a.apply(i,n)).next())});import{j as e,m as H,C as Y}from"./ui-vendor-D_mUPHSy.js";import{u as W,r as y,L as I}from"./react-vendor-DxF-uWSm.js";import{B as G}from"./booking-AmzbvAEe.js";import{B as D}from"./booking-CF_xURUj.js";import{T as q}from"./weather-BNlE3esQ.js";import{C as J,a as Q,b as X,d as Z,u as ee,U as F}from"./index-Ca8S-__f.js";import{T as te,a as se,b as M,c as O}from"./tabs-lIa_TwUu.js";import"./utils-vendor-1hodNj4h.js";const re=({bookings:i,startDate:n,endDate:a,onBookingClick:v})=>{const x=s=>{const r=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),h=String(s.getDate()).padStart(2,"0");return`${r}-${d}-${h}`},f=s=>{const r=new Date(s);return r.setHours(0,0,0,0),r},u=(()=>{const s=[],r=new Date(n);for(;r<=a;)s.push(new Date(r)),r.setDate(r.getDate()+1);return s})(),g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],p=i.reduce((s,r)=>{try{const d=new Date(r.scheduledDatetime);if(isNaN(d.getTime()))return console.warn("Invalid booking date:",r.scheduledDatetime,r.id),s;const h=x(d);s[h]||(s[h]=[]),s[h].push(r),console.log(`BookingsCalendar - Added booking ${r.id} to date ${h} (from ${r.scheduledDatetime})`)}catch(d){console.error("Error processing booking date:",r.id,d)}return s},{});console.log("=== BookingsCalendar Debug ==="),console.log("Total bookings received:",i.length),console.log("Date range:",x(n),"to",x(a)),console.log("Bookings by date keys:",Object.keys(p)),i.length>0?i.forEach(s=>{const r=new Date(s.scheduledDatetime),d=x(r);console.log(`Booking ${s.id}:`,{scheduledDatetime:s.scheduledDatetime,formattedDate:d,departureAirport:s.departureAirport,arrivalAirport:s.arrivalAirport,inDateRange:d>=x(n)&&d<=x(a)})}):console.warn("No bookings passed to calendar component!"),console.log("=== End Debug ===");const b=s=>{const r=new Date;return s.getDate()===r.getDate()&&s.getMonth()===r.getMonth()&&s.getFullYear()===r.getFullYear()},C=s=>new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),w=[];let o=[];const c=u[0].getDay();for(let s=0;s<c;s++){const r=new Date(u[0]);r.setDate(r.getDate()-(c-s)),o.push(r)}if(u.forEach(s=>{o.push(s),o.length===7&&(w.push(o),o=[])}),o.length>0){for(;o.length<7;){const s=o[o.length-1],r=new Date(s);r.setDate(r.getDate()+1),o.push(r)}w.push(o)}const T=s=>{switch(s){case"CONFIRMED":return"bg-green-100 text-green-800 border-green-300";case"AT_RISK":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"RESCHEDULING":return"bg-orange-100 text-orange-800 border-orange-300";case"CANCELLED":return"bg-red-100 text-red-800 border-red-300";case"COMPLETED":return"bg-blue-100 text-blue-800 border-blue-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}};return e.jsxs(J,{children:[e.jsx(Q,{children:e.jsx(X,{children:"Bookings Calendar"})}),e.jsxs(Z,{children:[e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[g.map(s=>e.jsx("div",{className:"text-center font-semibold p-2 text-sm",children:s},s)),w.map((s,r)=>s.map((d,h)=>{const j=x(d),m=p[j]||[],S=f(d),k=f(n),E=f(a),t=S>=k&&S<=E;return m.length>0&&console.log(`âœ“ Rendering ${m.length} booking(s) for ${j}`,{date:d.toISOString(),inRange:t,bookings:m.map(l=>`${l.departureAirport}â†’${l.arrivalAirport}`)}),d.getMonth()===10&&d.getDate()===12&&d.getFullYear()===2025&&console.log("ðŸ” November 12, 2025 cell:",{dateKey:j,dayBookings:m.length,bookingsByDateKeys:Object.keys(p),isInRange:t,normalizedDate:S.toISOString(),normalizedStart:k.toISOString(),normalizedEnd:E.toISOString()}),e.jsxs("div",{className:`
                    min-h-[100px] p-2 border rounded-lg
                    ${t?"bg-white":"bg-gray-50 text-gray-400"}
                    ${b(d)?"ring-2 ring-blue-500":""}
                    ${t&&m.length>0?"bg-blue-50":""}
                  `,children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:d.getDate()}),t&&m.length>0&&e.jsxs("div",{className:"space-y-1",children:[m.slice(0,3).map(l=>e.jsxs("div",{onClick:()=>v==null?void 0:v(l),className:`
                            text-xs p-1 rounded border cursor-pointer hover:opacity-80
                            ${T(l.status)}
                          `,title:`${l.departureAirport} â†’ ${l.arrivalAirport} - ${C(l.scheduledDatetime)}`,children:[e.jsxs("div",{className:"font-semibold truncate",children:[l.departureAirport," â†’ ",l.arrivalAirport]}),e.jsx("div",{className:"font-mono text-[10px]",children:C(l.scheduledDatetime)}),e.jsx("div",{className:"text-[10px] opacity-75",children:l.status.replace("_"," ")})]},l.id)),m.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",m.length-3," more"]})]})]},`${r}-${h}`)}))]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-100 border border-green-300"}),e.jsx("span",{children:"Confirmed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-100 border border-yellow-300"}),e.jsx("span",{children:"At Risk"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-orange-100 border border-orange-300"}),e.jsx("span",{children:"Rescheduling"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-100 border border-red-300"}),e.jsx("span",{children:"Cancelled"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-100 border border-blue-300"}),e.jsx("span",{children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-blue-500"}),e.jsx("span",{children:"Today"})]})]})]})]})};function ge(){const i=W(),{user:n}=ee(),[a,v]=y.useState([]),[x,f]=y.useState(!0),[N,u]=y.useState(null),[g,p]=y.useState("list"),[b,C]=y.useState({limit:100,offset:0}),[w,o]=y.useState(0),[c,T]=y.useState(1),s=b.limit||20,[r,d]=y.useState({startDate:(()=>{const t=new Date;return t.setDate(t.getDate()-7),t})(),endDate:(()=>{const t=new Date;return t.setDate(t.getDate()+30),t})()});y.useEffect(()=>{n&&h()},[b,n]);const h=()=>B(this,null,function*(){if(n)try{f(!0),u(null);const t=L({},b);n.role===F.STUDENT?t.studentId=n.id:n.role===F.INSTRUCTOR&&(t.instructorId=n.id);const l=yield G.listBookings(t);v(l),l.length<s?o((c-1)*s+l.length):o(c*s+1)}catch(t){u(t instanceof Error?t.message:"Failed to load bookings")}finally{f(!1)}}),j=t=>{T(t),C(l=>$(L({},l),{offset:(t-1)*s}))},m=(t,l)=>{C(z=>$(L({},z),{[t]:l||void 0,offset:0})),T(1)},S=t=>new Date(t).toLocaleString(),k=t=>{switch(t){case D.CONFIRMED:return"bg-green-100 text-green-800";case D.AT_RISK:return"bg-yellow-100 text-yellow-800";case D.RESCHEDULING:return"bg-blue-100 text-blue-800";case D.CANCELLED:return"bg-red-100 text-red-800";case D.COMPLETED:return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};if(x)return e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"text-gray-600",children:"Loading bookings..."})});const E=t=>{i(`/bookings/${t.id}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Flight Bookings"}),e.jsx(I,{to:"/bookings/new",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Create Booking"})]}),e.jsxs(te,{value:g,onValueChange:t=>p(t),children:[e.jsxs(se,{className:"grid w-full max-w-md grid-cols-2 mb-6",children:[e.jsxs(M,{value:"list",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"List View"]}),e.jsxs(M,{value:"calendar",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Calendar View"]})]}),e.jsxs(O,{value:"list",className:"space-y-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:b.status||"",onChange:t=>m("status",t.target.value||void 0),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),Object.values(D).map(t=>e.jsx("option",{value:t,children:t.replace("_"," ")},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Training Level"}),e.jsxs("select",{value:b.trainingLevel||"",onChange:t=>m("trainingLevel",t.target.value||void 0),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All"}),Object.values(q).map(t=>e.jsx("option",{value:t,children:t.replace("_"," ")},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:b.startDate||"",onChange:t=>m("startDate",t.target.value||void 0),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:b.endDate||"",onChange:t=>m("endDate",t.target.value||void 0),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]})}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:N}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Flight"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scheduled"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Training Level"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"No bookings found"})}):a.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>i(`/bookings/${t.id}`),children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.departureAirport," â†’ ",t.arrivalAirport]}),t.aircraftId&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Aircraft: ",t.aircraftId]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:S(t.scheduledDatetime)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${k(t.status)}`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.trainingLevel.replace("_"," ")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t.durationMinutes," min"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(I,{to:`/bookings/${t.id}`,className:"text-blue-600 hover:text-blue-900",onClick:l=>l.stopPropagation(),children:"View"})})]},t.id))})]})}),a.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200 sm:px-6",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>j(Math.max(1,c-1)),disabled:c===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>j(c+1),disabled:a.length<s,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(c-1)*s+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(c*s,w||a.length)})," ","of ",e.jsx("span",{className:"font-medium",children:w||a.length})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>j(Math.max(1,c-1)),disabled:c===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:["Page ",c]}),e.jsx("button",{onClick:()=>j(c+1),disabled:a.length<s,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})})]})]})]}),e.jsx(O,{value:"calendar",className:"space-y-6",children:x?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"text-gray-600",children:"Loading bookings..."})}):N?e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:N}):e.jsx(e.Fragment,{children:a.length===0?e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded",children:"No bookings found. Create a booking to see it on the calendar."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["Showing ",a.length," booking(s) from ",r.startDate.toLocaleDateString()," to ",r.endDate.toLocaleDateString()]}),e.jsx(re,{bookings:a,startDate:r.startDate,endDate:r.endDate,onBookingClick:E})]})})})]})]})}export{ge as default};
