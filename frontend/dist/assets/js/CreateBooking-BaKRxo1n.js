var U=Object.defineProperty,E=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var D=(s,t,r)=>t in s?U(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,f=(s,t)=>{for(var r in t||(t={}))O.call(t,r)&&D(s,r,t[r]);if(A)for(var r of A(t))k.call(t,r)&&D(s,r,t[r]);return s},v=(s,t)=>E(s,R(t));var N=(s,t,r)=>new Promise((c,h)=>{var b=m=>{try{n(r.next(m))}catch(j){h(j)}},y=m=>{try{n(r.throw(m))}catch(j){h(j)}},n=m=>m.done?c(m.value):Promise.resolve(m.value).then(b,y);n((r=r.apply(s,t)).next())});import{j as e}from"./ui-vendor-D_mUPHSy.js";import{u as q,r as g}from"./react-vendor-DxF-uWSm.js";import{B as _}from"./booking-D12B4RPg.js";import{e as K,u as B,U as x,g as F,s as M}from"./index-D77Jmaxr.js";import{T as L}from"./weather-BNlE3esQ.js";import{A as P,a as $}from"./alert-DrpU_zx8.js";import"./utils-vendor-1hodNj4h.js";function z(s){return{id:s.id,email:s.email,firstName:s.first_name,lastName:s.last_name,name:`${s.first_name} ${s.last_name}`.trim(),phoneNumber:s.phone_number,role:s.role,trainingLevel:s.training_level,createdAt:s.created_at,updatedAt:s.updated_at}}class J{listUsers(){return N(this,arguments,function*(t={}){const r=new URLSearchParams;t.role&&r.append("role",t.role),t.limit&&r.append("limit",t.limit.toString()),t.offset&&r.append("offset",t.offset.toString());const c=r.toString(),h=`/api/users/list${c?`?${c}`:""}`,b=yield K.get(h);return{users:b.data.users.map(z),count:b.data.count}})}getInstructors(){return N(this,null,function*(){return(yield this.listUsers({role:"INSTRUCTOR",limit:100})).users})}getStudents(){return N(this,null,function*(){return(yield this.listUsers({role:"STUDENT",limit:100})).users})}}const W=new J,S=[{code:"KJFK",name:"New York JFK",lat:40.6413,lon:-73.7781},{code:"KLAX",name:"Los Angeles",lat:33.9416,lon:-118.4085},{code:"KORD",name:"Chicago O'Hare",lat:41.9786,lon:-87.9048},{code:"KDFW",name:"Dallas Fort Worth",lat:32.8998,lon:-97.0403},{code:"KATL",name:"Atlanta",lat:33.6407,lon:-84.4277},{code:"KBOS",name:"Boston",lat:42.3656,lon:-71.0096},{code:"KSEA",name:"Seattle",lat:47.4502,lon:-122.3088},{code:"KLAS",name:"Las Vegas",lat:36.084,lon:-115.1537}];function re(){const s=q(),{user:t}=B(),[r,c]=g.useState({trainingLevel:L.STUDENT_PILOT,durationMinutes:60}),[h,b]=g.useState(!1),[y,n]=g.useState(null),[m,j]=g.useState([]),[I,w]=g.useState(!1);g.useEffect(()=>{var a;if(t&&t.id){console.log("Auto-populating user ID:",t.id,"Role:",t.role);const o=(a=t.role)==null?void 0:a.toUpperCase();o==="STUDENT"||t.role===x.STUDENT?(c(u=>v(f({},u),{studentId:t.id})),console.log("Set studentId to:",t.id)):o==="INSTRUCTOR"||t.role===x.INSTRUCTOR?(c(u=>v(f({},u),{instructorId:t.id})),console.log("Set instructorId to:",t.id)):console.log("Role not matched:",t.role,"normalized:",o)}else console.log("User not available yet:",t)},[t]),g.useEffect(()=>{t&&N(this,null,function*(){var u;if(((u=t==null?void 0:t.role)==null?void 0:u.toUpperCase())==="STUDENT"||(t==null?void 0:t.role)===x.STUDENT){w(!0);try{const l=yield W.getInstructors();j(l)}catch(l){console.error("Failed to load instructors:",l),n("Failed to load instructors. Please refresh the page.")}finally{w(!1)}}})},[t]),g.useEffect(()=>{if(r.departureAirport){const a=S.find(o=>o.code===r.departureAirport);a&&c(o=>v(f({},o),{departureLatitude:a.lat,departureLongitude:a.lon}))}},[r.departureAirport]),g.useEffect(()=>{if(r.arrivalAirport){const a=S.find(o=>o.code===r.arrivalAirport);a&&c(o=>v(f({},o),{arrivalLatitude:a.lat,arrivalLongitude:a.lon}))}},[r.arrivalAirport]);const i=a=>{const{name:o,value:u}=a.target;c(l=>v(f({},l),{[o]:u}))},T=a=>N(this,null,function*(){var o,u;if(a.preventDefault(),n(null),!r.studentId||!r.instructorId){n("Student and Instructor are required");return}if(!r.departureAirport||!r.arrivalAirport){n("Departure and arrival airports are required");return}if(!r.scheduledDatetime){n("Scheduled date and time is required");return}if(!r.departureLatitude||!r.departureLongitude||!r.arrivalLatitude||!r.arrivalLongitude){n("Airport coordinates are missing");return}try{b(!0);const l=r.scheduledDatetime?new Date(r.scheduledDatetime).toISOString():null;if(!l){n("Scheduled date and time is required");return}const p={studentId:r.studentId.trim(),instructorId:r.instructorId.trim(),departureAirport:r.departureAirport,arrivalAirport:r.arrivalAirport,departureLatitude:Number(r.departureLatitude),departureLongitude:Number(r.departureLongitude),arrivalLatitude:Number(r.arrivalLatitude),arrivalLongitude:Number(r.arrivalLongitude),scheduledDatetime:l,trainingLevel:r.trainingLevel||L.STUDENT_PILOT,durationMinutes:Number(r.durationMinutes||60)},d=(o=r.aircraftId)==null?void 0:o.trim();d&&d.length>0&&(p.aircraftId=d);const C=yield _.createBooking(p);s(`/bookings/${C.id}`)}catch(l){let p="Failed to create booking";if((u=l==null?void 0:l.response)!=null&&u.data){const d=l.response.data;d.errors&&Array.isArray(d.errors)?p=d.errors.join(". "):d.message?p=d.message:d.error&&(p=d.error)}else p=F(l).message;n(p),M(l,"create-booking")}finally{b(!1)}});return e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Booking"}),e.jsx("p",{className:"text-gray-600",children:"Schedule a new flight training session"})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[y&&e.jsx(P,{variant:"destructive",children:e.jsx($,{children:y})}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t&&(t.role===x.INSTRUCTOR||t.role===x.ADMIN)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student *"}),e.jsx("input",{type:"text",name:"studentId",required:!0,value:r.studentId||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Enter student UUID"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UUID of the student"})]}),t&&t.role===x.STUDENT&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instructor *"}),e.jsxs("select",{name:"instructorId",required:!0,value:r.instructorId||"",onChange:i,disabled:I,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:I?"Loading instructors...":"Select an instructor..."}),m.map(a=>e.jsxs("option",{value:a.id,children:[a.firstName," ",a.lastName," (",a.email,")"]},a.id))]}),I&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Loading instructors..."}),!I&&m.length===0&&e.jsx("p",{className:"mt-1 text-xs text-yellow-600",children:"No instructors available"})]}),t&&(t.role===x.INSTRUCTOR||t.role===x.ADMIN)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instructor ID *"}),e.jsx("input",{type:"text",name:"instructorId",required:!0,value:r.instructorId||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Enter instructor UUID"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UUID of the instructor"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departure Airport *"}),e.jsxs("select",{name:"departureAirport",required:!0,value:r.departureAirport||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),S.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Arrival Airport *"}),e.jsxs("select",{name:"arrivalAirport",required:!0,value:r.arrivalAirport||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),S.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aircraft ID"}),e.jsx("input",{type:"text",name:"aircraftId",value:r.aircraftId||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"N12345"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Date & Time *"}),e.jsx("input",{type:"datetime-local",name:"scheduledDatetime",required:!0,value:r.scheduledDatetime||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Level *"}),e.jsx("select",{name:"trainingLevel",required:!0,value:r.trainingLevel||L.STUDENT_PILOT,onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:Object.values(L).map(a=>e.jsx("option",{value:a,children:a.replace("_"," ")},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes) *"}),e.jsx("input",{type:"number",name:"durationMinutes",required:!0,min:"15",max:"480",value:r.durationMinutes||60,onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Coordinates (Auto-filled)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Departure Lat"}),e.jsx("input",{type:"number",step:"0.0001",name:"departureLatitude",value:r.departureLatitude||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Departure Lon"}),e.jsx("input",{type:"number",step:"0.0001",name:"departureLongitude",value:r.departureLongitude||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Arrival Lat"}),e.jsx("input",{type:"number",step:"0.0001",name:"arrivalLatitude",value:r.arrivalLatitude||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Arrival Lon"}),e.jsx("input",{type:"number",step:"0.0001",name:"arrivalLongitude",value:r.arrivalLongitude||"",onChange:i,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/bookings"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:h?"Creating...":"Create Booking"})]})]})]})}export{re as default};
