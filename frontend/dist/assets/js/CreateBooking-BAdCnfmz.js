var w=Object.defineProperty,S=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var L=(l,t,r)=>t in l?w(l,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[t]=r,g=(l,t)=>{for(var r in t||(t={}))C.call(t,r)&&L(l,r,t[r]);if(N)for(var r of N(t))T.call(t,r)&&L(l,r,t[r]);return l},x=(l,t)=>S(l,k(t));var A=(l,t,r)=>new Promise((m,p)=>{var f=s=>{try{o(r.next(s))}catch(h){p(h)}},v=s=>{try{o(r.throw(s))}catch(h){p(h)}},o=s=>s.done?m(s.value):Promise.resolve(s.value).then(f,v);o((r=r.apply(l,t)).next())});import{j as e}from"./ui-vendor-BJJ7qMNn.js";import{c as U,r as b}from"./react-vendor-ClLnrwvH.js";import{B as E}from"./booking-BFbKruZE.js";import{T as j}from"./weather-BNlE3esQ.js";import{u as O,U as I,g as R,s as q}from"./index-Cr9STeZ2.js";import{A as K,a as B}from"./alert-C3dhOqAy.js";import"./utils-vendor-1hodNj4h.js";const y=[{code:"KJFK",name:"New York JFK",lat:40.6413,lon:-73.7781},{code:"KLAX",name:"Los Angeles",lat:33.9416,lon:-118.4085},{code:"KORD",name:"Chicago O'Hare",lat:41.9786,lon:-87.9048},{code:"KDFW",name:"Dallas Fort Worth",lat:32.8998,lon:-97.0403},{code:"KATL",name:"Atlanta",lat:33.6407,lon:-84.4277},{code:"KBOS",name:"Boston",lat:42.3656,lon:-71.0096},{code:"KSEA",name:"Seattle",lat:47.4502,lon:-122.3088},{code:"KLAS",name:"Las Vegas",lat:36.084,lon:-115.1537}];function V(){const l=U(),{user:t}=O(),[r,m]=b.useState({trainingLevel:j.STUDENT_PILOT,durationMinutes:60}),[p,f]=b.useState(!1),[v,o]=b.useState(null);b.useEffect(()=>{var a;if(t&&t.id){console.log("Auto-populating user ID:",t.id,"Role:",t.role);const d=(a=t.role)==null?void 0:a.toUpperCase();d==="STUDENT"||t.role===I.STUDENT?(m(u=>x(g({},u),{studentId:t.id})),console.log("Set studentId to:",t.id)):d==="INSTRUCTOR"||t.role===I.INSTRUCTOR?(m(u=>x(g({},u),{instructorId:t.id})),console.log("Set instructorId to:",t.id)):console.log("Role not matched:",t.role,"normalized:",d)}else console.log("User not available yet:",t)},[t]),b.useEffect(()=>{if(r.departureAirport){const a=y.find(d=>d.code===r.departureAirport);a&&m(d=>x(g({},d),{departureLatitude:a.lat,departureLongitude:a.lon}))}},[r.departureAirport]),b.useEffect(()=>{if(r.arrivalAirport){const a=y.find(d=>d.code===r.arrivalAirport);a&&m(d=>x(g({},d),{arrivalLatitude:a.lat,arrivalLongitude:a.lon}))}},[r.arrivalAirport]);const s=a=>{const{name:d,value:u}=a.target;m(n=>x(g({},n),{[d]:u}))},h=a=>A(this,null,function*(){var d,u;if(a.preventDefault(),o(null),!r.studentId||!r.instructorId){o("Student and Instructor are required");return}if(!r.departureAirport||!r.arrivalAirport){o("Departure and arrival airports are required");return}if(!r.scheduledDatetime){o("Scheduled date and time is required");return}if(!r.departureLatitude||!r.departureLongitude||!r.arrivalLatitude||!r.arrivalLongitude){o("Airport coordinates are missing");return}try{f(!0);const n=r.scheduledDatetime?new Date(r.scheduledDatetime).toISOString():null;if(!n){o("Scheduled date and time is required");return}const c={studentId:r.studentId.trim(),instructorId:r.instructorId.trim(),departureAirport:r.departureAirport,arrivalAirport:r.arrivalAirport,departureLatitude:Number(r.departureLatitude),departureLongitude:Number(r.departureLongitude),arrivalLatitude:Number(r.arrivalLatitude),arrivalLongitude:Number(r.arrivalLongitude),scheduledDatetime:n,trainingLevel:r.trainingLevel||j.STUDENT_PILOT,durationMinutes:Number(r.durationMinutes||60)},i=(d=r.aircraftId)==null?void 0:d.trim();i&&i.length>0&&(c.aircraftId=i);const D=yield E.createBooking(c);l(`/bookings/${D.id}`)}catch(n){let c="Failed to create booking";if((u=n==null?void 0:n.response)!=null&&u.data){const i=n.response.data;i.errors&&Array.isArray(i.errors)?c=i.errors.join(". "):i.message?c=i.message:i.error&&(c=i.error)}else c=R(n).message;o(c),q(n,"create-booking")}finally{f(!1)}});return e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Booking"}),e.jsx("p",{className:"text-gray-600",children:"Schedule a new flight training session"})]}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[v&&e.jsx(K,{variant:"destructive",children:e.jsx(B,{children:v})}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Student ID *"}),e.jsx("input",{type:"text",name:"studentId",required:!0,value:r.studentId||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Enter student UUID"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UUID of the student (from users table)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instructor ID *"}),e.jsx("input",{type:"text",name:"instructorId",required:!0,value:r.instructorId||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Enter instructor UUID"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UUID of the instructor (from users table)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Departure Airport *"}),e.jsxs("select",{name:"departureAirport",required:!0,value:r.departureAirport||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),y.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Arrival Airport *"}),e.jsxs("select",{name:"arrivalAirport",required:!0,value:r.arrivalAirport||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),y.map(a=>e.jsxs("option",{value:a.code,children:[a.code," - ",a.name]},a.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Aircraft ID"}),e.jsx("input",{type:"text",name:"aircraftId",value:r.aircraftId||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"N12345"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Scheduled Date & Time *"}),e.jsx("input",{type:"datetime-local",name:"scheduledDatetime",required:!0,value:r.scheduledDatetime||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Training Level *"}),e.jsx("select",{name:"trainingLevel",required:!0,value:r.trainingLevel||j.STUDENT_PILOT,onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:Object.values(j).map(a=>e.jsx("option",{value:a,children:a.replace("_"," ")},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes) *"}),e.jsx("input",{type:"number",name:"durationMinutes",required:!0,min:"15",max:"480",value:r.durationMinutes||60,onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Coordinates (Auto-filled)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Departure Lat"}),e.jsx("input",{type:"number",step:"0.0001",name:"departureLatitude",value:r.departureLatitude||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Departure Lon"}),e.jsx("input",{type:"number",step:"0.0001",name:"departureLongitude",value:r.departureLongitude||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Arrival Lat"}),e.jsx("input",{type:"number",step:"0.0001",name:"arrivalLatitude",value:r.arrivalLatitude||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Arrival Lon"}),e.jsx("input",{type:"number",step:"0.0001",name:"arrivalLongitude",value:r.arrivalLongitude||"",onChange:s,className:"w-full rounded-md border-gray-300 shadow-sm text-sm",readOnly:!0})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>l("/bookings"),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:p?"Creating...":"Create Booking"})]})]})]})}export{V as default};
