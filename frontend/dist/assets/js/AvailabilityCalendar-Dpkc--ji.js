var be=Object.defineProperty,fe=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var te=(t,i,d)=>i in t?be(t,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[i]=d,A=(t,i)=>{for(var d in i||(i={}))ae.call(i,d)&&te(t,d,i[d]);if(W)for(var d of W(i))se.call(i,d)&&te(t,d,i[d]);return t},S=(t,i)=>fe(t,je(i));var H=(t,i)=>{var d={};for(var o in t)ae.call(t,o)&&i.indexOf(o)<0&&(d[o]=t[o]);if(t!=null&&W)for(var o of W(t))i.indexOf(o)<0&&se.call(t,o)&&(d[o]=t[o]);return d};var v=(t,i,d)=>new Promise((o,b)=>{var p=f=>{try{m(d.next(f))}catch(n){b(n)}},k=f=>{try{m(d.throw(f))}catch(n){b(n)}},m=f=>f.done?o(f.value):Promise.resolve(f.value).then(p,k);m((d=d.apply(t,i)).next())});import{j as e,K as le,E as de,X as ce,N as oe,O as re,Q as ie,C as pe,t as De,z as Ne}from"./ui-vendor-X7k4bu4n.js";import{r as u,u as we}from"./react-vendor-C9zT986Q.js";import{e as I,h as me,j as Ae,i as ke,u as he,C as P,a as V,b as G,c as ue,d as Y,B as T,U as ne}from"./index-DDVNj2O6.js";import{A as q,a as K}from"./alert-D1yonbLc.js";import{f as Te}from"./utils-vendor-1hodNj4h.js";import{T as Se,a as Ce,b as X,c as J}from"./tabs-C3_svGwP.js";import{B as Z}from"./booking-EhZRWkcT.js";const Re=(t,i,d)=>v(void 0,null,function*(){return(yield I.get("/availability",{params:{userId:t,startDate:i,endDate:d}})).data}),$e=()=>v(void 0,null,function*(){return(yield I.get("/availability/recurring")).data}),Be=t=>v(void 0,null,function*(){return(yield I.post("/availability/recurring",t)).data}),Oe=(t,i)=>v(void 0,null,function*(){return(yield I.put(`/availability/recurring/${t}`,i)).data}),Fe=t=>v(void 0,null,function*(){yield I.delete(`/availability/recurring/${t}`)}),Ee=(t,i)=>v(void 0,null,function*(){return(yield I.get("/availability/overrides",{params:{startDate:t,endDate:i}})).data}),Me=t=>v(void 0,null,function*(){return(yield I.post("/availability/overrides",t)).data}),Ie=(t,i)=>v(void 0,null,function*(){return(yield I.put(`/availability/overrides/${t}`,i)).data}),Pe=t=>v(void 0,null,function*(){yield I.delete(`/availability/overrides/${t}`)}),_=()=>{const[t,i]=u.useState(null),[d,o]=u.useState([]),[b,p]=u.useState([]),[k,m]=u.useState(!1),[f,n]=u.useState(null),g=u.useCallback((a,s,c)=>v(void 0,null,function*(){m(!0),n(null);try{const D=yield Re(a,s,c);i(D),o(D.recurringPatterns),p(D.overrides)}catch(D){throw n(D.message||"Failed to fetch availability"),D}finally{m(!1)}}),[]),C=u.useCallback(()=>v(void 0,null,function*(){m(!0),n(null);try{const a=yield $e();o(a)}catch(a){throw n(a.message||"Failed to fetch recurring patterns"),a}finally{m(!1)}}),[]),N=u.useCallback((a,s)=>v(void 0,null,function*(){m(!0),n(null);try{const c=yield Ee(a,s);p(c)}catch(c){throw n(c.message||"Failed to fetch overrides"),c}finally{m(!1)}}),[]),$=u.useCallback(a=>v(void 0,null,function*(){m(!0),n(null);try{const s=yield Be(a);o(c=>[...c,s])}catch(s){throw n(s.message||"Failed to create recurring pattern"),s}finally{m(!1)}}),[]),j=u.useCallback((a,s)=>v(void 0,null,function*(){m(!0),n(null);try{const c=yield Oe(a,s);o(D=>D.map(R=>R.id===a?c:R))}catch(c){throw n(c.message||"Failed to update recurring pattern"),c}finally{m(!1)}}),[]),h=u.useCallback(a=>v(void 0,null,function*(){m(!0),n(null);try{yield Fe(a),o(s=>s.filter(c=>c.id!==a))}catch(s){throw n(s.message||"Failed to delete recurring pattern"),s}finally{m(!1)}}),[]),r=u.useCallback(a=>v(void 0,null,function*(){m(!0),n(null);try{const s=yield Me(a);p(c=>[...c,s])}catch(s){throw n(s.message||"Failed to create override"),s}finally{m(!1)}}),[]),x=u.useCallback((a,s)=>v(void 0,null,function*(){m(!0),n(null);try{const c=yield Ie(a,s);p(D=>D.map(R=>R.id===a?c:R))}catch(c){throw n(c.message||"Failed to update override"),c}finally{m(!1)}}),[]),y=u.useCallback(a=>v(void 0,null,function*(){m(!0),n(null);try{yield Pe(a),p(s=>s.filter(c=>c.id!==a))}catch(s){throw n(s.message||"Failed to delete override"),s}finally{m(!1)}}),[]),l=u.useCallback(()=>{n(null)},[]);return{availability:t,recurringPatterns:d,overrides:b,loading:k,error:f,fetchAvailability:g,fetchRecurringPatterns:C,fetchOverrides:N,createRecurringPattern:$,updateRecurringPattern:j,deleteRecurringPattern:h,createOverride:r,updateOverride:x,deleteOverride:y,clearError:l}};var B=(t=>(t[t.SUNDAY=0]="SUNDAY",t[t.MONDAY=1]="MONDAY",t[t.TUESDAY=2]="TUESDAY",t[t.WEDNESDAY=3]="WEDNESDAY",t[t.THURSDAY=4]="THURSDAY",t[t.FRIDAY=5]="FRIDAY",t[t.SATURDAY=6]="SATURDAY",t))(B||{});const Ye=t=>B[t],U=u.forwardRef((b,o)=>{var p=b,{className:t,type:i}=p,d=H(p,["className","type"]);return e.jsx("input",A({type:i,className:me("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:o},d))});U.displayName="Input";var Ue=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Le=Ue.reduce((t,i)=>{const d=Ae(`Primitive.${i}`),o=u.forwardRef((b,p)=>{const n=b,{asChild:k}=n,m=H(n,["asChild"]),f=k?d:i;return typeof window!="undefined"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(f,S(A({},m),{ref:p}))});return o.displayName=`Primitive.${i}`,S(A({},t),{[i]:o})},{}),ze="Label",ge=u.forwardRef((t,i)=>e.jsx(Le.label,S(A({},t),{ref:i,onMouseDown:d=>{var b;d.target.closest("button, input, select, textarea")||((b=t.onMouseDown)==null||b.call(t,d),!d.defaultPrevented&&d.detail>1&&d.preventDefault())}})));ge.displayName=ze;var xe=ge;const We=ke("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),M=u.forwardRef((o,d)=>{var b=o,{className:t}=b,i=H(b,["className"]);return e.jsx(xe,A({ref:d,className:me(We(),t)},i))});M.displayName=xe.displayName;const He=({onPatternChange:t})=>{const{recurringPatterns:i,loading:d,error:o,fetchRecurringPatterns:b,createRecurringPattern:p,updateRecurringPattern:k,deleteRecurringPattern:m,clearError:f}=_(),{user:n}=he(),[g,C]=u.useState(null),[N,$]=u.useState(!1),[j,h]=u.useState({dayOfWeek:B.MONDAY,startTime:"09:00",endTime:"17:00"});u.useEffect(()=>{b()},[b]);const r=a=>v(void 0,null,function*(){a.preventDefault();try{const s=typeof j.dayOfWeek=="number"?j.dayOfWeek:parseInt(String(j.dayOfWeek),10);if(isNaN(s)||s<0||s>6)throw new Error("Invalid day of week selected");yield p(S(A({},j),{dayOfWeek:s})),$(!1),h({dayOfWeek:B.MONDAY,startTime:"09:00",endTime:"17:00"}),n&&t&&t()}catch(s){}}),x=a=>v(void 0,null,function*(){try{yield k(a.id,{isActive:!a.isActive}),n&&t&&t()}catch(s){}}),y=a=>v(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this availability pattern?"))try{yield m(a),n&&t&&t()}catch(s){}}),l=i.reduce((a,s)=>{const c=s.dayOfWeek;return a[c]||(a[c]=[]),a[c].push(s),a},{});return e.jsxs(P,{children:[e.jsxs(V,{children:[e.jsx(G,{children:"Weekly Availability"}),e.jsx(ue,{children:"Set your recurring weekly availability patterns"})]}),e.jsxs(Y,{children:[o&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(K,{children:o}),e.jsx(T,{variant:"ghost",size:"sm",onClick:f,children:"Dismiss"})]}),!N&&e.jsxs(T,{onClick:()=>$(!0),className:"mb-4",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Availability Pattern"]}),N&&e.jsx("form",{onSubmit:r,className:"mb-6 p-4 border rounded-lg",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"dayOfWeek",children:"Day of Week"}),e.jsx("select",{id:"dayOfWeek",value:j.dayOfWeek,onChange:a=>h(S(A({},j),{dayOfWeek:parseInt(a.target.value,10)})),className:"w-full p-2 border rounded",children:[{value:B.SUNDAY,label:"Sunday"},{value:B.MONDAY,label:"Monday"},{value:B.TUESDAY,label:"Tuesday"},{value:B.WEDNESDAY,label:"Wednesday"},{value:B.THURSDAY,label:"Thursday"},{value:B.FRIDAY,label:"Friday"},{value:B.SATURDAY,label:"Saturday"}].map(({value:a,label:s})=>e.jsx("option",{value:a,children:s},a))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"startTime",children:"Start Time"}),e.jsx(U,{id:"startTime",type:"time",value:j.startTime,onChange:a=>h(S(A({},j),{startTime:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"endTime",children:"End Time"}),e.jsx(U,{id:"endTime",type:"time",value:j.endTime,onChange:a=>h(S(A({},j),{endTime:a.target.value})),required:!0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{type:"submit",disabled:d,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Add Pattern"]}),e.jsxs(T,{type:"button",variant:"outline",onClick:()=>$(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})}),e.jsx("div",{className:"space-y-4",children:[0,1,2,3,4,5,6].map(a=>{const s=l[a]||[];return s.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:Ye(a)}),e.jsx("div",{className:"space-y-2",children:s.map(c=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded ${c.isActive?"bg-green-50":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-mono",children:[c.startTime," - ",c.endTime]}),!c.isActive&&e.jsx("span",{className:"text-sm text-gray-500",children:"(Inactive)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>x(c),disabled:d,children:c.isActive?"Deactivate":"Activate"}),e.jsx(T,{variant:"destructive",size:"sm",onClick:()=>y(c.id),disabled:d,children:e.jsx(oe,{className:"w-4 h-4"})})]})]},c.id))})]},a)})}),i.length===0&&!N&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No availability patterns set. Click "Add Availability Pattern" to get started.'})]})]})},qe=()=>{const{overrides:t,loading:i,error:d,fetchOverrides:o,createOverride:b,deleteOverride:p,clearError:k}=_(),[m,f]=u.useState(!1),[n,g]=u.useState({overrideDate:"",startTime:"",endTime:"",isBlocked:!0,reason:""}),C=r=>{let x;if(r instanceof Date)x=r;else if(typeof r=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(r))return r;x=new Date(r)}else x=new Date(r);const y=x.getFullYear(),l=String(x.getMonth()+1).padStart(2,"0"),a=String(x.getDate()).padStart(2,"0");return`${y}-${l}-${a}`};u.useEffect(()=>{const r=C(new Date),x=new Date;x.setDate(x.getDate()+90);const y=C(x);o(r,y)},[o]);const N=r=>v(void 0,null,function*(){r.preventDefault();try{yield b({overrideDate:n.overrideDate,startTime:n.startTime||void 0,endTime:n.endTime||void 0,isBlocked:n.isBlocked,reason:n.reason||void 0}),f(!1),g({overrideDate:"",startTime:"",endTime:"",isBlocked:!0,reason:""})}catch(x){}}),$=r=>v(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this override?"))try{yield p(r)}catch(x){}}),j=r=>{const x=C(r),[y,l,a]=x.split("-");return new Date(parseInt(y),parseInt(l)-1,parseInt(a)).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},h=[...t].sort((r,x)=>{const y=C(r.overrideDate),l=C(x.overrideDate);return y.localeCompare(l)});return e.jsxs(P,{children:[e.jsxs(V,{children:[e.jsx(G,{children:"Availability Overrides"}),e.jsx(ue,{children:"Block or add availability for specific dates"})]}),e.jsxs(Y,{children:[d&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(K,{children:d}),e.jsx(T,{variant:"ghost",size:"sm",onClick:k,children:"Dismiss"})]}),!m&&e.jsxs(T,{onClick:()=>f(!0),className:"mb-4",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Override"]}),m&&e.jsx("form",{onSubmit:N,className:"mb-6 p-4 border rounded-lg",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"overrideDate",children:"Date"}),e.jsx(U,{id:"overrideDate",type:"date",value:n.overrideDate,onChange:r=>g(S(A({},n),{overrideDate:r.target.value})),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Type"}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"isBlocked",checked:n.isBlocked,onChange:()=>g(S(A({},n),{isBlocked:!0}))}),e.jsx(re,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Block (Not Available)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"isBlocked",checked:!n.isBlocked,onChange:()=>g(S(A({},n),{isBlocked:!1}))}),e.jsx(ie,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Add (Available)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"startTime",children:"Start Time (optional)"}),e.jsx(U,{id:"startTime",type:"time",value:n.startTime,onChange:r=>g(S(A({},n),{startTime:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"endTime",children:"End Time (optional)"}),e.jsx(U,{id:"endTime",type:"time",value:n.endTime,onChange:r=>g(S(A({},n),{endTime:r.target.value}))})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Leave times empty to apply to the entire day"}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(U,{id:"reason",type:"text",placeholder:"e.g., Vacation, Conference, etc.",value:n.reason,onChange:r=>g(S(A({},n),{reason:r.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{type:"submit",disabled:i,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Add Override"]}),e.jsxs(T,{type:"button",variant:"outline",onClick:()=>f(!1),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.map(r=>e.jsx("div",{className:`p-4 rounded-lg border ${r.isBlocked?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.isBlocked?e.jsx(re,{className:"w-5 h-5 text-red-600"}):e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-semibold",children:r.isBlocked?"Blocked":"Available"})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",j(r.overrideDate)]}),(r.startTime||r.endTime)&&e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",r.startTime||"00:00"," -"," ",r.endTime||"23:59"]}),r.reason&&e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",r.reason]})]})]}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>$(r.id),disabled:i,children:e.jsx(oe,{className:"w-4 h-4 text-red-600"})})]})},r.id))}),t.length===0&&!m&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No overrides set. Click "Add Override" to block or add availability for specific dates.'})]})]})},Ke=({slots:t,startDate:i,endDate:d,bookings:o=[]})=>{const b=we(),k=(()=>{const l=[],a=new Date(i);for(;a<=d;)l.push(new Date(a)),a.setDate(a.getDate()+1);return l})(),m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],f=l=>{const a=typeof l=="string"?new Date(l):l,s=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),D=String(a.getDate()).padStart(2,"0");return`${s}-${c}-${D}`},n=t.reduce((l,a)=>{const s=f(a.date);return l[s]||(l[s]=[]),l[s].push(a),l},{}),g={},C=o.reduce((l,a)=>{try{const s=new Date(a.scheduledDatetime);if(isNaN(s.getTime()))return console.warn("Invalid booking date:",a.scheduledDatetime,a.id),l;const c=f(s),D=new Date(s);D.setMinutes(D.getMinutes()+(a.durationMinutes||60));const R=L=>{const Q=String(L.getHours()).padStart(2,"0"),z=String(L.getMinutes()).padStart(2,"0");return`${Q}:${z}`},O=R(s),F=R(D),E={date:c,startTime:O,endTime:F,isAvailable:!1,source:"override",reason:`${a.departureAirport} â†’ ${a.arrivalAirport}`},w=`${c}-${O}-${F}`;g[w]=a.id,l[c]||(l[c]=[]),l[c].push(E)}catch(s){console.error("Error processing booking for calendar:",a.id,s)}return l},{}),N={};Object.keys(n).forEach(l=>{N[l]=[...n[l]]}),Object.keys(C).forEach(l=>{N[l]||(N[l]=[]),N[l].push(...C[l])});const $=l=>f(l),j=l=>{const a=new Date;return l.getDate()===a.getDate()&&l.getMonth()===a.getMonth()&&l.getFullYear()===a.getFullYear()},h=[];let r=[];const x=k[0].getDay();for(let l=0;l<x;l++){const a=new Date(k[0]);a.setDate(a.getDate()-(x-l)),r.push(a)}if(k.forEach(l=>{r.push(l),r.length===7&&(h.push(r),r=[])}),r.length>0){for(;r.length<7;){const l=r[r.length-1],a=new Date(l);a.setDate(a.getDate()+1),r.push(a)}h.push(r)}const y=Te(i,"MMMM yyyy");return e.jsxs(P,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"Availability Calendar"}),e.jsx("div",{className:"text-lg font-semibold text-gray-700",children:y})]})}),e.jsxs(Y,{children:[e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[m.map(l=>e.jsx("div",{className:"text-center font-semibold p-2 text-sm",children:l},l)),h.map((l,a)=>l.map((s,c)=>{const D=$(s),R=N[D]||[],O=s>=i&&s<=d,F=R.filter(w=>w.isAvailable),E=R.filter(w=>!w.isAvailable);return e.jsxs("div",{className:`
                    min-h-[100px] p-2 border rounded-lg
                    ${O?"":"bg-gray-50 text-gray-400"}
                    ${j(s)?"ring-2 ring-blue-500":""}
                    ${O&&F.length>0&&E.length===0?"bg-green-50":""}
                    ${O&&F.length===0&&R.length===0?"bg-gray-50":""}
                    ${O&&E.length>0?"bg-red-50 border-red-200":""}
                    ${O&&F.length>0&&E.length>0?"bg-yellow-50 border-yellow-200":""}
                  `,children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:s.getDate()}),O&&(R.length>0||E.length>0)&&e.jsxs("div",{className:"space-y-1",children:[[...E,...F].slice(0,3).map((w,L)=>{const Q=`${D}-${w.startTime}-${w.endTime}`,z=g[Q],ve=!w.isAvailable&&z,ee=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-mono text-[10px]",children:[w.startTime," - ",w.endTime]}),w.reason&&e.jsx("div",{className:"truncate font-semibold",title:w.reason,children:w.reason})]});return ve?e.jsx("div",{onClick:ye=>{ye.stopPropagation(),b(`/bookings/${z}`)},className:`text-xs p-1 rounded cursor-pointer transition-all hover:shadow-md hover:scale-105 ${w.isAvailable?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,title:"Click to view booking details",children:ee},L):e.jsx("div",{className:`text-xs p-1 rounded ${w.isAvailable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:ee},L)}),E.length+F.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",E.length+F.length-3," more"]})]})]},`${a}-${c}`)}))]}),e.jsxs("div",{className:"mt-6 flex gap-6 justify-center text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{children:"Blocked"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-100 border border-gray-200 rounded"}),e.jsx("span",{children:"No Pattern Set"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 rounded"}),e.jsx("span",{children:"Today"})]})]})]})]})},tt=()=>{const{user:t}=he(),{availability:i,loading:d,error:o,fetchAvailability:b,clearError:p}=_(),[k,m]=u.useState([]),[f,n]=u.useState(!1),[g,C]=u.useState({startDate:new Date().toISOString().split("T")[0],endDate:(()=>{const h=new Date;return h.setDate(h.getDate()+30),h.toISOString().split("T")[0]})()});u.useEffect(()=>{t&&(N(),$())},[t,g]);const N=()=>{t&&b(t.id,g.startDate,g.endDate)},$=()=>v(void 0,null,function*(){if(t)try{n(!0);let h=[];t.role===ne.INSTRUCTOR?h=yield Z.listBookings({instructorId:t.id,startDate:g.startDate,endDate:g.endDate,limit:1e3}):t.role===ne.STUDENT?h=yield Z.listBookings({studentId:t.id,startDate:g.startDate,endDate:g.endDate,limit:1e3}):(t.role==="ADMIN"||t.role==="admin")&&(h=yield Z.listBookings({startDate:g.startDate,endDate:g.endDate,limit:1e3})),m(h)}catch(h){console.error("Failed to load bookings for availability calendar:",h)}finally{n(!1)}}),j=h=>{const r=new Date,x=r.toISOString().split("T")[0];let y;switch(h){case"week":y=new Date(r),y.setDate(y.getDate()+7);break;case"month":y=new Date(r),y.setDate(y.getDate()+30);break;case"3months":y=new Date(r),y.setDate(y.getDate()+90);break}C({startDate:x,endDate:y.toISOString().split("T")[0]})};return t?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Availability Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage your weekly recurring availability and one-time overrides"})]}),o&&e.jsxs(q,{variant:"destructive",className:"mb-4",children:[e.jsx(K,{children:o}),e.jsx(T,{variant:"ghost",size:"sm",onClick:p,children:"Dismiss"})]}),e.jsxs(Se,{defaultValue:"calendar",className:"space-y-6",children:[e.jsxs(Ce,{className:"grid w-full grid-cols-3 max-w-md",children:[e.jsxs(X,{value:"calendar",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Calendar"]}),e.jsxs(X,{value:"recurring",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Weekly"]}),e.jsxs(X,{value:"overrides",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Overrides"]})]}),e.jsxs(J,{value:"calendar",className:"space-y-6",children:[e.jsxs(P,{children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"Availability Overview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:()=>j("week"),children:"1 Week"}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>j("month"),children:"1 Month"}),e.jsx(T,{variant:"outline",size:"sm",onClick:()=>j("3months"),children:"3 Months"})]})]})}),e.jsx(Y,{children:d?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):i?e.jsx(Ke,{slots:i.slots,startDate:new Date(g.startDate),endDate:new Date(g.endDate),bookings:k}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No availability data to display"})})]}),i&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(P,{children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:i.slots.filter(h=>h.isAvailable).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Available Slots"})]})})}),e.jsx(P,{children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:i.recurringPatterns.filter(h=>h.isActive).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Active Patterns"})]})})}),e.jsx(P,{children:e.jsx(Y,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:i.overrides.filter(h=>h.isBlocked).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Blocked Days"})]})})})]})]}),e.jsx(J,{value:"recurring",children:e.jsx(He,{onPatternChange:N})}),e.jsx(J,{value:"overrides",children:e.jsx(qe,{})})]})]}):e.jsx(q,{children:e.jsx(K,{children:"Please log in to manage your availability."})})};export{tt as AvailabilityCalendar};
