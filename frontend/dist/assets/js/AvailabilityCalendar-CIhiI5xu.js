var be=Object.defineProperty,fe=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var te=(t,i,l)=>i in t?be(t,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[i]=l,T=(t,i)=>{for(var l in i||(i={}))se.call(i,l)&&te(t,l,i[l]);if(H)for(var l of H(i))ae.call(i,l)&&te(t,l,i[l]);return t},S=(t,i)=>fe(t,pe(i));var q=(t,i)=>{var l={};for(var o in t)se.call(t,o)&&i.indexOf(o)<0&&(l[o]=t[o]);if(t!=null&&H)for(var o of H(t))i.indexOf(o)<0&&ae.call(t,o)&&(l[o]=t[o]);return l};var g=(t,i,l)=>new Promise((o,v)=>{var y=j=>{try{m(l.next(j))}catch(n){v(n)}},w=j=>{try{m(l.throw(j))}catch(n){v(n)}},m=j=>j.done?o(j.value):Promise.resolve(j.value).then(y,w);m((l=l.apply(t,i)).next())});import{j as e,K as ce,E as de,X as oe,N as me,O as re,Q as ie,C as Ne,t as De,z as we}from"./ui-vendor-X7k4bu4n.js";import{r as h,u as Te}from"./react-vendor-C9zT986Q.js";import{e as P,h as he,j as ke,i as Ae,u as ue,C as M,a as W,b as G,c as xe,d as I,B as k,U as ne}from"./index-B5m-gi1T.js";import{A as K,a as V}from"./alert-CVFLCXas.js";import{f as Se}from"./utils-vendor-1hodNj4h.js";import{T as Ce,a as Re,b as X,c as J}from"./tabs-DqEPiyzo.js";import{B as Z}from"./booking-Sr7KVi8d.js";const Be=(t,i,l)=>g(void 0,null,function*(){return(yield P.get("/availability",{params:{userId:t,startDate:i,endDate:l}})).data}),Oe=()=>g(void 0,null,function*(){return(yield P.get("/availability/recurring")).data}),$e=t=>g(void 0,null,function*(){return(yield P.post("/availability/recurring",t)).data}),Fe=(t,i)=>g(void 0,null,function*(){return(yield P.put(`/availability/recurring/${t}`,i)).data}),Ee=t=>g(void 0,null,function*(){yield P.delete(`/availability/recurring/${t}`)}),Pe=(t,i)=>g(void 0,null,function*(){return(yield P.get("/availability/overrides",{params:{startDate:t,endDate:i}})).data}),Me=t=>g(void 0,null,function*(){return(yield P.post("/availability/overrides",t)).data}),Ie=(t,i)=>g(void 0,null,function*(){return(yield P.put(`/availability/overrides/${t}`,i)).data}),Ye=t=>g(void 0,null,function*(){yield P.delete(`/availability/overrides/${t}`)}),_=()=>{const[t,i]=h.useState(null),[l,o]=h.useState([]),[v,y]=h.useState([]),[w,m]=h.useState(!1),[j,n]=h.useState(null),x=h.useCallback((s,a,d)=>g(void 0,null,function*(){m(!0),n(null);try{const b=yield Be(s,a,d);i(b),o(b.recurringPatterns),y(b.overrides)}catch(b){throw n(b.message||"Failed to fetch availability"),b}finally{m(!1)}}),[]),B=h.useCallback(()=>g(void 0,null,function*(){m(!0),n(null);try{const s=yield Oe();o(s)}catch(s){throw n(s.message||"Failed to fetch recurring patterns"),s}finally{m(!1)}}),[]),p=h.useCallback((s,a)=>g(void 0,null,function*(){m(!0),n(null);try{const d=yield Pe(s,a);y(d)}catch(d){throw n(d.message||"Failed to fetch overrides"),d}finally{m(!1)}}),[]),C=h.useCallback(s=>g(void 0,null,function*(){m(!0),n(null);try{const a=yield $e(s);o(d=>[...d,a])}catch(a){throw n(a.message||"Failed to create recurring pattern"),a}finally{m(!1)}}),[]),f=h.useCallback((s,a)=>g(void 0,null,function*(){m(!0),n(null);try{const d=yield Fe(s,a);o(b=>b.map(A=>A.id===s?d:A))}catch(d){throw n(d.message||"Failed to update recurring pattern"),d}finally{m(!1)}}),[]),r=h.useCallback(s=>g(void 0,null,function*(){m(!0),n(null);try{yield Ee(s),o(a=>a.filter(d=>d.id!==s))}catch(a){throw n(a.message||"Failed to delete recurring pattern"),a}finally{m(!1)}}),[]),u=h.useCallback(s=>g(void 0,null,function*(){m(!0),n(null);try{const a=yield Me(s);y(d=>[...d,a])}catch(a){throw n(a.message||"Failed to create override"),a}finally{m(!1)}}),[]),R=h.useCallback((s,a)=>g(void 0,null,function*(){m(!0),n(null);try{const d=yield Ie(s,a);y(b=>b.map(A=>A.id===s?d:A))}catch(d){throw n(d.message||"Failed to update override"),d}finally{m(!1)}}),[]),N=h.useCallback(s=>g(void 0,null,function*(){m(!0),n(null);try{yield Ye(s),y(a=>a.filter(d=>d.id!==s))}catch(a){throw n(a.message||"Failed to delete override"),a}finally{m(!1)}}),[]),c=h.useCallback(()=>{n(null)},[]);return{availability:t,recurringPatterns:l,overrides:v,loading:w,error:j,fetchAvailability:x,fetchRecurringPatterns:B,fetchOverrides:p,createRecurringPattern:C,updateRecurringPattern:f,deleteRecurringPattern:r,createOverride:u,updateOverride:R,deleteOverride:N,clearError:c}};var L=(t=>(t[t.SUNDAY=0]="SUNDAY",t[t.MONDAY=1]="MONDAY",t[t.TUESDAY=2]="TUESDAY",t[t.WEDNESDAY=3]="WEDNESDAY",t[t.THURSDAY=4]="THURSDAY",t[t.FRIDAY=5]="FRIDAY",t[t.SATURDAY=6]="SATURDAY",t))(L||{});const le=t=>L[t],Y=h.forwardRef((v,o)=>{var y=v,{className:t,type:i}=y,l=q(y,["className","type"]);return e.jsx("input",T({type:i,className:he("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:o},l))});Y.displayName="Input";var Ue=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Le=Ue.reduce((t,i)=>{const l=ke(`Primitive.${i}`),o=h.forwardRef((v,y)=>{const n=v,{asChild:w}=n,m=q(n,["asChild"]),j=w?l:i;return typeof window!="undefined"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(j,S(T({},m),{ref:y}))});return o.displayName=`Primitive.${i}`,S(T({},t),{[i]:o})},{}),ze="Label",ge=h.forwardRef((t,i)=>e.jsx(Le.label,S(T({},t),{ref:i,onMouseDown:l=>{var v;l.target.closest("button, input, select, textarea")||((v=t.onMouseDown)==null||v.call(t,l),!l.defaultPrevented&&l.detail>1&&l.preventDefault())}})));ge.displayName=ze;var ve=ge;const He=Ae("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),E=h.forwardRef((o,l)=>{var v=o,{className:t}=v,i=q(v,["className"]);return e.jsx(ve,T({ref:l,className:he(He(),t)},i))});E.displayName=ve.displayName;const qe=({onPatternChange:t})=>{const{recurringPatterns:i,loading:l,error:o,fetchRecurringPatterns:v,createRecurringPattern:y,updateRecurringPattern:w,deleteRecurringPattern:m,clearError:j}=_(),{user:n}=ue(),[x,B]=h.useState(null),[p,C]=h.useState(!1),[f,r]=h.useState({dayOfWeek:L.MONDAY,startTime:"09:00",endTime:"17:00"});h.useEffect(()=>{v()},[v]);const u=s=>g(void 0,null,function*(){s.preventDefault();try{yield y(f),C(!1),r({dayOfWeek:L.MONDAY,startTime:"09:00",endTime:"17:00"}),n&&t&&t()}catch(a){}}),R=s=>g(void 0,null,function*(){try{yield w(s.id,{isActive:!s.isActive}),n&&t&&t()}catch(a){}}),N=s=>g(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this availability pattern?"))try{yield m(s),n&&t&&t()}catch(a){}}),c=i.reduce((s,a)=>{const d=a.dayOfWeek;return s[d]||(s[d]=[]),s[d].push(a),s},{});return e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsx(G,{children:"Weekly Availability"}),e.jsx(xe,{children:"Set your recurring weekly availability patterns"})]}),e.jsxs(I,{children:[o&&e.jsxs(K,{variant:"destructive",className:"mb-4",children:[e.jsx(V,{children:o}),e.jsx(k,{variant:"ghost",size:"sm",onClick:j,children:"Dismiss"})]}),!p&&e.jsxs(k,{onClick:()=>C(!0),className:"mb-4",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Add Availability Pattern"]}),p&&e.jsx("form",{onSubmit:u,className:"mb-6 p-4 border rounded-lg",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"dayOfWeek",children:"Day of Week"}),e.jsx("select",{id:"dayOfWeek",value:f.dayOfWeek,onChange:s=>r(S(T({},f),{dayOfWeek:parseInt(s.target.value)})),className:"w-full p-2 border rounded",children:Object.entries(L).filter(([s,a])=>typeof a=="number").map(([s,a])=>e.jsx("option",{value:a,children:le(a)},a))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"startTime",children:"Start Time"}),e.jsx(Y,{id:"startTime",type:"time",value:f.startTime,onChange:s=>r(S(T({},f),{startTime:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"endTime",children:"End Time"}),e.jsx(Y,{id:"endTime",type:"time",value:f.endTime,onChange:s=>r(S(T({},f),{endTime:s.target.value})),required:!0})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{type:"submit",disabled:l,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Add Pattern"]}),e.jsxs(k,{type:"button",variant:"outline",onClick:()=>C(!1),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})}),e.jsx("div",{className:"space-y-4",children:[0,1,2,3,4,5,6].map(s=>{const a=c[s]||[];return a.length===0?null:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:le(s)}),e.jsx("div",{className:"space-y-2",children:a.map(d=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded ${d.isActive?"bg-green-50":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"font-mono",children:[d.startTime," - ",d.endTime]}),!d.isActive&&e.jsx("span",{className:"text-sm text-gray-500",children:"(Inactive)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>R(d),disabled:l,children:d.isActive?"Deactivate":"Activate"}),e.jsx(k,{variant:"destructive",size:"sm",onClick:()=>N(d.id),disabled:l,children:e.jsx(me,{className:"w-4 h-4"})})]})]},d.id))})]},s)})}),i.length===0&&!p&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No availability patterns set. Click "Add Availability Pattern" to get started.'})]})]})},Ke=()=>{const{overrides:t,loading:i,error:l,fetchOverrides:o,createOverride:v,deleteOverride:y,clearError:w}=_(),[m,j]=h.useState(!1),[n,x]=h.useState({overrideDate:"",startTime:"",endTime:"",isBlocked:!0,reason:""});h.useEffect(()=>{const r=new Date().toISOString().split("T")[0],u=new Date;u.setDate(u.getDate()+90);const R=u.toISOString().split("T")[0];o(r,R)},[o]);const B=r=>g(void 0,null,function*(){r.preventDefault();try{yield v({overrideDate:n.overrideDate,startTime:n.startTime||void 0,endTime:n.endTime||void 0,isBlocked:n.isBlocked,reason:n.reason||void 0}),j(!1),x({overrideDate:"",startTime:"",endTime:"",isBlocked:!0,reason:""})}catch(u){}}),p=r=>g(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this override?"))try{yield y(r)}catch(u){}}),C=r=>new Date(r).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),f=[...t].sort((r,u)=>new Date(r.overrideDate).getTime()-new Date(u.overrideDate).getTime());return e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsx(G,{children:"Availability Overrides"}),e.jsx(xe,{children:"Block or add availability for specific dates"})]}),e.jsxs(I,{children:[l&&e.jsxs(K,{variant:"destructive",className:"mb-4",children:[e.jsx(V,{children:l}),e.jsx(k,{variant:"ghost",size:"sm",onClick:w,children:"Dismiss"})]}),!m&&e.jsxs(k,{onClick:()=>j(!0),className:"mb-4",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Add Override"]}),m&&e.jsx("form",{onSubmit:B,className:"mb-6 p-4 border rounded-lg",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"overrideDate",children:"Date"}),e.jsx(Y,{id:"overrideDate",type:"date",value:n.overrideDate,onChange:r=>x(S(T({},n),{overrideDate:r.target.value})),min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Type"}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"isBlocked",checked:n.isBlocked,onChange:()=>x(S(T({},n),{isBlocked:!0}))}),e.jsx(re,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Block (Not Available)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"isBlocked",checked:!n.isBlocked,onChange:()=>x(S(T({},n),{isBlocked:!1}))}),e.jsx(ie,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Add (Available)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"startTime",children:"Start Time (optional)"}),e.jsx(Y,{id:"startTime",type:"time",value:n.startTime,onChange:r=>x(S(T({},n),{startTime:r.target.value}))})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"endTime",children:"End Time (optional)"}),e.jsx(Y,{id:"endTime",type:"time",value:n.endTime,onChange:r=>x(S(T({},n),{endTime:r.target.value}))})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Leave times empty to apply to the entire day"}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"reason",children:"Reason (optional)"}),e.jsx(Y,{id:"reason",type:"text",placeholder:"e.g., Vacation, Conference, etc.",value:n.reason,onChange:r=>x(S(T({},n),{reason:r.target.value}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{type:"submit",disabled:i,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Add Override"]}),e.jsxs(k,{type:"button",variant:"outline",onClick:()=>j(!1),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})}),e.jsx("div",{className:"space-y-3",children:f.map(r=>e.jsx("div",{className:`p-4 rounded-lg border ${r.isBlocked?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.isBlocked?e.jsx(re,{className:"w-5 h-5 text-red-600"}):e.jsx(ie,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-semibold",children:r.isBlocked?"Blocked":"Available"})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",C(r.overrideDate)]}),(r.startTime||r.endTime)&&e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",r.startTime||"00:00"," -"," ",r.endTime||"23:59"]}),r.reason&&e.jsxs("div",{children:[e.jsx("strong",{children:"Reason:"})," ",r.reason]})]})]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>p(r.id),disabled:i,children:e.jsx(me,{className:"w-4 h-4 text-red-600"})})]})},r.id))}),t.length===0&&!m&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:'No overrides set. Click "Add Override" to block or add availability for specific dates.'})]})]})},Ve=({slots:t,startDate:i,endDate:l,bookings:o=[]})=>{const v=Te(),w=(()=>{const c=[],s=new Date(i);for(;s<=l;)c.push(new Date(s)),s.setDate(s.getDate()+1);return c})(),m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],j=c=>{const s=typeof c=="string"?new Date(c):c,a=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),b=String(s.getDate()).padStart(2,"0");return`${a}-${d}-${b}`},n=t.reduce((c,s)=>{const a=j(s.date);return c[a]||(c[a]=[]),c[a].push(s),c},{}),x={},B=o.reduce((c,s)=>{try{const a=new Date(s.scheduledDatetime);if(isNaN(a.getTime()))return console.warn("Invalid booking date:",s.scheduledDatetime,s.id),c;const d=j(a),b=new Date(a);b.setMinutes(b.getMinutes()+(s.durationMinutes||60));const A=U=>{const Q=String(U.getHours()).padStart(2,"0"),z=String(U.getMinutes()).padStart(2,"0");return`${Q}:${z}`},O=A(a),$=A(b),F={date:d,startTime:O,endTime:$,isAvailable:!1,source:"override",reason:`${s.departureAirport} â†’ ${s.arrivalAirport}`},D=`${d}-${O}-${$}`;x[D]=s.id,c[d]||(c[d]=[]),c[d].push(F)}catch(a){console.error("Error processing booking for calendar:",s.id,a)}return c},{}),p={};Object.keys(n).forEach(c=>{p[c]=[...n[c]]}),Object.keys(B).forEach(c=>{p[c]||(p[c]=[]),p[c].push(...B[c])});const C=c=>j(c),f=c=>{const s=new Date;return c.getDate()===s.getDate()&&c.getMonth()===s.getMonth()&&c.getFullYear()===s.getFullYear()},r=[];let u=[];const R=w[0].getDay();for(let c=0;c<R;c++){const s=new Date(w[0]);s.setDate(s.getDate()-(R-c)),u.push(s)}if(w.forEach(c=>{u.push(c),u.length===7&&(r.push(u),u=[])}),u.length>0){for(;u.length<7;){const c=u[u.length-1],s=new Date(c);s.setDate(s.getDate()+1),u.push(s)}r.push(u)}const N=Se(i,"MMMM yyyy");return e.jsxs(M,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"Availability Calendar"}),e.jsx("div",{className:"text-lg font-semibold text-gray-700",children:N})]})}),e.jsxs(I,{children:[e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[m.map(c=>e.jsx("div",{className:"text-center font-semibold p-2 text-sm",children:c},c)),r.map((c,s)=>c.map((a,d)=>{const b=C(a),A=p[b]||[],O=a>=i&&a<=l,$=A.filter(D=>D.isAvailable),F=A.filter(D=>!D.isAvailable);return e.jsxs("div",{className:`
                    min-h-[100px] p-2 border rounded-lg
                    ${O?"":"bg-gray-50 text-gray-400"}
                    ${f(a)?"ring-2 ring-blue-500":""}
                    ${O&&$.length>0&&F.length===0?"bg-green-50":""}
                    ${O&&$.length===0&&A.length===0?"bg-gray-50":""}
                    ${O&&F.length>0?"bg-red-50 border-red-200":""}
                    ${O&&$.length>0&&F.length>0?"bg-yellow-50 border-yellow-200":""}
                  `,children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:a.getDate()}),O&&(A.length>0||F.length>0)&&e.jsxs("div",{className:"space-y-1",children:[[...F,...$].slice(0,3).map((D,U)=>{const Q=`${b}-${D.startTime}-${D.endTime}`,z=x[Q],je=!D.isAvailable&&z,ee=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-mono text-[10px]",children:[D.startTime," - ",D.endTime]}),D.reason&&e.jsx("div",{className:"truncate font-semibold",title:D.reason,children:D.reason})]});return je?e.jsx("div",{onClick:ye=>{ye.stopPropagation(),v(`/bookings/${z}`)},className:`text-xs p-1 rounded cursor-pointer transition-all hover:shadow-md hover:scale-105 ${D.isAvailable?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,title:"Click to view booking details",children:ee},U):e.jsx("div",{className:`text-xs p-1 rounded ${D.isAvailable?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:ee},U)}),F.length+$.length>3&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",F.length+$.length-3," more"]})]})]},`${s}-${d}`)}))]}),e.jsxs("div",{className:"mt-6 flex gap-6 justify-center text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-200 rounded"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-200 rounded"}),e.jsx("span",{children:"Blocked"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-100 border border-gray-200 rounded"}),e.jsx("span",{children:"No Pattern Set"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 rounded"}),e.jsx("span",{children:"Today"})]})]})]})]})},tt=()=>{const{user:t}=ue(),{availability:i,loading:l,error:o,fetchAvailability:v,clearError:y}=_(),[w,m]=h.useState([]),[j,n]=h.useState(!1),[x,B]=h.useState({startDate:new Date().toISOString().split("T")[0],endDate:(()=>{const r=new Date;return r.setDate(r.getDate()+30),r.toISOString().split("T")[0]})()});h.useEffect(()=>{t&&(p(),C())},[t,x]);const p=()=>{t&&v(t.id,x.startDate,x.endDate)},C=()=>g(void 0,null,function*(){if(t)try{n(!0);let r=[];t.role===ne.INSTRUCTOR?r=yield Z.listBookings({instructorId:t.id,startDate:x.startDate,endDate:x.endDate,limit:1e3}):t.role===ne.STUDENT?r=yield Z.listBookings({studentId:t.id,startDate:x.startDate,endDate:x.endDate,limit:1e3}):(t.role==="ADMIN"||t.role==="admin")&&(r=yield Z.listBookings({startDate:x.startDate,endDate:x.endDate,limit:1e3})),m(r)}catch(r){console.error("Failed to load bookings for availability calendar:",r)}finally{n(!1)}}),f=r=>{const u=new Date,R=u.toISOString().split("T")[0];let N;switch(r){case"week":N=new Date(u),N.setDate(N.getDate()+7);break;case"month":N=new Date(u),N.setDate(N.getDate()+30);break;case"3months":N=new Date(u),N.setDate(N.getDate()+90);break}B({startDate:R,endDate:N.toISOString().split("T")[0]})};return t?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Availability Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage your weekly recurring availability and one-time overrides"})]}),o&&e.jsxs(K,{variant:"destructive",className:"mb-4",children:[e.jsx(V,{children:o}),e.jsx(k,{variant:"ghost",size:"sm",onClick:y,children:"Dismiss"})]}),e.jsxs(Ce,{defaultValue:"calendar",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-3 max-w-md",children:[e.jsxs(X,{value:"calendar",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Calendar"]}),e.jsxs(X,{value:"recurring",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Weekly"]}),e.jsxs(X,{value:"overrides",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Overrides"]})]}),e.jsxs(J,{value:"calendar",className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(G,{children:"Availability Overview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>f("week"),children:"1 Week"}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>f("month"),children:"1 Month"}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>f("3months"),children:"3 Months"})]})]})}),e.jsx(I,{children:l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})}):i?e.jsx(Ve,{slots:i.slots,startDate:new Date(x.startDate),endDate:new Date(x.endDate),bookings:w}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No availability data to display"})})]}),i&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(M,{children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:i.slots.filter(r=>r.isAvailable).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Available Slots"})]})})}),e.jsx(M,{children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:i.recurringPatterns.filter(r=>r.isActive).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Active Patterns"})]})})}),e.jsx(M,{children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:i.overrides.filter(r=>r.isBlocked).length}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Blocked Days"})]})})})]})]}),e.jsx(J,{value:"recurring",children:e.jsx(qe,{onPatternChange:p})}),e.jsx(J,{value:"overrides",children:e.jsx(Ke,{})})]})]}):e.jsx(K,{children:e.jsx(V,{children:"Please log in to manage your availability."})})};export{tt as AvailabilityCalendar};
