var ke=Object.defineProperty,Ie=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var ie=(s,n,r)=>n in s?ke(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r,S=(s,n)=>{for(var r in n||(n={}))le.call(n,r)&&ie(s,r,n[r]);if(V)for(var r of V(n))ce.call(n,r)&&ie(s,r,n[r]);return s},A=(s,n)=>Ie(s,Se(n));var _=(s,n)=>{var r={};for(var o in s)le.call(s,o)&&n.indexOf(o)<0&&(r[o]=s[o]);if(s!=null&&V)for(var o of V(s))n.indexOf(o)<0&&ce.call(s,o)&&(r[o]=s[o]);return r};var P=(s,n,r)=>new Promise((o,l)=>{var g=c=>{try{m(r.next(c))}catch(d){l(d)}},x=c=>{try{m(r.throw(c))}catch(d){l(d)}},m=c=>c.done?o(c.value):Promise.resolve(c.value).then(g,x);m((r=r.apply(s,n)).next())});import{j as e,e as X,C as z,n as J,g as Ee,o as Oe,p as Re,q as te,u as De,r as fe,s as oe,t as Ae,v as Pe,G as Me,a as Be,i as Te,T as _e,R as de,h as me,w as he,A as Fe}from"./ui-vendor-D_mUPHSy.js";import{r as h,f as Le,u as We,L as ee}from"./react-vendor-DxF-uWSm.js";import{g as L,s as W,B as E,C as M,a as U,b as H,c as Q,d as B,f as xe}from"./index-D77Jmaxr.js";import{B as D}from"./badge-DNzIkouZ.js";import{A as G,a as $}from"./alert-DrpU_zx8.js";import{g as se,a as qe,b as Ge,c as $e,s as ze,d as Ue}from"./rescheduling-DDRzwlCf.js";import{f as F}from"./utils-vendor-1hodNj4h.js";import{B as He}from"./booking-D12B4RPg.js";const ue=(s,n)=>{if(!s)return"Date not available";const r=new Date(s);return isNaN(r.getTime())?"Invalid date":F(r,n)};function Ye({bookingId:s,onOptionsLoaded:n,onContinue:r}){const[o,l]=h.useState([]),[g,x]=h.useState(!0),[m,c]=h.useState(!1),[d,j]=h.useState(null);h.useEffect(()=>{v()},[s]);const v=()=>P(this,null,function*(){try{x(!0),j(null);const a=yield se(s);l(a),n&&n(a)}catch(a){const b=L(a);j(b.message),W(a,"load-reschedule-options")}finally{x(!1)}}),C=()=>P(this,null,function*(){try{c(!0),j(null);const a=yield qe(s);l(a),n&&n(a)}catch(a){const b=L(a);j(b.message),W(a,"generate-reschedule-options")}finally{c(!1)}}),y=a=>a>=.8?e.jsx(D,{className:"bg-green-500",children:"High Confidence"}):a>=.6?e.jsx(D,{className:"bg-yellow-500",children:"Medium Confidence"}):e.jsx(D,{className:"bg-orange-500",children:"Low Confidence"}),w=a=>a>=.8?e.jsx(D,{className:"bg-blue-500",children:"Excellent Weather"}):a>=.6?e.jsx(D,{className:"bg-blue-400",children:"Good Weather"}):e.jsx(D,{className:"bg-gray-500",children:"Fair Weather"});return g?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(X,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading options..."})]}):d?e.jsx(G,{variant:"destructive",children:e.jsxs($,{children:[e.jsx("p",{className:"mb-2",children:d}),e.jsx(E,{onClick:v,variant:"outline",size:"sm",children:"Retry"})]})}):o.length===0?e.jsxs(M,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"No Reschedule Options"}),e.jsx(Q,{children:"Generate new options using our AI scheduling assistant."})]}),e.jsx(B,{children:e.jsxs(E,{onClick:C,disabled:m,children:[m&&e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Options"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Reschedule Options"}),e.jsxs(E,{onClick:C,disabled:m,variant:"outline",size:"sm",children:[m&&e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerate"]})]}),e.jsx("div",{className:"grid gap-4",children:o.map((a,b)=>e.jsxs(M,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(H,{className:"text-base",children:["Option ",b+1]}),e.jsxs("div",{className:"flex gap-2",children:[y(a.confidence),w(a.weatherScore)]})]})}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(z,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:ue(a.suggestedDatetime,"EEEE, MMMM d, yyyy")}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["at ",ue(a.suggestedDatetime,"h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(J,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[a.departureAirport," → ",a.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700",children:a.reasoning})})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("span",{children:["Weather Score: ",(a.weatherScore*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Confidence: ",(a.confidence*100).toFixed(0),"%"]})]})]})]},a.id))}),r&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(E,{onClick:r,size:"lg",children:"Continue to Preferences"})})]})}function Ke(s){const n=h.useRef({value:s,previous:s});return h.useMemo(()=>(n.current.value!==s&&(n.current.previous=n.current.value,n.current.value=s),n.current.previous),[s])}var Z="Checkbox",[Ve]=Oe(Z),[Xe,re]=Ve(Z);function Je(s){const{__scopeCheckbox:n,checked:r,children:o,defaultChecked:l,disabled:g,form:x,name:m,onCheckedChange:c,required:d,value:j="on",internal_do_not_use_render:v}=s,[C,y]=De({prop:r,defaultProp:l!=null?l:!1,onChange:c,caller:Z}),[w,a]=h.useState(null),[b,k]=h.useState(null),O=h.useRef(!1),t=w?!!x||!!w.closest("form"):!0,i={checked:C,disabled:g,setChecked:y,control:w,setControl:a,name:m,form:x,value:j,hasConsumerStoppedPropagationRef:O,required:d,defaultChecked:T(l)?!1:l,isFormControl:t,bubbleInput:b,setBubbleInput:k};return e.jsx(Xe,A(S({scope:n},i),{children:Qe(v)?v(i):o}))}var pe="CheckboxTrigger",ge=h.forwardRef((g,l)=>{var x=g,{__scopeCheckbox:s,onKeyDown:n,onClick:r}=x,o=_(x,["__scopeCheckbox","onKeyDown","onClick"]);const{control:m,value:c,disabled:d,checked:j,required:v,setControl:C,setChecked:y,hasConsumerStoppedPropagationRef:w,isFormControl:a,bubbleInput:b}=re(pe,s),k=fe(l,C),O=h.useRef(j);return h.useEffect(()=>{const t=m==null?void 0:m.form;if(t){const i=()=>y(O.current);return t.addEventListener("reset",i),()=>t.removeEventListener("reset",i)}},[m,y]),e.jsx(te.button,A(S({type:"button",role:"checkbox","aria-checked":T(j)?"mixed":j,"aria-required":v,"data-state":ye(j),"data-disabled":d?"":void 0,disabled:d,value:c},o),{ref:k,onKeyDown:oe(n,t=>{t.key==="Enter"&&t.preventDefault()}),onClick:oe(r,t=>{y(i=>T(i)?!0:!i),b&&a&&(w.current=t.isPropagationStopped(),w.current||t.stopPropagation())})}))});ge.displayName=pe;var ae=h.forwardRef((s,n)=>{const C=s,{__scopeCheckbox:r,name:o,checked:l,defaultChecked:g,required:x,disabled:m,value:c,onCheckedChange:d,form:j}=C,v=_(C,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(Je,{__scopeCheckbox:r,checked:l,defaultChecked:g,disabled:m,required:x,onCheckedChange:d,name:o,form:j,value:c,internal_do_not_use_render:({isFormControl:y})=>e.jsxs(e.Fragment,{children:[e.jsx(ge,A(S({},v),{ref:n,__scopeCheckbox:r})),y&&e.jsx(ve,{__scopeCheckbox:r})]})})});ae.displayName=Z;var je="CheckboxIndicator",be=h.forwardRef((s,n)=>{const x=s,{__scopeCheckbox:r,forceMount:o}=x,l=_(x,["__scopeCheckbox","forceMount"]),g=re(je,r);return e.jsx(Re,{present:o||T(g.checked)||g.checked===!0,children:e.jsx(te.span,A(S({"data-state":ye(g.checked),"data-disabled":g.disabled?"":void 0},l),{ref:n,style:S({pointerEvents:"none"},s.style)}))})});be.displayName=je;var Ne="CheckboxBubbleInput",ve=h.forwardRef((o,r)=>{var l=o,{__scopeCheckbox:s}=l,n=_(l,["__scopeCheckbox"]);const{control:g,hasConsumerStoppedPropagationRef:x,checked:m,defaultChecked:c,required:d,disabled:j,name:v,value:C,form:y,bubbleInput:w,setBubbleInput:a}=re(Ne,s),b=fe(r,a),k=Ke(m),O=Ae(g);h.useEffect(()=>{const i=w;if(!i)return;const N=window.HTMLInputElement.prototype,Y=Object.getOwnPropertyDescriptor(N,"checked").set,f=!x.current;if(k!==m&&Y){const p=new Event("click",{bubbles:f});i.indeterminate=T(m),Y.call(i,T(m)?!1:m),i.dispatchEvent(p)}},[w,k,m,x]);const t=h.useRef(T(m)?!1:m);return e.jsx(te.input,A(S({type:"checkbox","aria-hidden":!0,defaultChecked:c!=null?c:t.current,required:d,disabled:j,name:v,value:C,form:y},n),{tabIndex:-1,ref:b,style:A(S(S({},n.style),O),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});ve.displayName=Ne;function Qe(s){return typeof s=="function"}function T(s){return s==="indeterminate"}function ye(s){return T(s)?"indeterminate":s?"checked":"unchecked"}const we=h.forwardRef((o,r)=>{var l=o,{className:s}=l,n=_(l,["className"]);return e.jsx(ae,A(S({ref:r,className:xe("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},n),{children:e.jsx(be,{className:xe("grid place-content-center text-current"),children:e.jsx(Pe,{className:"h-4 w-4"})})}))});we.displayName=ae.displayName;const q=(s,n)=>{if(!s)return"Date not available";const r=new Date(s);return isNaN(r.getTime())?"Invalid date":F(r,n)};function Ze({options:s,onSubmit:n,loading:r=!1,existingRanking:o}){const[l,g]=h.useState([null,null,null]),[x,m]=h.useState(new Set),[c,d]=h.useState(null);h.useEffect(()=>{if(o&&s.length>0){const t=[null,null,null];o.option1Id&&(t[0]=s.find(i=>i.id===o.option1Id)||null),o.option2Id&&(t[1]=s.find(i=>i.id===o.option2Id)||null),o.option3Id&&(t[2]=s.find(i=>i.id===o.option3Id)||null),g(t),m(new Set(o.unavailableOptionIds||[]))}},[o,s]);const j=s.filter(t=>!l.some(i=>(i==null?void 0:i.id)===t.id)&&!x.has(t.id)),v=t=>{d(t)},C=t=>{t.preventDefault()},y=t=>{if(c===null)return;const i=[...l],N=l[c];i[c]=i[t],i[t]=N,g(i),d(null)},w=(t,i)=>{const N=[...l];N[i]=t,g(N)},a=t=>{const i=[...l];i[t]=null,g(i)},b=t=>{const i=new Set(x);i.has(t)?i.delete(t):(i.add(t),g(l.map(N=>(N==null?void 0:N.id)===t?null:N))),m(i)},k=()=>{var t,i,N;n({option1Id:(t=l[0])==null?void 0:t.id,option2Id:(i=l[1])==null?void 0:i.id,option3Id:(N=l[2])==null?void 0:N.id,unavailableOptionIds:Array.from(x)})},O=l.some(t=>t!==null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"Rank Your Preferences"}),e.jsx(Q,{children:"Drag options to rank them in order of preference, or mark options as unavailable. Your #1 choice will be given the highest weight in the final selection."})]}),e.jsx(B,{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:l.map((t,i)=>e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] bg-gray-50",onDragOver:C,onDrop:()=>y(i),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[i===0?"1st":i===1?"2nd":"3rd"," Choice"]}),t&&e.jsx(E,{variant:"ghost",size:"sm",onClick:()=>a(i),children:"Remove"})]}),t?e.jsx("div",{className:"bg-white border rounded-lg p-3 cursor-move",draggable:!0,onDragStart:()=>v(i),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(z,{className:"mr-2 h-4 w-4 text-gray-500"}),q(t.suggestedDatetime,"EEE, MMM d")," at"," ",q(t.suggestedDatetime,"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(J,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]})]})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Drag an option here or select from below"})]},i))})})]}),e.jsxs(M,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"Available Options"}),e.jsx(Q,{children:"Select options to add to your ranking, or mark them as unavailable."})]}),e.jsxs(B,{children:[j.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"All options have been ranked or marked unavailable"}):e.jsx("div",{className:"space-y-2",children:j.map((t,i)=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{id:`unavailable-${t.id}`,checked:x.has(t.id),onCheckedChange:()=>b(t.id)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(z,{className:"mr-2 h-4 w-4 text-gray-500"}),q(t.suggestedDatetime,"EEEE, MMMM d, yyyy")," at"," ",q(t.suggestedDatetime,"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(J,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.reasoning}),e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(N=>e.jsxs(E,{size:"sm",variant:"outline",onClick:()=>w(t,N),disabled:l[N]!==null,children:["Set as #",N+1]},N))})]})]})},t.id))}),x.size>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Unavailable Options"]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>x.has(t.id)).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 p-2 bg-gray-100 rounded",children:[e.jsx("span",{children:q(t.suggestedDatetime,"MMM d, h:mm a")}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>b(t.id),children:"Mark Available"})]},t.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(E,{onClick:k,disabled:!O||r,size:"lg",children:r?"Submitting...":"Submit Preferences"})}),!O&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please rank at least one option before submitting"})]})}function es({bookingDetails:s,oldScheduledTime:n,newScheduledTime:r,route:o,onConfirm:l,onCancel:g,onRequestNewOptions:x,loading:m=!1}){const[c,d]=h.useState(!1),[j,v]=h.useState(null),C=new Date(n),y=new Date(r),w=()=>P(this,null,function*(){try{d(!0),v(null);const a=yield l();a.success||(a.requiresNewOptions?v({message:a.error||"Weather conditions have changed",requiresNewOptions:!0}):v({message:a.error||"Failed to confirm reschedule",requiresNewOptions:!1}))}catch(a){const b=L(a);v({message:b.message,requiresNewOptions:!1}),W(a,"confirm-reschedule")}finally{d(!1)}});return e.jsxs("div",{className:"space-y-6",children:[!j&&e.jsx(M,{className:"bg-green-50 border-green-200",children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-green-800",children:[e.jsx(Te,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ready to Confirm Reschedule"}),e.jsx("p",{className:"text-sm",children:"Weather will be re-validated before final confirmation"})]})]})})}),j&&e.jsxs(G,{variant:"destructive",children:[e.jsx(_e,{className:"h-5 w-5"}),e.jsxs($,{children:[e.jsx("p",{className:"font-semibold mb-2",children:j.message}),j.requiresNewOptions&&e.jsx("p",{className:"text-sm mb-3",children:"The selected time slot no longer meets weather requirements. New options need to be generated."}),j.requiresNewOptions&&x&&e.jsxs(E,{onClick:x,variant:"outline",size:"sm",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Generate New Options"]})]})]}),e.jsxs(M,{children:[e.jsxs(U,{children:[e.jsx(H,{children:"Schedule Change Summary"}),e.jsx(Q,{children:"Review the details of your rescheduled flight"})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{variant:"outline",children:"Original Time"})}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),F(C,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),F(C,"h:mm a")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{className:"bg-green-500",children:"New Time"})}),e.jsxs("div",{className:"p-4 bg-green-100 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-1 font-medium",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),F(y,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-green-800 font-medium",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),F(y,"h:mm a")]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Flight Details"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Route:"}),e.jsxs("span",{className:"text-sm font-medium",children:[o.departureAirport," → ",o.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Student:"}),e.jsx("span",{className:"text-sm font-medium",children:s.studentName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Instructor:"}),e.jsx("span",{className:"text-sm font-medium",children:s.instructorName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Aircraft:"}),e.jsx("span",{className:"text-sm font-medium",children:s.aircraftType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Training Level:"}),e.jsx(D,{variant:"outline",children:s.trainingLevel})]})]})]}),e.jsxs("div",{className:"border-t pt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather will be checked immediately before confirmation"}),e.jsxs("div",{className:"flex gap-3",children:[g&&e.jsx(E,{variant:"outline",onClick:g,disabled:c,children:"Cancel"}),e.jsx(E,{onClick:w,disabled:c||m,children:c?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating Weather..."]}):"Confirm Reschedule"})]})]})]})]}),e.jsx(M,{className:"bg-blue-50 border-blue-200",children:e.jsx(B,{className:"pt-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What Happens Next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Weather conditions will be re-validated in real-time"}),e.jsx("li",{children:"If conditions are suitable, the booking will be updated"}),e.jsx("li",{children:"Both student and instructor will receive email confirmation"}),e.jsx("li",{children:"Weather monitoring will continue for the new time slot"})]})]})})})]})}function ds(){const{bookingId:s}=Le(),n=We(),[r,o]=h.useState(null),[l,g]=h.useState([]),[x,m]=h.useState(null),[c,d]=h.useState("options"),[j,v]=h.useState(!0),[C,y]=h.useState(!1),[w,a]=h.useState(null),[b,k]=h.useState(null),[O,t]=h.useState(!1);h.useEffect(()=>{s&&i()},[s]);const i=()=>P(this,null,function*(){if(s)try{v(!0),a(null);const f=yield He.getBooking(s);o(f);try{const p=yield se(s);g(p);try{const u=yield Ge(s);if(u.preference){k({option1Id:u.preference.option1Id,option2Id:u.preference.option2Id,option3Id:u.preference.option3Id,unavailableOptionIds:u.preference.unavailableOptionIds||[]});const R=u.preference.option1Id||u.preference.option2Id||u.preference.option3Id;if(R&&p.length>0){const I=p.find(K=>K.id===R);I?(m(I),d("confirmation")):d("preferences")}else p.length>0&&d("options")}else p.length>0&&d("options")}catch(u){p.length>0&&d("options")}}catch(p){d("options")}}catch(f){const p=L(f);a(p.message),W(f,"load-booking")}finally{v(!1)}});h.useEffect(()=>{P(this,null,function*(){if(!(!s||c!=="preferences"||l.length===0))try{const p=yield $e(s),u=p.find(I=>I.submittedAt),R=p.length>=2&&p.every(I=>I.submittedAt);if(u&&!R)t(!0),(u.option1Id||u.option2Id||u.option3Id)&&k({option1Id:u.option1Id,option2Id:u.option2Id,option3Id:u.option3Id,unavailableOptionIds:u.unavailableOptionIds||[]});else if(R&&u){const I=u.option1Id||u.option2Id||u.option3Id;if(I){const K=l.find(Ce=>Ce.id===I);K&&(m(K),d("confirmation"))}}}catch(p){}})},[s,c,l]);const N=f=>{if(g(f),f.length>0&&b){const p=b.option1Id||b.option2Id||b.option3Id;if(p){const u=f.find(R=>R.id===p);u?(m(u),d("confirmation")):d("preferences")}else d("preferences")}},ne=f=>P(this,null,function*(){if(s)try{y(!0),a(null);const p=yield ze(S({bookingId:s},f));k(f);const u=f.option1Id||f.option2Id||f.option3Id;if(u){const R=l.find(I=>I.id===u);R&&(m(R),p.bothSubmitted?(d("confirmation"),t(!1)):(a(null),t(!0)))}}catch(p){const u=L(p);a(u.message),W(p,"submit-preferences")}finally{y(!1)}}),Y=()=>P(this,null,function*(){if(!s||!x)return{success:!1,error:"Missing booking ID or selected option"};try{y(!0),a(null);const f=yield Ue(s);if(f.success)return n(`/bookings/${s}`),{success:!0};if(f.requiresNewOptions){if(f.newOptionsGenerated){g([]),m(null),k(null),t(!1),a(null);try{const p=yield se(s);N(p);const u=f.message||`New reschedule options have been automatically generated (${f.optionsCount||p.length} options). Please review and submit your preferences again.`;a(u),d("options")}catch(p){a(f.message||"New options were generated. Please refresh the page to see them."),d("options")}}else a(f.error||"Weather conditions have changed. Please generate new options."),d("options");return{success:!1,error:f.error,requiresNewOptions:!0}}else return a(f.error||"Failed to confirm reschedule"),{success:!1,error:f.error}}catch(f){const p=L(f);return a(p.message),W(f,"confirm-reschedule"),{success:!1,error:p.message}}finally{y(!1)}});return j?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(X,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]}):w&&!r?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(G,{variant:"destructive",children:e.jsx($,{children:w})}),e.jsx("div",{className:"mt-4",children:e.jsx(ee,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]}):r?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(ee,{to:`/bookings/${s}`,className:"text-blue-600 hover:text-blue-800 text-sm mb-2 inline-flex items-center",children:[e.jsx(Fe,{className:"mr-1 h-4 w-4"}),"Back to Booking Details"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reschedule Flight"}),e.jsxs("p",{className:"text-gray-600",children:[r.departureAirport," → ",r.arrivalAirport]})]})}),w&&e.jsx(G,{variant:"destructive",children:e.jsx($,{children:w})}),e.jsx(M,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center ${c==="options"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="options"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Generate Options"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${c==="preferences"?"text-blue-600 font-semibold":c==="confirmation"?"text-gray-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="preferences"?"bg-blue-600 text-white":c==="confirmation"?"bg-gray-400 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Rank Preferences"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${c==="confirmation"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="confirmation"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Confirm"})]})]})})}),c==="options"&&e.jsx(Ye,{bookingId:s,onOptionsLoaded:N,onContinue:()=>{l.length>0&&d("preferences")}}),c==="preferences"&&l.length>0&&e.jsxs(e.Fragment,{children:[O&&e.jsx(G,{className:"mb-4 bg-blue-50 border-blue-200",children:e.jsxs($,{className:"text-blue-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"✅ Your preferences have been submitted!"}),e.jsx("p",{className:"text-sm",children:"Waiting for the other party (student/instructor) to submit their preferences. Once both are submitted, you'll be able to confirm the reschedule."})]})}),e.jsx(Ze,{options:l,onSubmit:ne,loading:C,existingRanking:b||void 0})]}),c==="confirmation"&&x&&r&&e.jsx(es,{bookingDetails:{id:r.id,studentName:"Student",instructorName:"Instructor",aircraftType:r.aircraftId||"Aircraft",trainingLevel:r.trainingLevel||"student_pilot"},oldScheduledTime:r.scheduledDatetime,newScheduledTime:x.suggestedDatetime,route:{departureAirport:r.departureAirport,arrivalAirport:r.arrivalAirport},onConfirm:Y,onCancel:()=>d("preferences"),loading:C})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center text-gray-600",children:"Booking not found"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(ee,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]})}export{ds as default};
