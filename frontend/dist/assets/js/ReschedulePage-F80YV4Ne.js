var Ne=Object.defineProperty,ve=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var se=(s,i,r)=>i in s?Ne(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r,S=(s,i)=>{for(var r in i||(i={}))te.call(i,r)&&se(s,r,i[r]);if(G)for(var r of G(i))re.call(i,r)&&se(s,r,i[r]);return s},A=(s,i)=>ve(s,ye(i));var T=(s,i)=>{var r={};for(var d in s)te.call(s,d)&&i.indexOf(d)<0&&(r[d]=s[d]);if(s!=null&&G)for(var d of G(s))i.indexOf(d)<0&&re.call(s,d)&&(r[d]=s[d]);return r};var _=(s,i,r)=>new Promise((d,l)=>{var u=c=>{try{o(r.next(c))}catch(m){l(m)}},h=c=>{try{o(r.throw(c))}catch(m){l(m)}},o=c=>c.done?d(c.value):Promise.resolve(c.value).then(u,h);o((r=r.apply(s,i)).next())});import{j as e,e as $,C as F,n as U,g as we,o as Ce,p as ke,q as J,u as Se,r as de,s as ae,t as Ee,v as Ie,G as Re,a as De,i as Oe,T as Ae,R as ne,h as ie,w as le,A as Me}from"./ui-vendor-D_mUPHSy.js";import{r as x,f as Pe,u as Be,L as Y}from"./react-vendor-DxF-uWSm.js";import{g as L,s as q,B as I,C as M,a as W,b as z,c as H,d as P,f as ce}from"./index-DDLgUnxE.js";import{B as D}from"./badge-Ccxfp5IU.js";import{A as K,a as V}from"./alert-Bm5Y6IyG.js";import{g as oe,a as _e,b as Te,s as Le,c as qe}from"./rescheduling-CR8PiK3_.js";import{f as E}from"./utils-vendor-1hodNj4h.js";import{B as Fe}from"./booking-DTcX_qHk.js";function We({bookingId:s,onOptionsLoaded:i,onContinue:r}){const[d,l]=x.useState([]),[u,h]=x.useState(!0),[o,c]=x.useState(!1),[m,f]=x.useState(null);x.useEffect(()=>{b()},[s]);const b=()=>_(this,null,function*(){try{h(!0),f(null);const a=yield oe(s);l(a),i&&i(a)}catch(a){const j=L(a);f(j.message),q(a,"load-reschedule-options")}finally{h(!1)}}),w=()=>_(this,null,function*(){try{c(!0),f(null);const a=yield _e(s);l(a),i&&i(a)}catch(a){const j=L(a);f(j.message),q(a,"generate-reschedule-options")}finally{c(!1)}}),N=a=>a>=.8?e.jsx(D,{className:"bg-green-500",children:"High Confidence"}):a>=.6?e.jsx(D,{className:"bg-yellow-500",children:"Medium Confidence"}):e.jsx(D,{className:"bg-orange-500",children:"Low Confidence"}),y=a=>a>=.8?e.jsx(D,{className:"bg-blue-500",children:"Excellent Weather"}):a>=.6?e.jsx(D,{className:"bg-blue-400",children:"Good Weather"}):e.jsx(D,{className:"bg-gray-500",children:"Fair Weather"});return u?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx($,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading options..."})]}):m?e.jsx(K,{variant:"destructive",children:e.jsxs(V,{children:[e.jsx("p",{className:"mb-2",children:m}),e.jsx(I,{onClick:b,variant:"outline",size:"sm",children:"Retry"})]})}):d.length===0?e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsx(z,{children:"No Reschedule Options"}),e.jsx(H,{children:"Generate new options using our AI scheduling assistant."})]}),e.jsx(P,{children:e.jsxs(I,{onClick:w,disabled:o,children:[o&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Options"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Reschedule Options"}),e.jsxs(I,{onClick:w,disabled:o,variant:"outline",size:"sm",children:[o&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerate"]})]}),e.jsx("div",{className:"grid gap-4",children:d.map((a,j)=>e.jsxs(M,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{className:"text-base",children:["Option ",j+1]}),e.jsxs("div",{className:"flex gap-2",children:[N(a.confidence),y(a.weatherScore)]})]})}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(F,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:E(new Date(a.suggestedDatetime),"EEEE, MMMM d, yyyy")}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["at ",E(new Date(a.suggestedDatetime),"h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(U,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[a.departureAirport," → ",a.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(we,{className:"mr-2 h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700",children:a.reasoning})})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("span",{children:["Weather Score: ",(a.weatherScore*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Confidence: ",(a.confidence*100).toFixed(0),"%"]})]})]})]},a.id))}),r&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(I,{onClick:r,size:"lg",children:"Continue to Preferences"})})]})}function ze(s){const i=x.useRef({value:s,previous:s});return x.useMemo(()=>(i.current.value!==s&&(i.current.previous=i.current.value,i.current.value=s),i.current.previous),[s])}var X="Checkbox",[Ge]=Ce(X),[$e,Q]=Ge(X);function Ue(s){const{__scopeCheckbox:i,checked:r,children:d,defaultChecked:l,disabled:u,form:h,name:o,onCheckedChange:c,required:m,value:f="on",internal_do_not_use_render:b}=s,[w,N]=Se({prop:r,defaultProp:l!=null?l:!1,onChange:c,caller:X}),[y,a]=x.useState(null),[j,k]=x.useState(null),R=x.useRef(!1),t=y?!!h||!!y.closest("form"):!0,n={checked:w,disabled:u,setChecked:N,control:y,setControl:a,name:o,form:h,value:f,hasConsumerStoppedPropagationRef:R,required:m,defaultChecked:B(l)?!1:l,isFormControl:t,bubbleInput:j,setBubbleInput:k};return e.jsx($e,A(S({scope:i},n),{children:He(b)?b(n):d}))}var me="CheckboxTrigger",xe=x.forwardRef((u,l)=>{var h=u,{__scopeCheckbox:s,onKeyDown:i,onClick:r}=h,d=T(h,["__scopeCheckbox","onKeyDown","onClick"]);const{control:o,value:c,disabled:m,checked:f,required:b,setControl:w,setChecked:N,hasConsumerStoppedPropagationRef:y,isFormControl:a,bubbleInput:j}=Q(me,s),k=de(l,w),R=x.useRef(f);return x.useEffect(()=>{const t=o==null?void 0:o.form;if(t){const n=()=>N(R.current);return t.addEventListener("reset",n),()=>t.removeEventListener("reset",n)}},[o,N]),e.jsx(J.button,A(S({type:"button",role:"checkbox","aria-checked":B(f)?"mixed":f,"aria-required":b,"data-state":ge(f),"data-disabled":m?"":void 0,disabled:m,value:c},d),{ref:k,onKeyDown:ae(i,t=>{t.key==="Enter"&&t.preventDefault()}),onClick:ae(r,t=>{N(n=>B(n)?!0:!n),j&&a&&(y.current=t.isPropagationStopped(),y.current||t.stopPropagation())})}))});xe.displayName=me;var Z=x.forwardRef((s,i)=>{const w=s,{__scopeCheckbox:r,name:d,checked:l,defaultChecked:u,required:h,disabled:o,value:c,onCheckedChange:m,form:f}=w,b=T(w,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(Ue,{__scopeCheckbox:r,checked:l,defaultChecked:u,disabled:o,required:h,onCheckedChange:m,name:d,form:f,value:c,internal_do_not_use_render:({isFormControl:N})=>e.jsxs(e.Fragment,{children:[e.jsx(xe,A(S({},b),{ref:i,__scopeCheckbox:r})),N&&e.jsx(pe,{__scopeCheckbox:r})]})})});Z.displayName=X;var he="CheckboxIndicator",ue=x.forwardRef((s,i)=>{const h=s,{__scopeCheckbox:r,forceMount:d}=h,l=T(h,["__scopeCheckbox","forceMount"]),u=Q(he,r);return e.jsx(ke,{present:d||B(u.checked)||u.checked===!0,children:e.jsx(J.span,A(S({"data-state":ge(u.checked),"data-disabled":u.disabled?"":void 0},l),{ref:i,style:S({pointerEvents:"none"},s.style)}))})});ue.displayName=he;var fe="CheckboxBubbleInput",pe=x.forwardRef((d,r)=>{var l=d,{__scopeCheckbox:s}=l,i=T(l,["__scopeCheckbox"]);const{control:u,hasConsumerStoppedPropagationRef:h,checked:o,defaultChecked:c,required:m,disabled:f,name:b,value:w,form:N,bubbleInput:y,setBubbleInput:a}=Q(fe,s),j=de(r,a),k=ze(o),R=Ee(u);x.useEffect(()=>{const n=y;if(!n)return;const v=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(v,"checked").set,C=!h.current;if(k!==o&&g){const O=new Event("click",{bubbles:C});n.indeterminate=B(o),g.call(n,B(o)?!1:o),n.dispatchEvent(O)}},[y,k,o,h]);const t=x.useRef(B(o)?!1:o);return e.jsx(J.input,A(S({type:"checkbox","aria-hidden":!0,defaultChecked:c!=null?c:t.current,required:m,disabled:f,name:b,value:w,form:N},i),{tabIndex:-1,ref:j,style:A(S(S({},i.style),R),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});pe.displayName=fe;function He(s){return typeof s=="function"}function B(s){return s==="indeterminate"}function ge(s){return B(s)?"indeterminate":s?"checked":"unchecked"}const je=x.forwardRef((d,r)=>{var l=d,{className:s}=l,i=T(l,["className"]);return e.jsx(Z,A(S({ref:r,className:ce("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},i),{children:e.jsx(ue,{className:ce("grid place-content-center text-current"),children:e.jsx(Ie,{className:"h-4 w-4"})})}))});je.displayName=Z.displayName;function Ke({options:s,onSubmit:i,loading:r=!1,existingRanking:d}){const[l,u]=x.useState([null,null,null]),[h,o]=x.useState(new Set),[c,m]=x.useState(null);x.useEffect(()=>{if(d&&s.length>0){const t=[null,null,null];d.option1Id&&(t[0]=s.find(n=>n.id===d.option1Id)||null),d.option2Id&&(t[1]=s.find(n=>n.id===d.option2Id)||null),d.option3Id&&(t[2]=s.find(n=>n.id===d.option3Id)||null),u(t),o(new Set(d.unavailableOptionIds||[]))}},[d,s]);const f=s.filter(t=>!l.some(n=>(n==null?void 0:n.id)===t.id)&&!h.has(t.id)),b=t=>{m(t)},w=t=>{t.preventDefault()},N=t=>{if(c===null)return;const n=[...l],v=l[c];n[c]=n[t],n[t]=v,u(n),m(null)},y=(t,n)=>{const v=[...l];v[n]=t,u(v)},a=t=>{const n=[...l];n[t]=null,u(n)},j=t=>{const n=new Set(h);n.has(t)?n.delete(t):(n.add(t),u(l.map(v=>(v==null?void 0:v.id)===t?null:v))),o(n)},k=()=>{var t,n,v;i({option1Id:(t=l[0])==null?void 0:t.id,option2Id:(n=l[1])==null?void 0:n.id,option3Id:(v=l[2])==null?void 0:v.id,unavailableOptionIds:Array.from(h)})},R=l.some(t=>t!==null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsx(z,{children:"Rank Your Preferences"}),e.jsx(H,{children:"Drag options to rank them in order of preference, or mark options as unavailable. Your #1 choice will be given the highest weight in the final selection."})]}),e.jsx(P,{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:l.map((t,n)=>e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] bg-gray-50",onDragOver:w,onDrop:()=>N(n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[n===0?"1st":n===1?"2nd":"3rd"," Choice"]}),t&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>a(n),children:"Remove"})]}),t?e.jsx("div",{className:"bg-white border rounded-lg p-3 cursor-move",draggable:!0,onDragStart:()=>b(n),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(F,{className:"mr-2 h-4 w-4 text-gray-500"}),E(new Date(t.suggestedDatetime),"EEE, MMM d")," at"," ",E(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(U,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]})]})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Drag an option here or select from below"})]},n))})})]}),e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsx(z,{children:"Available Options"}),e.jsx(H,{children:"Select options to add to your ranking, or mark them as unavailable."})]}),e.jsxs(P,{children:[f.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"All options have been ranked or marked unavailable"}):e.jsx("div",{className:"space-y-2",children:f.map((t,n)=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{id:`unavailable-${t.id}`,checked:h.has(t.id),onCheckedChange:()=>j(t.id)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(F,{className:"mr-2 h-4 w-4 text-gray-500"}),E(new Date(t.suggestedDatetime),"EEEE, MMMM d, yyyy")," at"," ",E(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(U,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.reasoning}),e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(v=>e.jsxs(I,{size:"sm",variant:"outline",onClick:()=>y(t,v),disabled:l[v]!==null,children:["Set as #",v+1]},v))})]})]})},t.id))}),h.size>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Unavailable Options"]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>h.has(t.id)).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 p-2 bg-gray-100 rounded",children:[e.jsx("span",{children:E(new Date(t.suggestedDatetime),"MMM d, h:mm a")}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>j(t.id),children:"Mark Available"})]},t.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(I,{onClick:k,disabled:!R||r,size:"lg",children:r?"Submitting...":"Submit Preferences"})}),!R&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please rank at least one option before submitting"})]})}function Ve({bookingDetails:s,oldScheduledTime:i,newScheduledTime:r,route:d,onConfirm:l,onCancel:u,onRequestNewOptions:h,loading:o=!1}){const[c,m]=x.useState(!1),[f,b]=x.useState(null),w=new Date(i),N=new Date(r),y=()=>_(this,null,function*(){try{m(!0),b(null);const a=yield l();a.success||(a.requiresNewOptions?b({message:a.error||"Weather conditions have changed",requiresNewOptions:!0}):b({message:a.error||"Failed to confirm reschedule",requiresNewOptions:!1}))}catch(a){const j=L(a);b({message:j.message,requiresNewOptions:!1}),q(a,"confirm-reschedule")}finally{m(!1)}});return e.jsxs("div",{className:"space-y-6",children:[!f&&e.jsx(M,{className:"bg-green-50 border-green-200",children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-green-800",children:[e.jsx(Oe,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ready to Confirm Reschedule"}),e.jsx("p",{className:"text-sm",children:"Weather will be re-validated before final confirmation"})]})]})})}),f&&e.jsxs(K,{variant:"destructive",children:[e.jsx(Ae,{className:"h-5 w-5"}),e.jsxs(V,{children:[e.jsx("p",{className:"font-semibold mb-2",children:f.message}),f.requiresNewOptions&&e.jsx("p",{className:"text-sm mb-3",children:"The selected time slot no longer meets weather requirements. New options need to be generated."}),f.requiresNewOptions&&h&&e.jsxs(I,{onClick:h,variant:"outline",size:"sm",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Generate New Options"]})]})]}),e.jsxs(M,{children:[e.jsxs(W,{children:[e.jsx(z,{children:"Schedule Change Summary"}),e.jsx(H,{children:"Review the details of your rescheduled flight"})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{variant:"outline",children:"Original Time"})}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),E(w,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),E(w,"h:mm a")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{className:"bg-green-500",children:"New Time"})}),e.jsxs("div",{className:"p-4 bg-green-100 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-1 font-medium",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),E(N,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-green-800 font-medium",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),E(N,"h:mm a")]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Flight Details"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Route:"}),e.jsxs("span",{className:"text-sm font-medium",children:[d.departureAirport," → ",d.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Student:"}),e.jsx("span",{className:"text-sm font-medium",children:s.studentName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Instructor:"}),e.jsx("span",{className:"text-sm font-medium",children:s.instructorName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Aircraft:"}),e.jsx("span",{className:"text-sm font-medium",children:s.aircraftType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Training Level:"}),e.jsx(D,{variant:"outline",children:s.trainingLevel})]})]})]}),e.jsxs("div",{className:"border-t pt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather will be checked immediately before confirmation"}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx(I,{variant:"outline",onClick:u,disabled:c,children:"Cancel"}),e.jsx(I,{onClick:y,disabled:c||o,children:c?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating Weather..."]}):"Confirm Reschedule"})]})]})]})]}),e.jsx(M,{className:"bg-blue-50 border-blue-200",children:e.jsx(P,{className:"pt-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What Happens Next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Weather conditions will be re-validated in real-time"}),e.jsx("li",{children:"If conditions are suitable, the booking will be updated"}),e.jsx("li",{children:"Both student and instructor will receive email confirmation"}),e.jsx("li",{children:"Weather monitoring will continue for the new time slot"})]})]})})})]})}function as(){const{bookingId:s}=Pe(),i=Be(),[r,d]=x.useState(null),[l,u]=x.useState([]),[h,o]=x.useState(null),[c,m]=x.useState("options"),[f,b]=x.useState(!0),[w,N]=x.useState(!1),[y,a]=x.useState(null),[j,k]=x.useState(null);x.useEffect(()=>{s&&R()},[s]);const R=()=>_(this,null,function*(){if(s)try{b(!0),a(null);const p=yield Fe.getBooking(s);d(p);try{const g=yield oe(s);u(g);try{const C=yield Te(s);if(C.preference){k({option1Id:C.preference.option1Id,option2Id:C.preference.option2Id,option3Id:C.preference.option3Id,unavailableOptionIds:C.preference.unavailableOptionIds||[]});const O=C.preference.option1Id||C.preference.option2Id||C.preference.option3Id;if(O&&g.length>0){const ee=g.find(be=>be.id===O);ee?(o(ee),m("confirmation")):m("preferences")}else g.length>0&&m("options")}else g.length>0&&m("options")}catch(C){g.length>0&&m("options")}}catch(g){m("options")}}catch(p){const g=L(p);a(g.message),q(p,"load-booking")}finally{b(!1)}}),t=p=>{if(u(p),p.length>0&&j){const g=j.option1Id||j.option2Id||j.option3Id;if(g){const C=p.find(O=>O.id===g);C?(o(C),m("confirmation")):m("preferences")}else m("preferences")}},n=p=>_(this,null,function*(){if(s)try{N(!0),a(null),yield Le(S({bookingId:s},p)),k(p);const g=p.option1Id||p.option2Id||p.option3Id;if(g){const C=l.find(O=>O.id===g);C&&(o(C),m("confirmation"))}}catch(g){const C=L(g);a(C.message),q(g,"submit-preferences")}finally{N(!1)}}),v=()=>_(this,null,function*(){if(!s||!h)return{success:!1,error:"Missing booking ID or selected option"};try{N(!0),a(null);const p=yield qe(s);return p.success?(i(`/bookings/${s}`),{success:!0}):p.requiresNewOptions?(a(p.error||"Weather conditions have changed. Please generate new options."),m("options"),{success:!1,error:p.error,requiresNewOptions:!0}):(a(p.error||"Failed to confirm reschedule"),{success:!1,error:p.error})}catch(p){const g=L(p);return a(g.message),q(p,"confirm-reschedule"),{success:!1,error:g.message}}finally{N(!1)}});return f?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx($,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]}):y&&!r?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(K,{variant:"destructive",children:e.jsx(V,{children:y})}),e.jsx("div",{className:"mt-4",children:e.jsx(Y,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]}):r?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(Y,{to:`/bookings/${s}`,className:"text-blue-600 hover:text-blue-800 text-sm mb-2 inline-flex items-center",children:[e.jsx(Me,{className:"mr-1 h-4 w-4"}),"Back to Booking Details"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reschedule Flight"}),e.jsxs("p",{className:"text-gray-600",children:[r.departureAirport," → ",r.arrivalAirport]})]})}),y&&e.jsx(K,{variant:"destructive",children:e.jsx(V,{children:y})}),e.jsx(M,{children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center ${c==="options"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="options"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Generate Options"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${c==="preferences"?"text-blue-600 font-semibold":c==="confirmation"?"text-gray-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="preferences"?"bg-blue-600 text-white":c==="confirmation"?"bg-gray-400 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Rank Preferences"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${c==="confirmation"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${c==="confirmation"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Confirm"})]})]})})}),c==="options"&&e.jsx(We,{bookingId:s,onOptionsLoaded:t,onContinue:()=>{l.length>0&&m("preferences")}}),c==="preferences"&&l.length>0&&e.jsx(Ke,{options:l,onSubmit:n,loading:w,existingRanking:j||void 0}),c==="confirmation"&&h&&r&&e.jsx(Ve,{bookingDetails:{id:r.id,studentName:"Student",instructorName:"Instructor",aircraftType:r.aircraftId||"Aircraft",trainingLevel:r.trainingLevel||"student_pilot"},oldScheduledTime:r.scheduledDatetime,newScheduledTime:h.suggestedDatetime,route:{departureAirport:r.departureAirport,arrivalAirport:r.arrivalAirport},onConfirm:v,onCancel:()=>m("preferences"),loading:w})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center text-gray-600",children:"Booking not found"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(Y,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]})}export{as as default};
