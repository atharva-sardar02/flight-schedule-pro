var L=(s,a,l)=>new Promise((c,r)=>{var o=d=>{try{m(l.next(d))}catch(N){r(N)}},t=d=>{try{m(l.throw(d))}catch(N){r(N)}},m=d=>d.done?c(d.value):Promise.resolve(d.value).then(o,t);m((l=l.apply(s,a)).next())});import{j as e,q as k,r as M,T as H,s as S,U as O,a as R,t as I,v as U,w as se,x as te,p as ae,y as re}from"./ui-vendor-X7k4bu4n.js";import{r as f,u as ie}from"./react-vendor-C9zT986Q.js";import{C as h,a as x,b as y,c as p,d as u,B as w,u as le,U as C}from"./index-B5m-gi1T.js";import{B as n}from"./badge-DCJjXdB5.js";import{p as D,f as ne,b as ce,i as de,c as oe}from"./utils-vendor-1hodNj4h.js";import{B as $}from"./booking-Sr7KVi8d.js";import{B as v}from"./booking-CF_xURUj.js";function he(s){const a=s.toLowerCase();return a.includes("clear")||a.includes("sunny")?"‚òÄÔ∏è":a.includes("cloud")?"‚òÅÔ∏è":a.includes("rain")?"üåßÔ∏è":a.includes("snow")?"‚ùÑÔ∏è":a.includes("fog")||a.includes("mist")?"üå´Ô∏è":a.includes("thunder")||a.includes("storm")?"‚õàÔ∏è":a.includes("wind")?"üí®":"üå§Ô∏è"}function xe(s,a,l,c){const r=c.toLowerCase();return s<3||a>25||l<1e3||r.includes("thunder")||r.includes("ice")||r.includes("severe")?"unsafe":s<5||a>15||l<3e3||r.includes("rain")||r.includes("fog")?"caution":"safe"}function ue(s){switch(s){case"safe":return"text-green-600 bg-green-50 border-green-200";case"caution":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"unsafe":return"text-red-600 bg-red-50 border-red-200"}}function _(s,a="MMM d, yyyy h:mm a"){const l=typeof s=="string"?D(s):s;return ne(l,a)}function P(s){const a=typeof s=="string"?D(s):s;return ce(a,new Date,{addSuffix:!0})}function me(s){const a=typeof s=="string"?D(s):s;return de(a)}function ge(s){const a=typeof s=="string"?D(s):s;return oe(a)}function je({alerts:s=[],loading:a=!1}){const[l,c]=f.useState(s);f.useEffect(()=>{c(s)},[s]);const r=t=>{switch(t){case"critical":return e.jsx(H,{className:"h-5 w-5 text-red-600"});case"warning":return e.jsx(M,{className:"h-5 w-5 text-yellow-600"});case"info":return e.jsx(k,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(M,{className:"h-5 w-5 text-gray-600"})}},o=t=>{switch(t){case"critical":return e.jsx(n,{className:"bg-red-500",children:"Critical"});case"warning":return e.jsx(n,{className:"bg-yellow-500",children:"Warning"});case"info":return e.jsx(n,{className:"bg-blue-500",children:"Info"});default:return e.jsx(n,{variant:"outline",children:"Unknown"})}};return a?e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Weather Alerts"}),e.jsx(p,{children:"Loading weather alerts..."})]}),e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})})]}):l.length===0?e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Weather Alerts"}),e.jsx(p,{children:"All flights are clear of weather conflicts"})]}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-green-600",children:[e.jsx(k,{className:"h-12 w-12 mb-3"}),e.jsx("p",{className:"font-medium",children:"No Active Weather Alerts"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"All upcoming flights meet weather minimums"})]})})]}):e.jsxs(h,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Weather Alerts"}),e.jsxs(p,{children:[l.length," active alert",l.length>1?"s":""]})]}),e.jsx(n,{variant:"outline",className:"text-lg px-3 py-1",children:l.length})]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-3",children:l.map(t=>{const m=xe(t.weather.visibility,t.weather.windSpeed,t.weather.ceiling,t.weather.conditions),d=ue(m);return e.jsxs("div",{className:`border rounded-lg p-4 ${d}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.severity),e.jsx("h4",{className:"font-semibold",children:t.flightInfo.route})]}),o(t.severity)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Scheduled:"}),e.jsx("p",{className:"font-medium",children:_(t.flightInfo.scheduledTime)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Training Level:"}),e.jsx("p",{className:"font-medium",children:t.flightInfo.trainingLevel})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[he(t.weather.conditions),e.jsx("span",{className:"font-medium",children:t.weather.conditions})]}),e.jsxs("span",{children:["Vis: ",t.weather.visibility,"mi"]}),e.jsxs("span",{children:["Wind: ",t.weather.windSpeed,"kt"]}),e.jsxs("span",{children:["Ceiling: ",t.weather.ceiling,"ft"]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["Detected ",P(t.detectedAt)]})]},t.id)})})})]})}function fe({bookings:s=[],loading:a=!1,onViewDetails:l}){const c=t=>{switch(t){case"CONFIRMED":return e.jsx(n,{className:"bg-green-500",children:"Confirmed"});case"AT_RISK":return e.jsx(n,{className:"bg-yellow-500",children:"At Risk"});case"RESCHEDULING":return e.jsx(n,{className:"bg-blue-500",children:"Rescheduling"});case"RESCHEDULED":return e.jsx(n,{className:"bg-purple-500",children:"Rescheduled"});case"CANCELLED":return e.jsx(n,{className:"bg-gray-500",children:"Cancelled"});case"PENDING_RESCHEDULE":return e.jsx(n,{className:"bg-blue-500",children:"Pending Reschedule"});case"ESCALATED":return e.jsx(n,{className:"bg-red-500",children:"Escalated"});default:return e.jsx(n,{variant:"outline",children:t})}},r=t=>{switch(t){case"CONFIRMED":return e.jsx(U,{className:"h-5 w-5 text-green-600"});case"AT_RISK":return e.jsx(R,{className:"h-5 w-5 text-yellow-600"});case"RESCHEDULING":return e.jsx(I,{className:"h-5 w-5 text-blue-600"});case"RESCHEDULED":return e.jsx(U,{className:"h-5 w-5 text-purple-600"});case"CANCELLED":return e.jsx(R,{className:"h-5 w-5 text-gray-600"});case"PENDING_RESCHEDULE":return e.jsx(I,{className:"h-5 w-5 text-blue-600"});case"ESCALATED":return e.jsx(R,{className:"h-5 w-5 text-red-600"});default:return e.jsx(S,{className:"h-5 w-5 text-gray-600"})}},o=t=>me(t)?e.jsx(n,{variant:"outline",className:"text-blue-600 border-blue-600",children:"Today"}):ge(t)?e.jsx(n,{variant:"outline",className:"text-purple-600 border-purple-600",children:"Tomorrow"}):null;return a?e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Flight Status"}),e.jsx(p,{children:"Loading bookings..."})]}),e.jsx(u,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading..."})})})]}):s.length===0?e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(y,{children:"Flight Status"}),e.jsx(p,{children:"No upcoming flights scheduled"})]}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-600",children:[e.jsx(S,{className:"h-12 w-12 mb-3"}),e.jsx("p",{className:"font-medium",children:"No Upcoming Flights"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Schedule a new flight to get started"})]})})]}):e.jsxs(h,{children:[e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(y,{children:"Flight Status"}),e.jsxs(p,{children:[s.length," upcoming flight",s.length>1?"s":""]})]})})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r(t.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h4",{className:"font-semibold",children:[t.departureAirport," ‚Üí ",t.arrivalAirport]}),o(t.scheduledTime)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[_(t.scheduledTime)," (",P(t.scheduledTime),")"]})]})]}),c(t.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Student"}),e.jsx("p",{className:"font-medium",children:t.studentName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Instructor"}),e.jsx("p",{className:"font-medium",children:t.instructorName})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-4 w-4"}),t.aircraftType]}),e.jsx(n,{variant:"outline",children:t.trainingLevel})]}),l&&e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>l(t.id),children:"View Details"})]})]},t.id))})})]})}const pe=[{label:"Total Flights",value:0,icon:e.jsx(S,{className:"h-5 w-5 text-blue-600"}),description:"Scheduled this month"},{label:"Active Alerts",value:0,icon:e.jsx(H,{className:"h-5 w-5 text-yellow-600"}),description:"Weather conflicts detected"},{label:"Successful Reschedules",value:0,icon:e.jsx(U,{className:"h-5 w-5 text-green-600"}),description:"Completed this month"},{label:"Avg Response Time",value:"--",icon:e.jsx(I,{className:"h-5 w-5 text-purple-600"}),description:"Preference submission time"}];function Ne({metrics:s=pe,loading:a=!1}){const l=r=>{switch(r){case"up":return e.jsx(te,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(se,{className:"h-4 w-4 text-red-600"});default:return null}},c=r=>{switch(r){case"up":return"text-green-600";case"down":return"text-red-600";default:return"text-gray-600"}};return a?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(r=>e.jsxs(h,{children:[e.jsx(x,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse w-24"})}),e.jsxs(u,{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-16 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-32"})]})]},r))}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:s.map((r,o)=>e.jsxs(h,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{className:"text-sm font-medium",children:r.label}),r.icon]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("div",{className:"text-2xl font-bold",children:r.value}),r.change&&e.jsxs("div",{className:`flex items-center text-sm ${c(r.change.trend)}`,children:[l(r.change.trend),e.jsxs("span",{className:"ml-1",children:[r.change.value>0?"+":"",r.change.value,"%"]})]})]}),r.description&&e.jsx("p",{className:"text-xs text-gray-600",children:r.description})]})]},o))})}function ve({size:s="md",text:a,fullScreen:l=!1}){const c={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"},r=e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsx(ae,{className:`${c[s]} animate-spin text-blue-600`}),a&&e.jsx("p",{className:"text-sm text-gray-600",children:a})]});return l?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white bg-opacity-75 z-50",children:r}):r}function We(){const{user:s}=le(),a=ie(),[l,c]=f.useState(!0),[r,o]=f.useState(!1),[t,m]=f.useState(new Date),[d,N]=f.useState({metrics:[],weatherAlerts:[],bookings:[]});f.useEffect(()=>{if(s){B();const g=setInterval(()=>{F()},5*60*1e3);return()=>clearInterval(g)}},[s]);const B=()=>L(this,null,function*(){try{if(c(!0),!(s!=null&&s.id)){console.error("User not available");return}const g=new Date,T={limit:1e3};s.role===C.STUDENT?T.studentId=s.id:s.role===C.INSTRUCTOR&&(T.instructorId=s.id);const j=yield $.listBookings(T),b={limit:1e3};s.role===C.STUDENT?b.studentId=s.id:s.role===C.INSTRUCTOR&&(b.instructorId=s.id),b.status=v.RESCHEDULED;const W=yield $.listBookings(b),Q=j.length,J=j.filter(i=>i.status===v.AT_RISK).length,X=W.length,Y=j.filter(i=>i.status===v.CONFIRMED).length,we=j.length,ye=j.filter(i=>i.status===v.AT_RISK).length,be=W.length,Ae=0,Ce=0,Se=0,E=new Date;E.setDate(E.getDate()+7);const Z=j.filter(i=>{const A=new Date(i.scheduledDatetime);return A>=g&&A<=E&&i.status!==v.CANCELLED}).sort((i,A)=>new Date(i.scheduledDatetime).getTime()-new Date(A.scheduledDatetime).getTime()).slice(0,5).map(i=>({id:i.id,scheduledTime:i.scheduledDatetime,status:i.status,departureAirport:i.departureAirport,arrivalAirport:i.arrivalAirport,studentName:"Student",instructorName:"Instructor",aircraftType:i.aircraftId||"N/A",trainingLevel:i.trainingLevel})),ee=j.filter(i=>i.status===v.AT_RISK).map(i=>({id:i.id,bookingId:i.id,flightInfo:{scheduledTime:i.scheduledDatetime,route:`${i.departureAirport} ‚Üí ${i.arrivalAirport}`,trainingLevel:i.trainingLevel},weather:{visibility:0,windSpeed:0,ceiling:0,conditions:"Unknown"},severity:"warning",detectedAt:i.updatedAt}));N({metrics:[{label:"Total Flights",value:Q,change:{value:0,trend:"neutral"},description:"All bookings"},{label:"Active Alerts",value:J,change:{value:0,trend:"neutral"},description:"Weather conflicts detected"},{label:"Successful Reschedules",value:X,change:{value:0,trend:"neutral"},description:"All-time reschedules"},{label:"Confirmed Flights",value:Y,change:{value:0,trend:"neutral"},description:"All confirmed bookings"}],weatherAlerts:ee,bookings:Z}),m(new Date)}catch(g){console.error("Failed to load dashboard data:",g),N({metrics:[],weatherAlerts:[],bookings:[]})}finally{c(!1)}}),F=()=>L(this,null,function*(){try{o(!0),yield B()}finally{o(!1)}}),z=g=>{a(`/bookings/${g}`)},K=()=>{a("/bookings/new")},V=()=>{a("/availability")},G=()=>{a("/bookings")},q=()=>{a("/settings")};return l?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ve,{size:"lg",text:"Loading dashboard..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Welcome back, ",(s==null?void 0:s.name)||`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||"User"]})]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:F,disabled:r,children:[e.jsx(re,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Last updated: ",t.toLocaleTimeString()]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsx(Ne,{metrics:d.metrics}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx(je,{alerts:d.weatherAlerts}),e.jsx(fe,{bookings:d.bookings,onViewDetails:z})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsx(w,{onClick:K,children:"Schedule New Flight"}),e.jsx(w,{variant:"outline",onClick:V,children:"Manage Availability"}),e.jsx(w,{variant:"outline",onClick:G,children:"View All Bookings"}),e.jsx(w,{variant:"outline",onClick:q,children:"System Settings"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-600 rounded-full animate-pulse"}),e.jsx("p",{className:"text-sm font-medium",children:"Weather monitoring active ‚Ä¢ Checking every 10 minutes"})]})})]})]})}export{We as Dashboard};
