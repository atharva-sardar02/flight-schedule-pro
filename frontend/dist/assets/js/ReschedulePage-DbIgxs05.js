var ve=Object.defineProperty,ye=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var te=(s,a,r)=>a in s?ve(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,k=(s,a)=>{for(var r in a||(a={}))re.call(a,r)&&te(s,r,a[r]);if(G)for(var r of G(a))ae.call(a,r)&&te(s,r,a[r]);return s},M=(s,a)=>ye(s,we(a));var T=(s,a)=>{var r={};for(var l in s)re.call(s,l)&&a.indexOf(l)<0&&(r[l]=s[l]);if(s!=null&&G)for(var l of G(s))a.indexOf(l)<0&&ae.call(s,l)&&(r[l]=s[l]);return r};var S=(s,a,r)=>new Promise((l,i)=>{var u=d=>{try{o(r.next(d))}catch(m){i(m)}},h=d=>{try{o(r.throw(d))}catch(m){i(m)}},o=d=>d.done?l(d.value):Promise.resolve(d.value).then(u,h);o((r=r.apply(s,a)).next())});import{j as e,d as U,C as F,n as H,f as Ce,o as ke,p as Se,q as Q,u as Ee,r as oe,s as ne,t as Ie,v as Re,G as Oe,g as De,i as Ae,T as Me,R as ie,h as ce,w as le,A as Pe}from"./ui-vendor-iMAx8RKE.js";import{r as x,f as Be,u as _e,L as J}from"./react-vendor-DxF-uWSm.js";import{e as z,g as q,s as L,B as R,C as P,a as W,b as $,c as K,d as B,f as de}from"./index-JpjlLt7E.js";import{B as D}from"./badge-DabtTupC.js";import{A as V,a as X}from"./alert-FM1_hMiv.js";import{f as I}from"./utils-vendor-1hodNj4h.js";import{B as Te}from"./booking-BLHAa8QH.js";function qe(s){return S(this,null,function*(){return(yield z.post(`/reschedule/generate/${s}`)).data.options})}function me(s){return S(this,null,function*(){return(yield z.get(`/reschedule/options/${s}`)).data.options})}function Le(s){return S(this,null,function*(){return(yield z.post("/preferences/submit",s)).data})}function Fe(s){return S(this,null,function*(){return(yield z.get(`/preferences/my/${s}`)).data})}function We(s){return S(this,null,function*(){var a,r,l;try{const i=yield z.post(`/reschedule/confirm/${s}`);return k({success:!0},i.data)}catch(i){return((a=i.response)==null?void 0:a.status)===409?{success:!1,error:i.response.data.error||"Weather conditions no longer suitable",requiresNewOptions:i.response.data.requiresNewOptions||!1}:{success:!1,error:((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.error)||i.message||"Failed to confirm reschedule"}}})}function $e({bookingId:s,onOptionsLoaded:a,onContinue:r}){const[l,i]=x.useState([]),[u,h]=x.useState(!0),[o,d]=x.useState(!1),[m,f]=x.useState(null);x.useEffect(()=>{b()},[s]);const b=()=>S(this,null,function*(){try{h(!0),f(null);const n=yield me(s);i(n),a&&a(n)}catch(n){const j=q(n);f(j.message),L(n,"load-reschedule-options")}finally{h(!1)}}),w=()=>S(this,null,function*(){try{d(!0),f(null);const n=yield qe(s);i(n),a&&a(n)}catch(n){const j=q(n);f(j.message),L(n,"generate-reschedule-options")}finally{d(!1)}}),N=n=>n>=.8?e.jsx(D,{className:"bg-green-500",children:"High Confidence"}):n>=.6?e.jsx(D,{className:"bg-yellow-500",children:"Medium Confidence"}):e.jsx(D,{className:"bg-orange-500",children:"Low Confidence"}),y=n=>n>=.8?e.jsx(D,{className:"bg-blue-500",children:"Excellent Weather"}):n>=.6?e.jsx(D,{className:"bg-blue-400",children:"Good Weather"}):e.jsx(D,{className:"bg-gray-500",children:"Fair Weather"});return u?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(U,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading options..."})]}):m?e.jsx(V,{variant:"destructive",children:e.jsxs(X,{children:[e.jsx("p",{className:"mb-2",children:m}),e.jsx(R,{onClick:b,variant:"outline",size:"sm",children:"Retry"})]})}):l.length===0?e.jsxs(P,{children:[e.jsxs(W,{children:[e.jsx($,{children:"No Reschedule Options"}),e.jsx(K,{children:"Generate new options using our AI scheduling assistant."})]}),e.jsx(B,{children:e.jsxs(R,{onClick:w,disabled:o,children:[o&&e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Options"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Reschedule Options"}),e.jsxs(R,{onClick:w,disabled:o,variant:"outline",size:"sm",children:[o&&e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerate"]})]}),e.jsx("div",{className:"grid gap-4",children:l.map((n,j)=>e.jsxs(P,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"text-base",children:["Option ",j+1]}),e.jsxs("div",{className:"flex gap-2",children:[N(n.confidence),y(n.weatherScore)]})]})}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(F,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:I(new Date(n.suggestedDatetime),"EEEE, MMMM d, yyyy")}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["at ",I(new Date(n.suggestedDatetime),"h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(H,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[n.departureAirport," → ",n.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700",children:n.reasoning})})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("span",{children:["Weather Score: ",(n.weatherScore*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Confidence: ",(n.confidence*100).toFixed(0),"%"]})]})]})]},n.id))}),r&&e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(R,{onClick:r,size:"lg",children:"Continue to Preferences"})})]})}function ze(s){const a=x.useRef({value:s,previous:s});return x.useMemo(()=>(a.current.value!==s&&(a.current.previous=a.current.value,a.current.value=s),a.current.previous),[s])}var Y="Checkbox",[Ge]=ke(Y),[Ue,Z]=Ge(Y);function He(s){const{__scopeCheckbox:a,checked:r,children:l,defaultChecked:i,disabled:u,form:h,name:o,onCheckedChange:d,required:m,value:f="on",internal_do_not_use_render:b}=s,[w,N]=Ee({prop:r,defaultProp:i!=null?i:!1,onChange:d,caller:Y}),[y,n]=x.useState(null),[j,E]=x.useState(null),O=x.useRef(!1),t=y?!!h||!!y.closest("form"):!0,c={checked:w,disabled:u,setChecked:N,control:y,setControl:n,name:o,form:h,value:f,hasConsumerStoppedPropagationRef:O,required:m,defaultChecked:_(i)?!1:i,isFormControl:t,bubbleInput:j,setBubbleInput:E};return e.jsx(Ue,M(k({scope:a},c),{children:Ke(b)?b(c):l}))}var xe="CheckboxTrigger",he=x.forwardRef((u,i)=>{var h=u,{__scopeCheckbox:s,onKeyDown:a,onClick:r}=h,l=T(h,["__scopeCheckbox","onKeyDown","onClick"]);const{control:o,value:d,disabled:m,checked:f,required:b,setControl:w,setChecked:N,hasConsumerStoppedPropagationRef:y,isFormControl:n,bubbleInput:j}=Z(xe,s),E=oe(i,w),O=x.useRef(f);return x.useEffect(()=>{const t=o==null?void 0:o.form;if(t){const c=()=>N(O.current);return t.addEventListener("reset",c),()=>t.removeEventListener("reset",c)}},[o,N]),e.jsx(Q.button,M(k({type:"button",role:"checkbox","aria-checked":_(f)?"mixed":f,"aria-required":b,"data-state":je(f),"data-disabled":m?"":void 0,disabled:m,value:d},l),{ref:E,onKeyDown:ne(a,t=>{t.key==="Enter"&&t.preventDefault()}),onClick:ne(r,t=>{N(c=>_(c)?!0:!c),j&&n&&(y.current=t.isPropagationStopped(),y.current||t.stopPropagation())})}))});he.displayName=xe;var ee=x.forwardRef((s,a)=>{const w=s,{__scopeCheckbox:r,name:l,checked:i,defaultChecked:u,required:h,disabled:o,value:d,onCheckedChange:m,form:f}=w,b=T(w,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(He,{__scopeCheckbox:r,checked:i,defaultChecked:u,disabled:o,required:h,onCheckedChange:m,name:l,form:f,value:d,internal_do_not_use_render:({isFormControl:N})=>e.jsxs(e.Fragment,{children:[e.jsx(he,M(k({},b),{ref:a,__scopeCheckbox:r})),N&&e.jsx(ge,{__scopeCheckbox:r})]})})});ee.displayName=Y;var ue="CheckboxIndicator",fe=x.forwardRef((s,a)=>{const h=s,{__scopeCheckbox:r,forceMount:l}=h,i=T(h,["__scopeCheckbox","forceMount"]),u=Z(ue,r);return e.jsx(Se,{present:l||_(u.checked)||u.checked===!0,children:e.jsx(Q.span,M(k({"data-state":je(u.checked),"data-disabled":u.disabled?"":void 0},i),{ref:a,style:k({pointerEvents:"none"},s.style)}))})});fe.displayName=ue;var pe="CheckboxBubbleInput",ge=x.forwardRef((l,r)=>{var i=l,{__scopeCheckbox:s}=i,a=T(i,["__scopeCheckbox"]);const{control:u,hasConsumerStoppedPropagationRef:h,checked:o,defaultChecked:d,required:m,disabled:f,name:b,value:w,form:N,bubbleInput:y,setBubbleInput:n}=Z(pe,s),j=oe(r,n),E=ze(o),O=Ie(u);x.useEffect(()=>{const c=y;if(!c)return;const v=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(v,"checked").set,C=!h.current;if(E!==o&&g){const A=new Event("click",{bubbles:C});c.indeterminate=_(o),g.call(c,_(o)?!1:o),c.dispatchEvent(A)}},[y,E,o,h]);const t=x.useRef(_(o)?!1:o);return e.jsx(Q.input,M(k({type:"checkbox","aria-hidden":!0,defaultChecked:d!=null?d:t.current,required:m,disabled:f,name:b,value:w,form:N},a),{tabIndex:-1,ref:j,style:M(k(k({},a.style),O),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});ge.displayName=pe;function Ke(s){return typeof s=="function"}function _(s){return s==="indeterminate"}function je(s){return _(s)?"indeterminate":s?"checked":"unchecked"}const be=x.forwardRef((l,r)=>{var i=l,{className:s}=i,a=T(i,["className"]);return e.jsx(ee,M(k({ref:r,className:de("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},a),{children:e.jsx(fe,{className:de("grid place-content-center text-current"),children:e.jsx(Re,{className:"h-4 w-4"})})}))});be.displayName=ee.displayName;function Ve({options:s,onSubmit:a,loading:r=!1,existingRanking:l}){const[i,u]=x.useState([null,null,null]),[h,o]=x.useState(new Set),[d,m]=x.useState(null);x.useEffect(()=>{if(l&&s.length>0){const t=[null,null,null];l.option1Id&&(t[0]=s.find(c=>c.id===l.option1Id)||null),l.option2Id&&(t[1]=s.find(c=>c.id===l.option2Id)||null),l.option3Id&&(t[2]=s.find(c=>c.id===l.option3Id)||null),u(t),o(new Set(l.unavailableOptionIds||[]))}},[l,s]);const f=s.filter(t=>!i.some(c=>(c==null?void 0:c.id)===t.id)&&!h.has(t.id)),b=t=>{m(t)},w=t=>{t.preventDefault()},N=t=>{if(d===null)return;const c=[...i],v=i[d];c[d]=c[t],c[t]=v,u(c),m(null)},y=(t,c)=>{const v=[...i];v[c]=t,u(v)},n=t=>{const c=[...i];c[t]=null,u(c)},j=t=>{const c=new Set(h);c.has(t)?c.delete(t):(c.add(t),u(i.map(v=>(v==null?void 0:v.id)===t?null:v))),o(c)},E=()=>{var t,c,v;a({option1Id:(t=i[0])==null?void 0:t.id,option2Id:(c=i[1])==null?void 0:c.id,option3Id:(v=i[2])==null?void 0:v.id,unavailableOptionIds:Array.from(h)})},O=i.some(t=>t!==null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(W,{children:[e.jsx($,{children:"Rank Your Preferences"}),e.jsx(K,{children:"Drag options to rank them in order of preference, or mark options as unavailable. Your #1 choice will be given the highest weight in the final selection."})]}),e.jsx(B,{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:i.map((t,c)=>e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] bg-gray-50",onDragOver:w,onDrop:()=>N(c),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[c===0?"1st":c===1?"2nd":"3rd"," Choice"]}),t&&e.jsx(R,{variant:"ghost",size:"sm",onClick:()=>n(c),children:"Remove"})]}),t?e.jsx("div",{className:"bg-white border rounded-lg p-3 cursor-move",draggable:!0,onDragStart:()=>b(c),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(F,{className:"mr-2 h-4 w-4 text-gray-500"}),I(new Date(t.suggestedDatetime),"EEE, MMM d")," at"," ",I(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(H,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]})]})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Drag an option here or select from below"})]},c))})})]}),e.jsxs(P,{children:[e.jsxs(W,{children:[e.jsx($,{children:"Available Options"}),e.jsx(K,{children:"Select options to add to your ranking, or mark them as unavailable."})]}),e.jsxs(B,{children:[f.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"All options have been ranked or marked unavailable"}):e.jsx("div",{className:"space-y-2",children:f.map((t,c)=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(be,{id:`unavailable-${t.id}`,checked:h.has(t.id),onCheckedChange:()=>j(t.id)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(F,{className:"mr-2 h-4 w-4 text-gray-500"}),I(new Date(t.suggestedDatetime),"EEEE, MMMM d, yyyy")," at"," ",I(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(H,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.reasoning}),e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(v=>e.jsxs(R,{size:"sm",variant:"outline",onClick:()=>y(t,v),disabled:i[v]!==null,children:["Set as #",v+1]},v))})]})]})},t.id))}),h.size>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Unavailable Options"]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>h.has(t.id)).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 p-2 bg-gray-100 rounded",children:[e.jsx("span",{children:I(new Date(t.suggestedDatetime),"MMM d, h:mm a")}),e.jsx(R,{size:"sm",variant:"ghost",onClick:()=>j(t.id),children:"Mark Available"})]},t.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(R,{onClick:E,disabled:!O||r,size:"lg",children:r?"Submitting...":"Submit Preferences"})}),!O&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please rank at least one option before submitting"})]})}function Xe({bookingDetails:s,oldScheduledTime:a,newScheduledTime:r,route:l,onConfirm:i,onCancel:u,onRequestNewOptions:h,loading:o=!1}){const[d,m]=x.useState(!1),[f,b]=x.useState(null),w=new Date(a),N=new Date(r),y=()=>S(this,null,function*(){try{m(!0),b(null);const n=yield i();n.success||(n.requiresNewOptions?b({message:n.error||"Weather conditions have changed",requiresNewOptions:!0}):b({message:n.error||"Failed to confirm reschedule",requiresNewOptions:!1}))}catch(n){const j=q(n);b({message:j.message,requiresNewOptions:!1}),L(n,"confirm-reschedule")}finally{m(!1)}});return e.jsxs("div",{className:"space-y-6",children:[!f&&e.jsx(P,{className:"bg-green-50 border-green-200",children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-green-800",children:[e.jsx(Ae,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ready to Confirm Reschedule"}),e.jsx("p",{className:"text-sm",children:"Weather will be re-validated before final confirmation"})]})]})})}),f&&e.jsxs(V,{variant:"destructive",children:[e.jsx(Me,{className:"h-5 w-5"}),e.jsxs(X,{children:[e.jsx("p",{className:"font-semibold mb-2",children:f.message}),f.requiresNewOptions&&e.jsx("p",{className:"text-sm mb-3",children:"The selected time slot no longer meets weather requirements. New options need to be generated."}),f.requiresNewOptions&&h&&e.jsxs(R,{onClick:h,variant:"outline",size:"sm",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Generate New Options"]})]})]}),e.jsxs(P,{children:[e.jsxs(W,{children:[e.jsx($,{children:"Schedule Change Summary"}),e.jsx(K,{children:"Review the details of your rescheduled flight"})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{variant:"outline",children:"Original Time"})}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),I(w,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),I(w,"h:mm a")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{className:"bg-green-500",children:"New Time"})}),e.jsxs("div",{className:"p-4 bg-green-100 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-1 font-medium",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),I(N,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-green-800 font-medium",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),I(N,"h:mm a")]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Flight Details"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Route:"}),e.jsxs("span",{className:"text-sm font-medium",children:[l.departureAirport," → ",l.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Student:"}),e.jsx("span",{className:"text-sm font-medium",children:s.studentName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Instructor:"}),e.jsx("span",{className:"text-sm font-medium",children:s.instructorName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Aircraft:"}),e.jsx("span",{className:"text-sm font-medium",children:s.aircraftType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Training Level:"}),e.jsx(D,{variant:"outline",children:s.trainingLevel})]})]})]}),e.jsxs("div",{className:"border-t pt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather will be checked immediately before confirmation"}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx(R,{variant:"outline",onClick:u,disabled:d,children:"Cancel"}),e.jsx(R,{onClick:y,disabled:d||o,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating Weather..."]}):"Confirm Reschedule"})]})]})]})]}),e.jsx(P,{className:"bg-blue-50 border-blue-200",children:e.jsx(B,{className:"pt-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What Happens Next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Weather conditions will be re-validated in real-time"}),e.jsx("li",{children:"If conditions are suitable, the booking will be updated"}),e.jsx("li",{children:"Both student and instructor will receive email confirmation"}),e.jsx("li",{children:"Weather monitoring will continue for the new time slot"})]})]})})})]})}function as(){const{bookingId:s}=Be(),a=_e(),[r,l]=x.useState(null),[i,u]=x.useState([]),[h,o]=x.useState(null),[d,m]=x.useState("options"),[f,b]=x.useState(!0),[w,N]=x.useState(!1),[y,n]=x.useState(null),[j,E]=x.useState(null);x.useEffect(()=>{s&&O()},[s]);const O=()=>S(this,null,function*(){if(s)try{b(!0),n(null);const p=yield Te.getBooking(s);l(p);try{const g=yield me(s);u(g);try{const C=yield Fe(s);if(C.preference){E({option1Id:C.preference.option1Id,option2Id:C.preference.option2Id,option3Id:C.preference.option3Id,unavailableOptionIds:C.preference.unavailableOptionIds||[]});const A=C.preference.option1Id||C.preference.option2Id||C.preference.option3Id;if(A&&g.length>0){const se=g.find(Ne=>Ne.id===A);se?(o(se),m("confirmation")):m("preferences")}else g.length>0&&m("options")}else g.length>0&&m("options")}catch(C){g.length>0&&m("options")}}catch(g){m("options")}}catch(p){const g=q(p);n(g.message),L(p,"load-booking")}finally{b(!1)}}),t=p=>{if(u(p),p.length>0&&j){const g=j.option1Id||j.option2Id||j.option3Id;if(g){const C=p.find(A=>A.id===g);C?(o(C),m("confirmation")):m("preferences")}else m("preferences")}},c=p=>S(this,null,function*(){if(s)try{N(!0),n(null),yield Le(k({bookingId:s},p)),E(p);const g=p.option1Id||p.option2Id||p.option3Id;if(g){const C=i.find(A=>A.id===g);C&&(o(C),m("confirmation"))}}catch(g){const C=q(g);n(C.message),L(g,"submit-preferences")}finally{N(!1)}}),v=()=>S(this,null,function*(){if(!s||!h)return{success:!1,error:"Missing booking ID or selected option"};try{N(!0),n(null);const p=yield We(s);return p.success?(a(`/bookings/${s}`),{success:!0}):p.requiresNewOptions?(n(p.error||"Weather conditions have changed. Please generate new options."),m("options"),{success:!1,error:p.error,requiresNewOptions:!0}):(n(p.error||"Failed to confirm reschedule"),{success:!1,error:p.error})}catch(p){const g=q(p);return n(g.message),L(p,"confirm-reschedule"),{success:!1,error:g.message}}finally{N(!1)}});return f?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(U,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]}):y&&!r?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(V,{variant:"destructive",children:e.jsx(X,{children:y})}),e.jsx("div",{className:"mt-4",children:e.jsx(J,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]}):r?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(J,{to:`/bookings/${s}`,className:"text-blue-600 hover:text-blue-800 text-sm mb-2 inline-flex items-center",children:[e.jsx(Pe,{className:"mr-1 h-4 w-4"}),"Back to Booking Details"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reschedule Flight"}),e.jsxs("p",{className:"text-gray-600",children:[r.departureAirport," → ",r.arrivalAirport]})]})}),y&&e.jsx(V,{variant:"destructive",children:e.jsx(X,{children:y})}),e.jsx(P,{children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center ${d==="options"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d==="options"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Generate Options"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${d==="preferences"?"text-blue-600 font-semibold":d==="confirmation"?"text-gray-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d==="preferences"?"bg-blue-600 text-white":d==="confirmation"?"bg-gray-400 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Rank Preferences"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${d==="confirmation"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d==="confirmation"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Confirm"})]})]})})}),d==="options"&&e.jsx($e,{bookingId:s,onOptionsLoaded:t,onContinue:()=>{i.length>0&&m("preferences")}}),d==="preferences"&&i.length>0&&e.jsx(Ve,{options:i,onSubmit:c,loading:w,existingRanking:j||void 0}),d==="confirmation"&&h&&r&&e.jsx(Xe,{bookingDetails:{id:r.id,studentName:"Student",instructorName:"Instructor",aircraftType:r.aircraftId||"Aircraft",trainingLevel:r.trainingLevel||"student_pilot"},oldScheduledTime:r.scheduledDatetime,newScheduledTime:h.suggestedDatetime,route:{departureAirport:r.departureAirport,arrivalAirport:r.arrivalAirport},onConfirm:v,onCancel:()=>m("preferences"),loading:w})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center text-gray-600",children:"Booking not found"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(J,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]})}export{as as default};
