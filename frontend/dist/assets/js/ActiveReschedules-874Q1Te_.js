var b=(p,t,n)=>new Promise((y,u)=>{var h=a=>{try{l(n.next(a))}catch(o){u(o)}},x=a=>{try{l(n.throw(a))}catch(o){u(o)}},l=a=>a.done?y(a.value):Promise.resolve(a.value).then(h,x);l((n=n.apply(p,t)).next())});import{j as e,e as D,a as E,C as _,n as I,h as L}from"./ui-vendor-D_mUPHSy.js";import{u as O,r as f}from"./react-vendor-DxF-uWSm.js";import{u as U,C as k,d as C,a as W,b as G,c as H,B as Y}from"./index-BZSvVJxI.js";import{B as m}from"./badge-Ch5NKaSa.js";import{A as z,a as F}from"./alert-DZAS7WTi.js";import{B as T}from"./booking-dM9KwxI5.js";import{B as $}from"./booking-CF_xURUj.js";import{g as q,c as J}from"./rescheduling-BmXf2eV0.js";import{f as B}from"./utils-vendor-1hodNj4h.js";function ie(){const p=O(),{user:t}=U(),[n,y]=f.useState([]),[u,h]=f.useState(!0),[x,l]=f.useState(null);f.useEffect(()=>{a()},[t]);const a=()=>b(this,null,function*(){if(t!=null&&t.id)try{h(!0),l(null);const S=(yield T.listBookings({status:$.RESCHEDULING,limit:100})).filter(r=>r.studentId===t.id||r.instructorId===t.id),M=(yield Promise.all(S.map(r=>b(this,null,function*(){try{let g=!1,j=!1,N=!1,v,c="unknown";try{if(g=(yield q(r.id)).length>0,g)try{const i=yield J(r.id),d=i.find(w=>w.userId===t.id);j=!!d,N=i.length>=2&&i.every(w=>w.submittedAt),j?c=N?"ready_to_confirm":"waiting_other_preference":c="waiting_my_preference",d!=null&&d.deadline?v=d.deadline:i.length>0&&i[0].deadline&&(v=i[0].deadline)}catch(i){c="waiting_my_preference"}else c="options_generated"}catch(P){c="unknown"}return{bookingId:r.id,booking:r,hasOptions:g,hasMyPreference:j,hasBothPreferences:N,deadline:v,status:c}}catch(g){return null}})))).filter(r=>r!==null);y(M)}catch(s){l(s.message||"Failed to load active reschedules"),console.error("Error loading active reschedules:",s)}finally{h(!1)}}),o=s=>{switch(s){case"options_generated":return e.jsx(m,{className:"bg-blue-500",children:"Options Generated"});case"waiting_my_preference":return e.jsx(m,{className:"bg-yellow-500",children:"Waiting for Your Preference"});case"waiting_other_preference":return e.jsx(m,{className:"bg-orange-500",children:"Waiting for Other User"});case"ready_to_confirm":return e.jsx(m,{className:"bg-green-500",children:"Ready to Confirm"});default:return e.jsx(m,{className:"bg-gray-500",children:"Unknown"})}},A=s=>{switch(s){case"options_generated":return"Reschedule options have been generated. Please review and submit your preferences.";case"waiting_my_preference":return"Reschedule options are available. Please submit your preference ranking.";case"waiting_other_preference":return"You have submitted your preferences. Waiting for the other user to submit theirs.";case"ready_to_confirm":return"Both users have submitted preferences. Ready to confirm the reschedule.";default:return"Status unknown."}},R=s=>{p(`/bookings/${s}/reschedule`)};return u?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(D,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading active reschedules..."})]}):x?e.jsxs(z,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(F,{children:x})]}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Active Reschedules"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Bookings currently in the rescheduling process. Continue where you left off."})]}),n.length===0?e.jsx(k,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No active reschedules"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"All your bookings are up to date."})]})})}):e.jsx("div",{className:"grid gap-4",children:n.map(s=>e.jsxs(k,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(G,{className:"text-lg",children:[s.booking.departureAirport," â†’ ",s.booking.arrivalAirport]}),e.jsx(H,{className:"mt-2",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(_,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["Original: ",B(new Date(s.booking.scheduledDatetime),"MMM d, yyyy h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(I,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{children:s.booking.trainingLevel})]})]})})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[o(s.status),e.jsx(Y,{onClick:()=>R(s.bookingId),size:"sm",children:"Continue"})]})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700",children:A(s.status)})]}),s.deadline&&e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:["Deadline: ",B(new Date(s.deadline),"MMM d, yyyy h:mm a")]})]})]},s.bookingId))})]})}export{ie as default};
