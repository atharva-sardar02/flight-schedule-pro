var be=Object.defineProperty,Ne=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var se=(s,a,r)=>a in s?be(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,k=(s,a)=>{for(var r in a||(a={}))te.call(a,r)&&se(s,r,a[r]);if(G)for(var r of G(a))re.call(a,r)&&se(s,r,a[r]);return s},A=(s,a)=>Ne(s,ve(a));var _=(s,a)=>{var r={};for(var l in s)te.call(s,l)&&a.indexOf(l)<0&&(r[l]=s[l]);if(s!=null&&G)for(var l of G(s))a.indexOf(l)<0&&re.call(s,l)&&(r[l]=s[l]);return r};var S=(s,a,r)=>new Promise((l,i)=>{var u=d=>{try{x(r.next(d))}catch(f){i(f)}},o=d=>{try{x(r.throw(d))}catch(f){i(f)}},x=d=>d.done?l(d.value):Promise.resolve(d.value).then(u,o);x((r=r.apply(s,a)).next())});import{j as e,d as z,C as L,n as U,f as ye,o as we,p as Ce,q as Q,u as ke,r as de,s as ae,t as Se,v as Ee,G as Ie,g as Re,i as Oe,T as De,R as ne,h as ie,w as ce,A as Ae}from"./ui-vendor-BJJ7qMNn.js";import{r as m,f as Me,c as Pe,L as J}from"./react-vendor-ClLnrwvH.js";import{g as T,s as q,B as O,C as M,a as F,b as W,c as H,d as P,e as le}from"./index-jqLaxEdb.js";import{B as D}from"./badge-Dskopwpi.js";import{A as K,a as V}from"./alert-Vwyf0H6t.js";import{a as $,B as Be}from"./booking-uXzeD3-X.js";import{f as I}from"./utils-vendor-1hodNj4h.js";function _e(s){return S(this,null,function*(){return(yield $.post(`/reschedule/generate/${s}`)).data.options})}function oe(s){return S(this,null,function*(){return(yield $.get(`/reschedule/options/${s}`)).data.options})}function Te(s){return S(this,null,function*(){return(yield $.post("/preferences/submit",s)).data})}function qe(s){return S(this,null,function*(){return(yield $.get(`/preferences/my/${s}`)).data})}function Le(s){return S(this,null,function*(){var a,r,l;try{const i=yield $.post(`/reschedule/confirm/${s}`);return k({success:!0},i.data)}catch(i){return((a=i.response)==null?void 0:a.status)===409?{success:!1,error:i.response.data.error||"Weather conditions no longer suitable",requiresNewOptions:i.response.data.requiresNewOptions||!1}:{success:!1,error:((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.error)||i.message||"Failed to confirm reschedule"}}})}function Fe({bookingId:s,onOptionsLoaded:a}){const[r,l]=m.useState([]),[i,u]=m.useState(!0),[o,x]=m.useState(!1),[d,f]=m.useState(null);m.useEffect(()=>{p()},[s]);const p=()=>S(this,null,function*(){try{u(!0),f(null);const c=yield oe(s);l(c),a&&a(c)}catch(c){const h=T(c);f(h.message),q(c,"load-reschedule-options")}finally{u(!1)}}),j=()=>S(this,null,function*(){try{x(!0),f(null);const c=yield _e(s);l(c),a&&a(c)}catch(c){const h=T(c);f(h.message),q(c,"generate-reschedule-options")}finally{x(!1)}}),v=c=>c>=.8?e.jsx(D,{className:"bg-green-500",children:"High Confidence"}):c>=.6?e.jsx(D,{className:"bg-yellow-500",children:"Medium Confidence"}):e.jsx(D,{className:"bg-orange-500",children:"Low Confidence"}),b=c=>c>=.8?e.jsx(D,{className:"bg-blue-500",children:"Excellent Weather"}):c>=.6?e.jsx(D,{className:"bg-blue-400",children:"Good Weather"}):e.jsx(D,{className:"bg-gray-500",children:"Fair Weather"});return i?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(z,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading options..."})]}):d?e.jsx(K,{variant:"destructive",children:e.jsxs(V,{children:[e.jsx("p",{className:"mb-2",children:d}),e.jsx(O,{onClick:p,variant:"outline",size:"sm",children:"Retry"})]})}):r.length===0?e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(W,{children:"No Reschedule Options"}),e.jsx(H,{children:"Generate new options using our AI scheduling assistant."})]}),e.jsx(P,{children:e.jsxs(O,{onClick:j,disabled:o,children:[o&&e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Options"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Reschedule Options"}),e.jsxs(O,{onClick:j,disabled:o,variant:"outline",size:"sm",children:[o&&e.jsx(z,{className:"mr-2 h-4 w-4 animate-spin"}),"Regenerate"]})]}),e.jsx("div",{className:"grid gap-4",children:r.map((c,h)=>e.jsxs(M,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-base",children:["Option ",h+1]}),e.jsxs("div",{className:"flex gap-2",children:[v(c.confidence),b(c.weatherScore)]})]})}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(L,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:I(new Date(c.suggestedDatetime),"EEEE, MMMM d, yyyy")}),e.jsxs("span",{className:"ml-2 text-gray-600",children:["at ",I(new Date(c.suggestedDatetime),"h:mm a")]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(U,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[c.departureAirport," → ",c.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(ye,{className:"mr-2 h-4 w-4 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700",children:c.reasoning})})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 pt-2 border-t",children:[e.jsxs("span",{children:["Weather Score: ",(c.weatherScore*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Confidence: ",(c.confidence*100).toFixed(0),"%"]})]})]})]},c.id))})]})}function We(s){const a=m.useRef({value:s,previous:s});return m.useMemo(()=>(a.current.value!==s&&(a.current.previous=a.current.value,a.current.value=s),a.current.previous),[s])}var X="Checkbox",[$e]=we(X),[Ge,Z]=$e(X);function ze(s){const{__scopeCheckbox:a,checked:r,children:l,defaultChecked:i,disabled:u,form:o,name:x,onCheckedChange:d,required:f,value:p="on",internal_do_not_use_render:j}=s,[v,b]=ke({prop:r,defaultProp:i!=null?i:!1,onChange:d,caller:X}),[c,h]=m.useState(null),[w,E]=m.useState(null),R=m.useRef(!1),t=c?!!o||!!c.closest("form"):!0,n={checked:v,disabled:u,setChecked:b,control:c,setControl:h,name:x,form:o,value:p,hasConsumerStoppedPropagationRef:R,required:f,defaultChecked:B(i)?!1:i,isFormControl:t,bubbleInput:w,setBubbleInput:E};return e.jsx(Ge,A(k({scope:a},n),{children:Ue(j)?j(n):l}))}var me="CheckboxTrigger",xe=m.forwardRef((u,i)=>{var o=u,{__scopeCheckbox:s,onKeyDown:a,onClick:r}=o,l=_(o,["__scopeCheckbox","onKeyDown","onClick"]);const{control:x,value:d,disabled:f,checked:p,required:j,setControl:v,setChecked:b,hasConsumerStoppedPropagationRef:c,isFormControl:h,bubbleInput:w}=Z(me,s),E=de(i,v),R=m.useRef(p);return m.useEffect(()=>{const t=x==null?void 0:x.form;if(t){const n=()=>b(R.current);return t.addEventListener("reset",n),()=>t.removeEventListener("reset",n)}},[x,b]),e.jsx(Q.button,A(k({type:"button",role:"checkbox","aria-checked":B(p)?"mixed":p,"aria-required":j,"data-state":ge(p),"data-disabled":f?"":void 0,disabled:f,value:d},l),{ref:E,onKeyDown:ae(a,t=>{t.key==="Enter"&&t.preventDefault()}),onClick:ae(r,t=>{b(n=>B(n)?!0:!n),w&&h&&(c.current=t.isPropagationStopped(),c.current||t.stopPropagation())})}))});xe.displayName=me;var ee=m.forwardRef((s,a)=>{const v=s,{__scopeCheckbox:r,name:l,checked:i,defaultChecked:u,required:o,disabled:x,value:d,onCheckedChange:f,form:p}=v,j=_(v,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]);return e.jsx(ze,{__scopeCheckbox:r,checked:i,defaultChecked:u,disabled:x,required:o,onCheckedChange:f,name:l,form:p,value:d,internal_do_not_use_render:({isFormControl:b})=>e.jsxs(e.Fragment,{children:[e.jsx(xe,A(k({},j),{ref:a,__scopeCheckbox:r})),b&&e.jsx(pe,{__scopeCheckbox:r})]})})});ee.displayName=X;var he="CheckboxIndicator",ue=m.forwardRef((s,a)=>{const o=s,{__scopeCheckbox:r,forceMount:l}=o,i=_(o,["__scopeCheckbox","forceMount"]),u=Z(he,r);return e.jsx(Ce,{present:l||B(u.checked)||u.checked===!0,children:e.jsx(Q.span,A(k({"data-state":ge(u.checked),"data-disabled":u.disabled?"":void 0},i),{ref:a,style:k({pointerEvents:"none"},s.style)}))})});ue.displayName=he;var fe="CheckboxBubbleInput",pe=m.forwardRef((l,r)=>{var i=l,{__scopeCheckbox:s}=i,a=_(i,["__scopeCheckbox"]);const{control:u,hasConsumerStoppedPropagationRef:o,checked:x,defaultChecked:d,required:f,disabled:p,name:j,value:v,form:b,bubbleInput:c,setBubbleInput:h}=Z(fe,s),w=de(r,h),E=We(x),R=Se(u);m.useEffect(()=>{const n=c;if(!n)return;const N=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(N,"checked").set,C=!o.current;if(E!==x&&y){const Y=new Event("click",{bubbles:C});n.indeterminate=B(x),y.call(n,B(x)?!1:x),n.dispatchEvent(Y)}},[c,E,x,o]);const t=m.useRef(B(x)?!1:x);return e.jsx(Q.input,A(k({type:"checkbox","aria-hidden":!0,defaultChecked:d!=null?d:t.current,required:f,disabled:p,name:j,value:v,form:b},a),{tabIndex:-1,ref:w,style:A(k(k({},a.style),R),{position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"})}))});pe.displayName=fe;function Ue(s){return typeof s=="function"}function B(s){return s==="indeterminate"}function ge(s){return B(s)?"indeterminate":s?"checked":"unchecked"}const je=m.forwardRef((l,r)=>{var i=l,{className:s}=i,a=_(i,["className"]);return e.jsx(ee,A(k({ref:r,className:le("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},a),{children:e.jsx(ue,{className:le("grid place-content-center text-current"),children:e.jsx(Ee,{className:"h-4 w-4"})})}))});je.displayName=ee.displayName;function He({options:s,onSubmit:a,loading:r=!1,existingRanking:l}){const[i,u]=m.useState([null,null,null]),[o,x]=m.useState(new Set),[d,f]=m.useState(null);m.useEffect(()=>{if(l&&s.length>0){const t=[null,null,null];l.option1Id&&(t[0]=s.find(n=>n.id===l.option1Id)||null),l.option2Id&&(t[1]=s.find(n=>n.id===l.option2Id)||null),l.option3Id&&(t[2]=s.find(n=>n.id===l.option3Id)||null),u(t),x(new Set(l.unavailableOptionIds||[]))}},[l,s]);const p=s.filter(t=>!i.some(n=>(n==null?void 0:n.id)===t.id)&&!o.has(t.id)),j=t=>{f(t)},v=t=>{t.preventDefault()},b=t=>{if(d===null)return;const n=[...i],N=i[d];n[d]=n[t],n[t]=N,u(n),f(null)},c=(t,n)=>{const N=[...i];N[n]=t,u(N)},h=t=>{const n=[...i];n[t]=null,u(n)},w=t=>{const n=new Set(o);n.has(t)?n.delete(t):(n.add(t),u(i.map(N=>(N==null?void 0:N.id)===t?null:N))),x(n)},E=()=>{var t,n,N;a({option1Id:(t=i[0])==null?void 0:t.id,option2Id:(n=i[1])==null?void 0:n.id,option3Id:(N=i[2])==null?void 0:N.id,unavailableOptionIds:Array.from(o)})},R=i.some(t=>t!==null);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(W,{children:"Rank Your Preferences"}),e.jsx(H,{children:"Drag options to rank them in order of preference, or mark options as unavailable. Your #1 choice will be given the highest weight in the final selection."})]}),e.jsx(P,{className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:i.map((t,n)=>e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] bg-gray-50",onDragOver:v,onDrop:()=>b(n),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[n===0?"1st":n===1?"2nd":"3rd"," Choice"]}),t&&e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>h(n),children:"Remove"})]}),t?e.jsx("div",{className:"bg-white border rounded-lg p-3 cursor-move",draggable:!0,onDragStart:()=>j(n),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-gray-400 mt-1"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(L,{className:"mr-2 h-4 w-4 text-gray-500"}),I(new Date(t.suggestedDatetime),"EEE, MMM d")," at"," ",I(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(U,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]})]})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-2",children:"Drag an option here or select from below"})]},n))})})]}),e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(W,{children:"Available Options"}),e.jsx(H,{children:"Select options to add to your ranking, or mark them as unavailable."})]}),e.jsxs(P,{children:[p.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"All options have been ranked or marked unavailable"}):e.jsx("div",{className:"space-y-2",children:p.map((t,n)=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{id:`unavailable-${t.id}`,checked:o.has(t.id),onCheckedChange:()=>w(t.id)}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm font-medium",children:[e.jsx(L,{className:"mr-2 h-4 w-4 text-gray-500"}),I(new Date(t.suggestedDatetime),"EEEE, MMMM d, yyyy")," at"," ",I(new Date(t.suggestedDatetime),"h:mm a")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(U,{className:"mr-2 h-4 w-4 text-gray-500"}),t.departureAirport," → ",t.arrivalAirport]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.reasoning}),e.jsx("div",{className:"flex gap-2",children:[0,1,2].map(N=>e.jsxs(O,{size:"sm",variant:"outline",onClick:()=>c(t,N),disabled:i[N]!==null,children:["Set as #",N+1]},N))})]})]})},t.id))}),o.size>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Unavailable Options"]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>o.has(t.id)).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 p-2 bg-gray-100 rounded",children:[e.jsx("span",{children:I(new Date(t.suggestedDatetime),"MMM d, h:mm a")}),e.jsx(O,{size:"sm",variant:"ghost",onClick:()=>w(t.id),children:"Mark Available"})]},t.id))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{onClick:E,disabled:!R||r,size:"lg",children:r?"Submitting...":"Submit Preferences"})}),!R&&e.jsx("p",{className:"text-sm text-red-600 text-center",children:"Please rank at least one option before submitting"})]})}function Ke({bookingDetails:s,oldScheduledTime:a,newScheduledTime:r,route:l,onConfirm:i,onCancel:u,onRequestNewOptions:o,loading:x=!1}){const[d,f]=m.useState(!1),[p,j]=m.useState(null),v=new Date(a),b=new Date(r),c=()=>S(this,null,function*(){try{f(!0),j(null);const h=yield i();h.success||(h.requiresNewOptions?j({message:h.error||"Weather conditions have changed",requiresNewOptions:!0}):j({message:h.error||"Failed to confirm reschedule",requiresNewOptions:!1}))}catch(h){const w=T(h);j({message:w.message,requiresNewOptions:!1}),q(h,"confirm-reschedule")}finally{f(!1)}});return e.jsxs("div",{className:"space-y-6",children:[!p&&e.jsx(M,{className:"bg-green-50 border-green-200",children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3 text-green-800",children:[e.jsx(Oe,{className:"h-8 w-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Ready to Confirm Reschedule"}),e.jsx("p",{className:"text-sm",children:"Weather will be re-validated before final confirmation"})]})]})})}),p&&e.jsxs(K,{variant:"destructive",children:[e.jsx(De,{className:"h-5 w-5"}),e.jsxs(V,{children:[e.jsx("p",{className:"font-semibold mb-2",children:p.message}),p.requiresNewOptions&&e.jsx("p",{className:"text-sm mb-3",children:"The selected time slot no longer meets weather requirements. New options need to be generated."}),p.requiresNewOptions&&o&&e.jsxs(O,{onClick:o,variant:"outline",size:"sm",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Generate New Options"]})]})]}),e.jsxs(M,{children:[e.jsxs(F,{children:[e.jsx(W,{children:"Schedule Change Summary"}),e.jsx(H,{children:"Review the details of your rescheduled flight"})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{variant:"outline",children:"Original Time"})}),e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),I(v,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),I(v,"h:mm a")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(D,{className:"bg-green-500",children:"New Time"})}),e.jsxs("div",{className:"p-4 bg-green-100 rounded-lg border-2 border-green-300",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-1 font-medium",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),I(b,"EEEE, MMMM d, yyyy")]}),e.jsxs("div",{className:"flex items-center text-sm text-green-800 font-medium",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),I(b,"h:mm a")]})]})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Flight Details"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Route:"}),e.jsxs("span",{className:"text-sm font-medium",children:[l.departureAirport," → ",l.arrivalAirport]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Student:"}),e.jsx("span",{className:"text-sm font-medium",children:s.studentName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"mr-3 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Instructor:"}),e.jsx("span",{className:"text-sm font-medium",children:s.instructorName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Aircraft:"}),e.jsx("span",{className:"text-sm font-medium",children:s.aircraftType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-3 h-4 w-4"}),e.jsx("span",{className:"text-sm text-gray-600 w-32",children:"Training Level:"}),e.jsx(D,{variant:"outline",children:s.trainingLevel})]})]})]}),e.jsxs("div",{className:"border-t pt-4 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather will be checked immediately before confirmation"}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx(O,{variant:"outline",onClick:u,disabled:d,children:"Cancel"}),e.jsx(O,{onClick:c,disabled:d||x,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Validating Weather..."]}):"Confirm Reschedule"})]})]})]})]}),e.jsx(M,{className:"bg-blue-50 border-blue-200",children:e.jsx(P,{className:"pt-4",children:e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"What Happens Next?"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsx("li",{children:"Weather conditions will be re-validated in real-time"}),e.jsx("li",{children:"If conditions are suitable, the booking will be updated"}),e.jsx("li",{children:"Both student and instructor will receive email confirmation"}),e.jsx("li",{children:"Weather monitoring will continue for the new time slot"})]})]})})})]})}function ts(){const{bookingId:s}=Me(),a=Pe(),[r,l]=m.useState(null),[i,u]=m.useState([]),[o,x]=m.useState(null),[d,f]=m.useState("options"),[p,j]=m.useState(!0),[v,b]=m.useState(!1),[c,h]=m.useState(null),[w,E]=m.useState(null);m.useEffect(()=>{s&&R()},[s]);const R=()=>S(this,null,function*(){if(s)try{j(!0),h(null);const g=yield Be.getBooking(s);l(g);try{const y=yield oe(s);u(y);try{const C=yield qe(s);E({option1Id:C.preference.option1Id,option2Id:C.preference.option2Id,option3Id:C.preference.option3Id,unavailableOptionIds:C.preference.unavailableOptionIds||[]})}catch(C){}}catch(y){}}catch(g){const y=T(g);h(y.message),q(g,"load-booking")}finally{j(!1)}}),t=g=>{u(g),g.length>0&&f("preferences")},n=g=>S(this,null,function*(){if(s)try{b(!0),h(null),yield Te(k({bookingId:s},g)),E(g);const y=g.option1Id||g.option2Id||g.option3Id;if(y){const C=i.find(Y=>Y.id===y);C&&(x(C),f("confirmation"))}}catch(y){const C=T(y);h(C.message),q(y,"submit-preferences")}finally{b(!1)}}),N=()=>S(this,null,function*(){if(!s||!o)return{success:!1,error:"Missing booking ID or selected option"};try{b(!0),h(null);const g=yield Le(s);return g.success?(a(`/bookings/${s}`),{success:!0}):g.requiresNewOptions?(h(g.error||"Weather conditions have changed. Please generate new options."),f("options"),{success:!1,error:g.error,requiresNewOptions:!0}):(h(g.error||"Failed to confirm reschedule"),{success:!1,error:g.error})}catch(g){const y=T(g);return h(y.message),q(g,"confirm-reschedule"),{success:!1,error:y.message}}finally{b(!1)}});return p?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(z,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading booking details..."})]}):c&&!r?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(K,{variant:"destructive",children:e.jsx(V,{children:c})}),e.jsx("div",{className:"mt-4",children:e.jsx(J,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]}):r?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(J,{to:`/bookings/${s}`,className:"text-blue-600 hover:text-blue-800 text-sm mb-2 inline-flex items-center",children:[e.jsx(Ae,{className:"mr-1 h-4 w-4"}),"Back to Booking Details"]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reschedule Flight"}),e.jsxs("p",{className:"text-gray-600",children:[r.departureAirport," → ",r.arrivalAirport]})]})}),c&&e.jsx(K,{variant:"destructive",children:e.jsx(V,{children:c})}),e.jsx(M,{children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center ${d==="options"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d==="options"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"ml-2",children:"Generate Options"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${d==="preferences"?"text-blue-600 font-semibold":d==="confirmation"?"text-gray-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d==="preferences"?"bg-blue-600 text-white":d==="confirmation"?"bg-gray-400 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"ml-2",children:"Rank Preferences"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center ${d==="confirmation"?"text-blue-600 font-semibold":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${d==="confirmation"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"ml-2",children:"Confirm"})]})]})})}),d==="options"&&e.jsx(Fe,{bookingId:s,onOptionsLoaded:t}),d==="preferences"&&i.length>0&&e.jsx(He,{options:i,onSubmit:n,loading:v,existingRanking:w||void 0}),d==="confirmation"&&o&&r&&e.jsx(Ke,{bookingDetails:{id:r.id,studentName:"Student",instructorName:"Instructor",aircraftType:r.aircraftId||"Aircraft",trainingLevel:r.trainingLevel||"student_pilot"},oldScheduledTime:r.scheduledDatetime,newScheduledTime:o.suggestedDatetime,route:{departureAirport:r.departureAirport,arrivalAirport:r.arrivalAirport},onConfirm:N,onCancel:()=>f("preferences"),loading:v})]}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"text-center text-gray-600",children:"Booking not found"}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(J,{to:"/bookings",className:"text-blue-600 hover:text-blue-800",children:"← Back to Bookings"})})]})}export{ts as default};
